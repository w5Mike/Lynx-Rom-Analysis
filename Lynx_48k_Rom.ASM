
;***********************************************************************
;*
;*          Camputers Lynx 48k ROM disassembly (version L014)
;*          -------------------------------------------------
;*
;*   Reconstructed from lynx eprom memory images and supplemented with
;*   information from Lynx User Magazine Issue 1 (Camputers, June 1983, 
;*   pages 16-18) and Nilug News (Issue 6) by R.B.Poate
;*
;*   Disassembly, collation and formatting by: Mike Panter 10/10/2021
;*
;*   Additional credits to: Russell Davis  (online archive of materials)
;*                          Pete Todd      (knowledge, insight and Pale)
;*
;*   WARNING: May contain inaccuracies - use at own risk.
;*
;*   Feel free to distribute. Please include attribution.
;*
;********************** LABELS/SYMBOLS/PREFIXES ************************
;*
;*      SYSVAR_     - RAM addresses used by the Lynx ROM routines
;*      RST_        - Z80 Restarts
;*      DATA_       - Data tables stored in rom (eg. PI)
;*      LYNX_       - Lynx internal system routines
;*      BASIC_COM_  - Lynx BASIC commands 
;*      BASIC_FN_   - Lynx BASIC functions/operators
;*      MONITOR_    - Lynx MONITOR commands
;*      VDU_        - VDU commands
;*      SUB_        - internal subroutines used by ROM
;*
;* ---------------------------------------------------------------------
;*     COMPILE/ASSEMBLE: z88dk-z80asm -b -mz80 Lynx_48k_Rom.asm
;* ---------------------------------------------------------------------
;*
;
; Lynx Global Symbol Definitions (RAM addresses)
;
SYSVAR_STACK    EQU $61EE    ; Stores address of Basic stack pointer (STACK) + 2 HIMEM. 
SYSVAR_RNDNO    EQU $61F0    ; 31 bit random number seed. 
SYSVAR_HLSTORE  EQU $61F4    ; Used to store HL after a CALL. 
SYSVAR_CURRLP   EQU $61F6    ; Pointer to first byte of line Basic is currently executing. 
SYSVAR_DATAP    EQU $61F8    ; Pointer used by READ, DATA, points to end of last entry read. 
SYSVAR_SOB      EQU $61FA    ; Points to start of Basic. 
SYSVAR_EOB      EQU $61FC    ; Points to end of Basic. 
SYSVAR_POLBUF   EQU $61FE    ; Pointer to buffer used for conversion to internal language. 
SYSVAR_PRINTD   EQU $6200    ; Address of display driver. 
SYSVAR_LPRNTD   EQU $6202    ; Address of printer driver. 
SYSVAR_KEYB     EQU $6204    ; Address of keyboard driver. 
SYSVAR_OTYPE    EQU $6206    ; Current output type and LINK status.
SYSVAR_LASTDSP  EQU $6207    ; Last character output to screen (used for VDU VDU 2,n). 
SYSVAR_VTYPE    EQU $6208    ; Current variable type. 
SYSVAR_CONTLP   EQU $6209    ; Pointer to CONTinue line. 0 if cannot continue. 
SYSVAR_RSTACK   EQU $620B    ; Pointer to return stack. 
SYSVAR_RSP      EQU $620D    ; Return stack pointer. 
SYSVAR_VTBL     EQU $620F    ; Pointer to variables A-Z, a-z. 
SYSVAR_ATBL     EQU $6211    ; Pointer to array variables A-Z, a-z.
SYSVAR_STBL     EQU $6213    ; Pointer to string variables. 
SYSVAR_FTBL     EQU $6215    ; Pointer to function evaluation table.
SYSVAR_TTBL     EQU $6217    ; Pointer to non-command token table.
SYSVAR_XTTBL    EQU $6219    ; Pointer to command token table.
SYSVAR_XITBL    EQU $621B    ; Pointer to Input syntax checking table. 
SYSVAR_XETBL    EQU $621D    ; Pointer to command execution table.
SYSVAR_TOV      EQU $621F    ; Top of variables (strings and arrays).
SYSVAR_IEXT     EQU $6221    ; Jump to EXT syntax checking. 
SYSVAR_EEXT     EQU $6224    ; Jump to EXT execution. 
SYSVAR_INPLSUB  EQU $6227    ; RAM call from line input routine.
SYSVAR_EXECSUB  EQU $622A    ; Called before execution of every line. 
SYSVAR_ZFLAG    EQU $622D    ; Number flag gives TRAIL and ROUND status.
SYSVAR_AUTOFL   EQU $622E    ; Auto line numbering on/off flag.
SYSVAR_CRST     EQU $622F    ; Pointer to message used to generate CR (0DH) in display driver.
SYSVAR_KSMS     EQU $6231    ; Single key entry. 
SYSVAR_RPTDLY   EQU $6233    ; Repeat delay on keyboard. 
SYSVAR_LASTK    EQU $6235    ; Last character from keyboard. 
SYSVAR_STATUS   EQU $6236    ; Used by keyboard driver. 
SYSVAR_RPT      EQU $6237    ; Length of time between key repeats. 
SYSVAR_SHLKT    EQU $6239    ; Used by shift lock. 
SYSVAR_KTBL     EQU $623A    ; 26 bytes storing tokens for shorthand. Only command tokens allowed. In order A-Z. 
SYSVAR_CURSORX  EQU $6254    ; X component of cursor (0-126). 
SYSVAR_CURSORY  EQU $6255    ; Y component of cursor (0-247). 
SYSVAR_WINDST   EQU $6256    ; Window size. 
SYSVAR_CURSTAT  EQU $625A    ; Cursor on/off. 
SYSVAR_INKST    EQU $625B    ; Stores ink colour. 
SYSVAR_PAPST    EQU $625C    ; Stores paper colour. 
SYSVAR_FLASH    EQU $625D    ; Cursor flash rate. 
SYSVAR_INPCUR   EQU $625F    ; Cursor characters. 
SYSVAR_EXFLAG   EQU $6261    ; TRACE, SPEED on/off store. 
SYSVAR_GLINE    EQU $6262    ; Jump to line draw routine. 
SYSVAR_GOLDX    EQU $6265    ; Graphic cursor position X. 
SYSVAR_GOLDY    EQU $6267    ; Y co-ordinate of graphics cursor. 
SYSVAR_GNEWX    EQU $6268    ; Stores new X co-ordinate before LINE draw. 
SYSVAR_GNEWY    EQU $626A    ; Stores new Y co-ordinate before LINE draw. 
SYSVAR_PROTST   EQU $626B    ; Protect store. 
SYSVAR_OUTB     EQU $626C    ; Jump to routine which outputs byte with data in A, mask in C and relative displacement from top left in HL. Uses colour selected by INK and PAPER.
SYSVAR_CHRTBL   EQU $626F    ; Pointer used to generate characters 32-127. 
SYSVAR_GPHTBL   EQU $6271    ; Pointer used to generate characters 128-255. 
SYSVAR_BPERL    EQU $6273    ; Bytes per line: 20H normally, 40H in double height mode. 
SYSVAR_MASK     EQU $6275    ; Mask used by display driver: change with VDU 20/21. 
SYSVAR_FLIGHT   EQU $6276    ; Jump to lightpen function. 
SYSVAR_FJOY     EQU $6279    ; Jump to joystick function. 
SYSVAR_FUSER0   EQU $627C    ; Jump to USER0 function. 
SYSVAR_FUSER1   EQU $627F    ; Jump to USER I function. 
SYSVAR_FUSER2   EQU $6282    ; Jump to USER2 function. 
SYSVAR_FUSER3   EQU $6285    ; Jump to USER3 function. 
SYSVAR_ERRAM    EQU $6288    ; Called during error. 
SYSVAR_SLFRAM   EQU $628B    ; Called when line feed occurs. 
SYSVAR_BLUBNK   EQU $628E    ; Pointer to BLUE bank. 
SYSVAR_REDBNK   EQU $6290    ; Pointer to RED bank. 
SYSVAR_GRNBNK   EQU $6292    ; Pointer to GREEN bank. 
SYSVAR_NMIRAM   EQU $6294    ; Jump here on NMI. Jump  to 3B32H (not implemented)
SYSVAR_RSTRAM   EQU $6297    ; Jumps here on RST 38H. 
SYSVAR_ERRTBL   EQU $629A    ; Pointer to error messages. 
SYSVAR_CASLEV   EQU $629C    ; Cassette input threshold level. 
SYSVAR_COARSE   EQU $629D    ; Coarse adjustment on cassette speed. 
SYSVAR_FINE     EQU $629E    ; Fine adjustment on cassette speed. 
SYSVAR_SYNCLEN  EQU $629F    ; Length of sync. 
SYSVAR_PLYLEV   EQU $62A0    ; Voltage reference for comparator. Used by LOAD instruction. 
SYSVAR_CASTBL   EQU $62A1    ; Pointer to table used to generate wave. (SOUND?)
SYSVAR_RBIT     EQU $62A3    ; Jumps to read bit routine. 
SYSVAR_WBYTE    EQU $62A6    ; Jumps to write byte routine. 
SYSVAR_PP       EQU $62A9    ; Jump to print a polish expression. 
SYSVAR_NTP      EQU $62AC    ; Jump to normal to internal language conversion routine. 
SYSVAR_EE       EQU $62AF    ; Jump to evaluate expression. 
SYSVAR_DBASLN   EQU $62B2    ; Jump to display basic line. 
SYSVAR_DEBUG    EQU $62B5    ; Jump to SPEED and TRACE routines. 
SYSVAR_VIDEO    EQU $62B8    ; Jump to routine which outputs character in A to current cursor position. 
SYSVAR_LINP     EQU $62BB    ; Jump to line input routine. 
SYSVAR_VRPTS    EQU $62BE    ; Jump to string variable pointer routine. 
SYSVAR_SPEEDST  EQU $62C1    ; Used by SPEED. 
SYSVAR_STORE    EQU $62C2    ; General purpose store. 
SYSVAR_OLDESC   EQU $62C4    ; ESC key roll over. 
SYSVAR_OLDKEY   EQU $62C5    ; Rest of keyboard roll over. 
SYSVAR_WRA4     EQU $62CF    ; WORKING REGISTER AREA 4 
SYSVAR_WRA3     EQU $62D4    ; WORKING REGISTER AREA 3 
SYSVAR_WRAE     EQU $62DD    ; WORKING REGISTER AREA 2 EXTENDED. 
SYSVAR_WRA2     EQU $62E0    ; WORKING REGISTER AREA 2 
SYSVAR_WRA1     EQU $62E5    ; WORKING REGISTER AREA I 
SYSVAR_SYNL     EQU $62EA    ; .
SYSVAR_SYNP     EQU $62EB    ; .
SYSVAR_SYNC     EQU $62EC    ; .
SYSVAR_NPM      EQU $62ED    ; All used by NTP. 
SYSVAR_SBC      EQU $62EE    ; Space before command on line listing (used for indentation). 
SYSVAR_PROCST   EQU $62EF    ; Pointer to first DEFPROC. 
SYSVAR_EDST     EQU $62F1    ; EDIT buffer driver. 
SYSVAR_AUTOST   EQU $62F3    ; Auto line number, increment. 
SYSVAR_PRTBUF   EQU $62FD    ; Used during printing number. 
SYSVAR_POLBUFS  EQU $6301    ; Internal language buffer. 
SYSVAR_STRBUF   EQU $6407    ; String calculation buffer. 
SYSVAR_CSTACK   EQU $6507    ; Calculator stack. 
SYSVAR_RSTACKS  EQU $6607    ; Return stack. 
SYSVAR_VTBLS    EQU $6707    ; (53*5) Variable table. 
SYSVAR_ATBLS    EQU $6810    ; (53*4) Array table. 
SYSVAR_STBLS    EQU $68E4    ; String table. 
SYSVAR_DFTMRK   EQU $694C    ; Carriage return used in READ, DATA. 
SYSVAR_SOBS     EQU $694D    ; START OF BASIC PROGRAM.

;
; START of Lynx 48k Eprom (1/2)
;

START:
    DI                              ;[0000] Start. Disable interrupts. Jump to 3B.
    LD    A,$20                     ;[0001] 
    OUT   ($80),A                   ;[0003] 
    JP    INIT_CRT                  ;[0005] 

RST_8H:
    JP    $351B                     ;[0008] Output character in the A register
    JR    NZ,$0059                  ;[000B] 
    JR    NC,$0040                  ;[000D] 
    INC   (HL)                      ;[000F] 

RST_10H:
    LD    A,(DE)                    ;[0010] Checks if the character at the address pointed to by DE is " "; if so, increments DE until it is not a space.
    CP    $20                       ;[0011] 
    RET   NZ                        ;[0013] 
    INC   DE                        ;[0014] 
    JR    RST_10H                   ;[0015] 
    NOP                             ;[0017] 

RST_18H:
    JP    SUB_ARGUMENT              ;[0018] Evaluates the reverse polish expression pointed to by DE as a binary integer in HL. 
    LD    D,E                       ;[001B] 
    LD    (HL),L                    ;[001C] 
    LD    (HL),E                    ;[001D] 
    LD    A,C                       ;[001E] 
    NOP                             ;[001F] 

RST_20H:
    EX    (SP),HL                   ;[0020] Checks if the byte after RST is the same as A; if it is not, displays a syntax error. 
    CP    (HL)                      ;[0021] 
    INC   HL                        ;[0022] 
    EX    (SP),HL                   ;[0023] 
    RET   Z                         ;[0024] 
    CALL  $3B3B                     ;[0025] 

RST_28H:
    JP    $2059                     ;[0028] Evaluates reverse polish expression pointed to by DE in floating point in WRA1 (working register area 1). 
    NOP                             ;[002B] 
    NOP                             ;[002C] 
    NOP                             ;[002D] 
    NOP                             ;[002E] 
    NOP                             ;[002F] 

RST_30H:
    JP    BASIC_COM_MON             ;[0030] Jumps to monitor TRAP routine. 
    POP   HL                        ;[0033] Has POP HL JP (HL) 
    JP    (HL)                      ;[0034] 
    NOP                             ;[0035] 
    NOP                             ;[0036] 
    NOP                             ;[0037] 

RST_38H:
    JP    SYSVAR_RSTRAM             ;[0038] Jumps to RAM RSTRAM (see RAM variables). 

INIT_CRT:
    XOR   A                         ;[003B] Initialise the 6845 CRT controller.
    LD    BC,$FF7F                  ;[003C] 
    OUT   (C),A                     ;[003F] 
    LD    B,$10                     ;[0041] 
    LD    HL,DATA_CRT               ;[0043] 
    XOR   A                         ;[0046] 
    OUT   ($86),A                   ;[0047] 
    EX    AF,AF'                    ;[0049] 
    LD    A,(HL)                    ;[004A] 
    OUT   ($87),A                   ;[004B] 
    EX    AF,AF'                    ;[004D] 
    INC   A                         ;[004E] 
    INC   HL                        ;[004F] 
    DJNZ  $0047                     ;[0050] 
    JP    $168C                     ;[0052] 
    NOP                             ;[0055] 

DATA_CRT:
    defb 0x2F,0x20,0x26,0x33,0x4D,0x02,0x3F,0x44        ;[0056]
    defb 0x00,0x03,0x03,0x03,0x00,0x00,0x07,0xDF        ;[005E]


NMI_JUMP:
    JP    SYSVAR_NMIRAM             ;[0066] NMI jump

LYNX_INBLUE:
    LD    A,$E8                     ;[0069] Reads byte in red/blue bank at HL into L, and H=0. 
    EX    AF,AF'                    ;[006B] 
    LD    A,$63                     ;[006C] 
    JR    $0075                     ;[006E] 

LYNX_INGREEN:
    LD    A,$E4                     ;[0070] Reads byte in green/alternative green bank at HL into L, and H=0. 
    EX    AF,AF'                    ;[0072] 
    LD    A,$65                     ;[0073] 
    LD    BC,$FF7F                  ;[0075] 
    OUT   (C),A                     ;[0078] 
    LD    A,$40                     ;[007A] 
    OUT   ($80),A                   ;[007C] 
    EX    AF,AF'                    ;[007E] 
    OUT   ($80),A                   ;[007F] 
    LD    L,(HL)                    ;[0081] 
    XOR   A                         ;[0082] 
    OUT   ($80),A                   ;[0083] 
    OUT   (C),A                     ;[0085] 
    LD    H,A                       ;[0087] 
    RET                             ;[0088] 

    PUSH  BC                        ;[0089] I don't think that this is used.
    LD    BC,$0500                  ;[008A] 
    CALL  $0A70                     ;[008D] 
    POP   BC                        ;[0090] 
    IN    A,(C)                     ;[0091] 
    CPL                             ;[0093] 
    RET                             ;[0094] 

    AND   (HL)                      ;[0095] 
    LD    B,B                       ;[0096] 
    SBC   A,B                       ;[0097] 
    RET   PE                        ;[0098] 
    RET   Z                         ;[0099] 
    PUSH  HL                        ;[009A] Character Output Routine
    LD    HL,(SYSVAR_BPERL)         ;[009B] 
    BIT   6,L                       ;[009E] 
    POP   HL                        ;[00A0] 
    JP    Z,$00C2                   ;[00A1] 
    PUSH  AF                        ;[00A4] 
    CALL  $00C2                     ;[00A5] 
    LD    A,$20                     ;[00A8] 
    CALL  $00B8                     ;[00AA] 
    POP   AF                        ;[00AD] 
    PUSH  AF                        ;[00AE] 
    CALL  $00C2                     ;[00AF] 
    XOR   A                         ;[00B2] 
    CALL  $00B8                     ;[00B3] 
    POP   AF                        ;[00B6] 
    RET                             ;[00B7] 

    LD    (SYSVAR_BLUBNK),A         ;[00B8] 
    LD    (SYSVAR_REDBNK),A         ;[00BB] 
    LD    (SYSVAR_GRNBNK),A         ;[00BE] 
    RET                             ;[00C1] 

    PUSH  AF                        ;[00C2] 
    PUSH  HL                        ;[00C3] 
    PUSH  DE                        ;[00C4] 
    PUSH  BC                        ;[00C5] 
    CALL  $00E7                     ;[00C6] 
    POP   BC                        ;[00C9] 
    POP   DE                        ;[00CA] 
    POP   HL                        ;[00CB] 
    POP   AF                        ;[00CC] 
    RET                             ;[00CD] 

LYNX_FONT:
    LD    HL,(SYSVAR_CHRTBL)        ;[00CE] Gives address of bit map of character 
    BIT   7,A                       ;[00D1] 
    JR    Z,$00D8                   ;[00D3] 
    LD    HL,(SYSVAR_GPHTBL)        ;[00D5] 
    AND   $7F                       ;[00D8] 
    PUSH  HL                        ;[00DA] 
    LD    L,A                       ;[00DB] 
    LD    H,$00                     ;[00DC] 
    ADD   HL,HL                     ;[00DE] 
    LD    E,L                       ;[00DF] 
    LD    D,H                       ;[00E0] 
    ADD   HL,HL                     ;[00E1] 
    ADD   HL,HL                     ;[00E2] 
    ADD   HL,DE                     ;[00E3] 
    POP   DE                        ;[00E4] 
    ADD   HL,DE                     ;[00E5] 
    RET                             ;[00E6] 

    CALL  LYNX_FONT                 ;[00E7] Output bytes to screen.
    EX    DE,HL                     ;[00EA] 
    LD    HL,(SYSVAR_CURSORY)       ;[00EB] 
    LD    H,$00                     ;[00EE] 
    LD    A,(SYSVAR_BPERL)          ;[00F0] 
    SRL   A                         ;[00F3] 
    ADD   HL,HL                     ;[00F5] 
    SRL   A                         ;[00F6] 
    JR    NZ,$00F5                  ;[00F8] 
    LD    A,(SYSVAR_CURSORX)        ;[00FA] 
    RRCA                            ;[00FD] 
    RRCA                            ;[00FE] 
    AND   $3F                       ;[00FF] 
    LD    C,A                       ;[0101] 
    LD    B,$00                     ;[0102] 
    ADD   HL,BC                     ;[0104] 
    LD    A,(SYSVAR_CURSORX)        ;[0105] 
    AND   $03                       ;[0108] 
    JR    Z,$0117                   ;[010A] 
    DEC   A                         ;[010C] 
    JR    Z,$0114                   ;[010D] 
    DEC   A                         ;[010F] 
    JR    Z,$0125                   ;[0110] 
    JR    $011A                     ;[0112] 
    JP    $014B                     ;[0114] 
    JP    $0130                     ;[0117] 
    PUSH  HL                        ;[011A] 
    PUSH  DE                        ;[011B] 
    CALL  $0181                     ;[011C] 
    POP   DE                        ;[011F] 
    POP   HL                        ;[0120] 
    INC   HL                        ;[0121] 
    JP    $0164                     ;[0122] 
    PUSH  HL                        ;[0125] 
    PUSH  DE                        ;[0126] 
    CALL  $01B9                     ;[0127] 
    POP   DE                        ;[012A] 
    POP   HL                        ;[012B] 
    INC   HL                        ;[012C] 
    JP    $019E                     ;[012D] 
    LD    B,$0A                     ;[0130] 
    PUSH  BC                        ;[0132] 
    LD    A,(SYSVAR_MASK)           ;[0133] 
    OR    $03                       ;[0136] 
    LD    C,A                       ;[0138] 
    LD    A,(DE)                    ;[0139] 
    RLCA                            ;[013A] 
    RLCA                            ;[013B] 
    AND   $FC                       ;[013C] 
    CALL  SYSVAR_OUTB               ;[013E] 
    LD    BC,(SYSVAR_BPERL)         ;[0141] 
    ADD   HL,BC                     ;[0145] 
    INC   DE                        ;[0146] 
    POP   BC                        ;[0147] 
    DJNZ  $0132                     ;[0148] 
    RET                             ;[014A] 

    LD    B,$0A                     ;[014B] 
    PUSH  BC                        ;[014D] 
    LD    A,(SYSVAR_MASK)           ;[014E] 
    OR    $C0                       ;[0151] 
    LD    C,A                       ;[0153] 
    LD    A,(DE)                    ;[0154] 
    AND   $3F                       ;[0155] 
    CALL  SYSVAR_OUTB               ;[0157] 
    LD    BC,(SYSVAR_BPERL)         ;[015A] 
    ADD   HL,BC                     ;[015E] 
    INC   DE                        ;[015F] 
    POP   BC                        ;[0160] 
    DJNZ  $014D                     ;[0161] 
    RET                             ;[0163] 

    LD    B,$0A                     ;[0164] 
    PUSH  BC                        ;[0166] 
    LD    A,(SYSVAR_MASK)           ;[0167] 
    OR    $0F                       ;[016A] 
    LD    C,A                       ;[016C] 
    LD    A,(DE)                    ;[016D] 
    RLCA                            ;[016E] 
    RLCA                            ;[016F] 
    RLCA                            ;[0170] 
    RLCA                            ;[0171] 
    AND   $F0                       ;[0172] 
    CALL  SYSVAR_OUTB               ;[0174] 
    LD    BC,(SYSVAR_BPERL)         ;[0177] 
    ADD   HL,BC                     ;[017B] 
    INC   DE                        ;[017C] 
    POP   BC                        ;[017D] 
    DJNZ  $0166                     ;[017E] 
    RET                             ;[0180] 

    LD    B,$0A                     ;[0181] 
    PUSH  BC                        ;[0183] 
    LD    A,(SYSVAR_MASK)           ;[0184] 
    OR    $FC                       ;[0187] 
    LD    C,A                       ;[0189] 
    LD    A,(DE)                    ;[018A] 
    RLCA                            ;[018B] 
    RLCA                            ;[018C] 
    RLCA                            ;[018D] 
    RLCA                            ;[018E] 
    AND   $03                       ;[018F] 
    CALL  SYSVAR_OUTB               ;[0191] 
    LD    BC,(SYSVAR_BPERL)         ;[0194] 
    ADD   HL,BC                     ;[0198] 
    INC   DE                        ;[0199] 
    POP   BC                        ;[019A] 
    DJNZ  $0183                     ;[019B] 
    RET                             ;[019D] 

    LD    B,$0A                     ;[019E] 
    PUSH  BC                        ;[01A0] 
    LD    A,(SYSVAR_MASK)           ;[01A1] 
    OR    $3F                       ;[01A4] 
    LD    C,A                       ;[01A6] 
    LD    A,(DE)                    ;[01A7] 
    RRCA                            ;[01A8] 
    RRCA                            ;[01A9] 
    AND   $C0                       ;[01AA] 
    CALL  SYSVAR_OUTB               ;[01AC] 
    LD    BC,(SYSVAR_BPERL)         ;[01AF] 
    ADD   HL,BC                     ;[01B3] 
    INC   DE                        ;[01B4] 
    POP   BC                        ;[01B5] 
    DJNZ  $01A0                     ;[01B6] 
    RET                             ;[01B8] 

    LD    B,$0A                     ;[01B9] 
    PUSH  BC                        ;[01BB] 
    LD    A,(SYSVAR_MASK)           ;[01BC] 
    OR    $F0                       ;[01BF] 
    LD    C,A                       ;[01C1] 
    LD    A,(DE)                    ;[01C2] 
    RRCA                            ;[01C3] 
    RRCA                            ;[01C4] 
    AND   $0F                       ;[01C5] 
    CALL  SYSVAR_OUTB               ;[01C7] 
    LD    BC,(SYSVAR_BPERL)         ;[01CA] 
    ADD   HL,BC                     ;[01CE] 
    INC   DE                        ;[01CF] 
    POP   BC                        ;[01D0] 
    DJNZ  $01BB                     ;[01D1] 
    RET                             ;[01D3] 


DATA_CHARS:
    defb 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00        ;[01D4]
    defb 0x00,0x00,0x00,0x08,0x08,0x08,0x08,0x08        ;[01DC]
    defb 0x00,0x08,0x00,0x00,0x00,0x0A,0x0A,0x00        ;[01E4]
    defb 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0A        ;[01EC]
    defb 0x0A,0x1F,0x0A,0x1F,0x0A,0x0A,0x00,0x00        ;[01F4]
    defb 0x00,0x04,0x0E,0x14,0x0E,0x05,0x15,0x0E        ;[01FC]
    defb 0x04,0x00,0x00,0x00,0x18,0x19,0x02,0x04        ;[0204]
    defb 0x08,0x13,0x03,0x00,0x00,0x08,0x14,0x14        ;[020C]
    defb 0x08,0x15,0x12,0x0D,0x00,0x00,0x00,0x0C        ;[0214]
    defb 0x04,0x08,0x00,0x00,0x00,0x00,0x00,0x00        ;[021C]
    defb 0x00,0x02,0x04,0x04,0x04,0x04,0x04,0x02        ;[0224]
    defb 0x00,0x00,0x00,0x10,0x08,0x08,0x08,0x08        ;[022C]
    defb 0x08,0x10,0x00,0x00,0x00,0x00,0x00,0x0A        ;[0234]
    defb 0x04,0x1F,0x04,0x0A,0x00,0x00,0x00,0x00        ;[023C]
    defb 0x00,0x04,0x04,0x1F,0x04,0x04,0x00,0x00        ;[0244]
    defb 0x00,0x00,0x00,0x00,0x00,0x00,0x18,0x08        ;[024C]
    defb 0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x1F        ;[0254]
    defb 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00        ;[025C]
    defb 0x00,0x00,0x0C,0x0C,0x00,0x00,0x00,0x00        ;[0264]
    defb 0x01,0x02,0x04,0x08,0x10,0x00,0x00,0x00        ;[026C]
    defb 0x00,0x0E,0x11,0x13,0x15,0x19,0x11,0x0E        ;[0274]
    defb 0x00,0x00,0x00,0x04,0x0C,0x04,0x04,0x04        ;[027C]
    defb 0x04,0x0E,0x00,0x00,0x00,0x0E,0x11,0x01        ;[0284]
    defb 0x0E,0x10,0x10,0x1F,0x00,0x00,0x00,0x0E        ;[028C]
    defb 0x11,0x01,0x06,0x01,0x11,0x0E,0x00,0x00        ;[0294]
    defb 0x00,0x10,0x10,0x12,0x12,0x1F,0x02,0x02        ;[029C]
    defb 0x00,0x00,0x00,0x1F,0x10,0x1E,0x01,0x01        ;[02A4]
    defb 0x11,0x0E,0x00,0x00,0x00,0x06,0x08,0x10        ;[02AC]
    defb 0x1E,0x11,0x11,0x0E,0x00,0x00,0x00,0x1F        ;[02B4]
    defb 0x01,0x02,0x04,0x08,0x08,0x08,0x00,0x00        ;[02BC]
    defb 0x00,0x0E,0x11,0x11,0x0E,0x11,0x11,0x0E        ;[02C4]
    defb 0x00,0x00,0x00,0x0E,0x11,0x11,0x0F,0x01        ;[02CC]
    defb 0x02,0x0C,0x00,0x00,0x00,0x00,0x00,0x18        ;[02D4]
    defb 0x18,0x00,0x18,0x18,0x00,0x00,0x00,0x00        ;[02DC]
    defb 0x00,0x18,0x18,0x00,0x18,0x08,0x10,0x00        ;[02E4]
    defb 0x00,0x00,0x00,0x04,0x08,0x10,0x08,0x04        ;[02EC]
    defb 0x00,0x00,0x00,0x00,0x00,0x00,0x1E,0x00        ;[02F4]
    defb 0x1E,0x00,0x00,0x00,0x00,0x00,0x00,0x10        ;[02FC]
    defb 0x08,0x04,0x08,0x10,0x00,0x00,0x00,0x0E        ;[0304]
    defb 0x11,0x01,0x06,0x04,0x00,0x04,0x00,0x00        ;[030C]
    defb 0x00,0x0E,0x13,0x15,0x15,0x16,0x10,0x0E        ;[0314]
    defb 0x00,0x00,0x00,0x04,0x0A,0x11,0x11,0x1F        ;[031C]
    defb 0x11,0x11,0x00,0x00,0x00,0x1E,0x11,0x1E        ;[0324]
    defb 0x11,0x11,0x11,0x1E,0x00,0x00,0x00,0x0E        ;[032C]
    defb 0x11,0x10,0x10,0x10,0x11,0x0E,0x00,0x00        ;[0334]
    defb 0x00,0x1C,0x12,0x11,0x11,0x11,0x11,0x1E        ;[033C]
    defb 0x00,0x00,0x00,0x1F,0x10,0x1E,0x10,0x10        ;[0344]
    defb 0x10,0x1F,0x00,0x00,0x00,0x1F,0x10,0x1E        ;[034C]
    defb 0x10,0x10,0x10,0x10,0x00,0x00,0x00,0x0E        ;[0354]
    defb 0x11,0x10,0x17,0x11,0x11,0x0F,0x00,0x00        ;[035C]
    defb 0x00,0x11,0x11,0x1F,0x11,0x11,0x11,0x11        ;[0364]
    defb 0x00,0x00,0x00,0x0E,0x04,0x04,0x04,0x04        ;[036C]
    defb 0x04,0x0E,0x00,0x00,0x00,0x0F,0x02,0x02        ;[0374]
    defb 0x02,0x02,0x12,0x0C,0x00,0x00,0x00,0x11        ;[037C]
    defb 0x12,0x14,0x18,0x14,0x12,0x11,0x00,0x00        ;[0384]
    defb 0x00,0x10,0x10,0x10,0x10,0x10,0x10,0x1F        ;[038C]
    defb 0x00,0x00,0x00,0x11,0x1B,0x15,0x11,0x11        ;[0394]
    defb 0x11,0x11,0x00,0x00,0x00,0x11,0x19,0x15        ;[039C]
    defb 0x13,0x11,0x11,0x11,0x00,0x00,0x00,0x0E        ;[03A4]
    defb 0x11,0x11,0x11,0x11,0x11,0x0E,0x00,0x00        ;[03AC]
    defb 0x00,0x1E,0x11,0x11,0x1E,0x10,0x10,0x10        ;[03B4]
    defb 0x00,0x00,0x00,0x0E,0x11,0x11,0x11,0x15        ;[03BC]
    defb 0x12,0x0D,0x00,0x00,0x00,0x1E,0x11,0x11        ;[03C4]
    defb 0x1E,0x14,0x12,0x11,0x00,0x00,0x00,0x0E        ;[03CC]
    defb 0x11,0x10,0x0E,0x01,0x11,0x0E,0x00,0x00        ;[03D4]
    defb 0x00,0x1F,0x04,0x04,0x04,0x04,0x04,0x04        ;[03DC]
    defb 0x00,0x00,0x00,0x11,0x11,0x11,0x11,0x11        ;[03E4]
    defb 0x13,0x0D,0x00,0x00,0x00,0x11,0x11,0x11        ;[03EC]
    defb 0x11,0x11,0x0A,0x04,0x00,0x00,0x00,0x11        ;[03F4]
    defb 0x11,0x11,0x11,0x15,0x1B,0x11,0x00,0x00        ;[03FC]
    defb 0x00,0x11,0x11,0x0A,0x04,0x0A,0x11,0x11        ;[0404]
    defb 0x00,0x00,0x00,0x11,0x11,0x0A,0x04,0x04        ;[040C]
    defb 0x04,0x04,0x00,0x00,0x00,0x1F,0x01,0x02        ;[0414]
    defb 0x04,0x08,0x10,0x1F,0x00,0x00,0x00,0x0E        ;[041C]
    defb 0x08,0x08,0x08,0x08,0x08,0x0E,0x00,0x00        ;[0424]
    defb 0x00,0x00,0x10,0x08,0x04,0x02,0x01,0x00        ;[042C]
    defb 0x00,0x00,0x00,0x1C,0x04,0x04,0x04,0x04        ;[0434]
    defb 0x04,0x1C,0x00,0x00,0x00,0x03,0x04,0x09        ;[043C]
    defb 0x0A,0x0A,0x09,0x04,0x03,0x00,0x00,0x00        ;[0444]
    defb 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3F        ;[044C]
    defb 0x00,0x06,0x09,0x08,0x1E,0x08,0x08,0x0F        ;[0454]
    defb 0x00,0x00,0x00,0x00,0x00,0x0D,0x13,0x11        ;[045C]
    defb 0x11,0x0F,0x00,0x00,0x00,0x10,0x10,0x16        ;[0464]
    defb 0x19,0x11,0x11,0x1E,0x00,0x00,0x00,0x00        ;[046C]
    defb 0x00,0x0E,0x10,0x10,0x10,0x0E,0x00,0x00        ;[0474]
    defb 0x00,0x01,0x01,0x0D,0x13,0x11,0x11,0x0F        ;[047C]
    defb 0x00,0x00,0x00,0x00,0x00,0x0E,0x11,0x1F        ;[0484]
    defb 0x10,0x0E,0x00,0x00,0x00,0x06,0x09,0x08        ;[048C]
    defb 0x1E,0x08,0x08,0x08,0x00,0x00,0x00,0x00        ;[0494]
    defb 0x00,0x0D,0x13,0x11,0x11,0x0F,0x01,0x0E        ;[049C]
    defb 0x00,0x10,0x10,0x16,0x19,0x11,0x11,0x11        ;[04A4]
    defb 0x00,0x00,0x00,0x00,0x04,0x00,0x04,0x04        ;[04AC]
    defb 0x04,0x04,0x00,0x00,0x00,0x00,0x02,0x00        ;[04B4]
    defb 0x02,0x02,0x02,0x02,0x12,0x0C,0x00,0x10        ;[04BC]
    defb 0x10,0x12,0x14,0x1C,0x12,0x11,0x00,0x00        ;[04C4]
    defb 0x00,0x08,0x08,0x08,0x08,0x08,0x08,0x06        ;[04CC]
    defb 0x00,0x00,0x00,0x00,0x00,0x1A,0x15,0x15        ;[04D4]
    defb 0x15,0x15,0x00,0x00,0x00,0x00,0x00,0x16        ;[04DC]
    defb 0x19,0x11,0x11,0x11,0x00,0x00,0x00,0x00        ;[04E4]
    defb 0x00,0x0E,0x11,0x11,0x11,0x0E,0x00,0x00        ;[04EC]
    defb 0x00,0x00,0x00,0x16,0x19,0x11,0x11,0x1E        ;[04F4]
    defb 0x10,0x10,0x00,0x00,0x00,0x0D,0x13,0x11        ;[04FC]
    defb 0x11,0x0F,0x01,0x01,0x00,0x00,0x00,0x16        ;[0504]
    defb 0x19,0x10,0x10,0x10,0x00,0x00,0x00,0x00        ;[050C]
    defb 0x00,0x0E,0x10,0x0E,0x01,0x0E,0x00,0x00        ;[0514]
    defb 0x00,0x00,0x08,0x1F,0x08,0x08,0x09,0x06        ;[051C]
    defb 0x00,0x00,0x00,0x00,0x00,0x11,0x11,0x11        ;[0524]
    defb 0x13,0x0D,0x00,0x00,0x00,0x00,0x00,0x11        ;[052C]
    defb 0x11,0x11,0x0A,0x04,0x00,0x00,0x00,0x00        ;[0534]
    defb 0x00,0x11,0x11,0x15,0x1B,0x11,0x00,0x00        ;[053C]
    defb 0x00,0x00,0x00,0x11,0x0A,0x04,0x0A,0x11        ;[0544]
    defb 0x00,0x00,0x00,0x00,0x00,0x11,0x11,0x11        ;[054C]
    defb 0x11,0x0F,0x01,0x0E,0x00,0x00,0x00,0x1F        ;[0554]
    defb 0x02,0x04,0x08,0x1F,0x00,0x00,0x00,0x00        ;[055C]
    defb 0x00,0x04,0x02,0x1F,0x02,0x04,0x00,0x00        ;[0564]
    defb 0x00,0x00,0x00,0x04,0x08,0x1F,0x08,0x04        ;[056C]
    defb 0x00,0x00,0x00,0x00,0x00,0x04,0x0E,0x15        ;[0574]
    defb 0x04,0x04,0x00,0x00,0x00,0x00,0x00,0x04        ;[057C]
    defb 0x04,0x15,0x0E,0x04,0x00,0x00,0x00,0x30        ;[0584]
    defb 0x08,0x24,0x04,0x04,0x24,0x08,0x30,0x00        ;[058C]
    defb 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00        ;[0594]
    defb 0x00,0x00,0x38,0x38,0x38,0x38,0x38,0x00        ;[059C]
    defb 0x00,0x00,0x00,0x00,0x07,0x07,0x07,0x07        ;[05A4]
    defb 0x07,0x00,0x00,0x00,0x00,0x00,0x3F,0x3F        ;[05AC]
    defb 0x3F,0x3F,0x3F,0x00,0x00,0x00,0x00,0x00        ;[05B4]
    defb 0x00,0x00,0x00,0x00,0x00,0x38,0x38,0x38        ;[05BC]
    defb 0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38        ;[05C4]
    defb 0x38,0x38,0x38,0x38,0x07,0x07,0x07,0x07        ;[05CC]
    defb 0x07,0x38,0x38,0x38,0x38,0x38,0x3F,0x3F        ;[05D4]
    defb 0x3F,0x3F,0x3F,0x38,0x38,0x38,0x38,0x38        ;[05DC]
    defb 0x00,0x00,0x00,0x00,0x00,0x07,0x07,0x07        ;[05E4]
    defb 0x07,0x07,0x38,0x38,0x38,0x38,0x38,0x07        ;[05EC]
    defb 0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07        ;[05F4]
    defb 0x07,0x07,0x07,0x07,0x07,0x07,0x3F,0x3F        ;[05FC]
    defb 0x3F,0x3F,0x3F,0x07,0x07,0x07,0x07,0x07        ;[0604]
    defb 0x00,0x00,0x00,0x00,0x00,0x3F,0x3F,0x3F        ;[060C]
    defb 0x3F,0x3F,0x38,0x38,0x38,0x38,0x38,0x3F        ;[0614]
    defb 0x3F,0x3F,0x3F,0x3F,0x07,0x07,0x07,0x07        ;[061C]
    defb 0x07,0x3F,0x3F,0x3F,0x3F,0x3F,0x3F,0x3F        ;[0624]
    defb 0x3F,0x3F,0x3F,0x3F,0x3F,0x3F,0x3F,0x3F        ;[062C]
    defb 0x2A,0x2A,0x2A,0x2A,0x2A,0x2A,0x2A,0x2A        ;[0634]
    defb 0x2A,0x2A,0x3F,0x00,0x3F,0x00,0x3F,0x00        ;[063C]
    defb 0x3F,0x00,0x3F,0x00,0x2A,0x15,0x2A,0x15        ;[0644]
    defb 0x2A,0x15,0x2A,0x15,0x2A,0x15,0x1E,0x08        ;[064C]
    defb 0x08,0x08,0x08,0x08,0x08,0x1F,0x00,0x00        ;[0654]
    defb 0x3B,0x11,0x0A,0x04,0x04,0x24,0x24,0x2E        ;[065C]
    defb 0x00,0x00,0x38,0x0C,0x0A,0x09,0x08,0x08        ;[0664]
    defb 0x08,0x1C,0x00,0x00,0x3F,0x12,0x11,0x10        ;[066C]
    defb 0x30,0x11,0x12,0x17,0x00,0x00,0x1C,0x08        ;[0674]
    defb 0x10,0x20,0x20,0x10,0x08,0x1C,0x00,0x00        ;[067C]
    defb 0x03,0x1B,0x18,0x00,0x37,0x37,0x07,0x07        ;[0684]
    defb 0x00,0x00,0x00,0x00,0x18,0x18,0x00,0x00        ;[068C]
    defb 0x00,0x00,0x00,0x00                            ;[0694]

    LD    (SYSVAR_INKST),A          ;[0698] Output routine.
    LD    (HL),$00                  ;[069B] 
    JR    $06C9                     ;[069D] 
    LD    (SYSVAR_PAPST),A          ;[069F] 
    JR    $069B                     ;[06A2] 
    PUSH  AF                        ;[06A4] 
    PUSH  HL                        ;[06A5] 
    PUSH  DE                        ;[06A6] 
    PUSH  BC                        ;[06A7] 
    LD    HL,SYSVAR_LASTDSP         ;[06A8] 
    DEC   (HL)                      ;[06AB] 
    JR    Z,$0698                   ;[06AC] 
    DEC   (HL)                      ;[06AE] 
    JR    Z,$069F                   ;[06AF] 
    LD    (HL),A                    ;[06B1] 
    CP    $20                       ;[06B2] 
    JR    C,$06CE                   ;[06B4] 
    CALL  SYSVAR_VIDEO              ;[06B6] 
    CALL  $0746                     ;[06B9] 
    LD    (SYSVAR_CURSORX),DE       ;[06BC] 
    LD    A,(SYSVAR_CURSTAT)        ;[06C0] 
    OR    A                         ;[06C3] 
    LD    A,$5F                     ;[06C4] 
    CALL  NZ,SYSVAR_VIDEO           ;[06C6] 
    POP   BC                        ;[06C9] 
    POP   DE                        ;[06CA] 
    POP   HL                        ;[06CB] 
    POP   AF                        ;[06CC] 

VDU1_VDU2:
    RET                             ;[06CD] VDU 1 Changes INK to specified colour; VDU 2 Changes PAPER to specified colour

    PUSH  AF                        ;[06CE] Special/normal character routine
    LD    A,(SYSVAR_CURSTAT)        ;[06CF] 
    OR    A                         ;[06D2] 
    LD    A,$20                     ;[06D3] 
    CALL  NZ,SYSVAR_VIDEO           ;[06D5] 
    POP   AF                        ;[06D8] 
    LD    HL,$06C0                  ;[06D9] 
    PUSH  HL                        ;[06DC] 
    LD    HL,DATA_VDU_ROUTINES      ;[06DD] 
    RLCA                            ;[06E0] 
    LD    E,A                       ;[06E1] 
    LD    D,$00                     ;[06E2] 
    ADD   HL,DE                     ;[06E4] 
    LD    A,(HL)                    ;[06E5] 
    INC   HL                        ;[06E6] 
    LD    H,(HL)                    ;[06E7] 
    LD    L,A                       ;[06E8] 
    JP    (HL)                      ;[06E9] 

DATA_VDU_ROUTINES:
    defb 0xCD,0x06,0xCD,0x06,0xCD,0x06,0xCD,0x06        ;[06EA]
    defb 0x62,0x07,0x0C,0x08,0x87,0x07,0x2D,0x09        ;[06F2]
    defb 0x20,0x08,0xA2,0x07,0x7E,0x07,0xCD,0x06        ;[06FA]
    defb 0xC5,0x0D,0x7B,0x07,0x28,0x08,0x2E,0x08        ;[0702]
    defb 0x68,0x07,0xCD,0x06,0x3C,0x07,0x6F,0x07        ;[070A]
    defb 0x34,0x07,0x36,0x07,0xDE,0x07,0x65,0x07        ;[0712]
    defb 0x2A,0x07,0x30,0x07,0xCD,0x06,0xCD,0x06        ;[071A]
    defb 0x10,0x08,0x8B,0x07,0xC1,0x07,0x7B,0x07        ;[0722]


VDU_24:
    LD    A,$40                     ;[072A] Turns double height characters on
    LD    (SYSVAR_BPERL),A          ;[072C] 
    RET                             ;[072F] 

VDU_25:
    LD    A,$20                     ;[0730] Turns double height characters off
    JR    $072C                     ;[0732] 

VDU_20:
    XOR   A                         ;[0734] Overwrite on
    LD    BC,$FF3E                  ;[0735] 
    LD    (SYSVAR_MASK),A           ;[0738] 
    RET                             ;[073B] 

VDU_18:
    LD    HL,(SYSVAR_INKST)         ;[073C] Swaps ink and paper
    LD    A,L                       ;[073F] 
    LD    L,H                       ;[0740] 
    LD    H,A                       ;[0741] 
    LD    (SYSVAR_INKST),HL         ;[0742] 
    RET                             ;[0745] 

    LD    HL,(SYSVAR_WINDST)        ;[0746] Move cursor over 1 character
    LD    DE,(SYSVAR_CURSORX)       ;[0749] 
    LD    A,E                       ;[074D] 
    ADD   A,$03                     ;[074E] 
    LD    E,A                       ;[0750] 
    CP    H                         ;[0751] 
    RET   C                         ;[0752] 
    LD    E,L                       ;[0753] 
    LD    HL,($6258)                ;[0754] 
    LD    A,D                       ;[0757] 
    CALL  SYSVAR_SLFRAM             ;[0758] 
    ADD   A,$0A                     ;[075B] 
    LD    D,A                       ;[075D] 
    CP    H                         ;[075E] 
    RET   C                         ;[075F] 
    LD    D,L                       ;[0760] 
    RET                             ;[0761] 

VDU_4:
    CALL  $08E5                     ;[0762] Clears screen and homes cursor
VDU_23:
    CALL  $079B                     ;[0765] Homes cursor (takes cursor inside of window)
VDU_16:
    LD    A,($6258)                 ;[0768] Moves cursor to top of screen
    LD    (SYSVAR_CURSORY),A        ;[076B] 
    RET                             ;[076E] 

VDU_19:
    LD    HL,(SYSVAR_WINDST)        ;[076F] Carriage return, linefeed, if cursor is not at beginning of line
    LD    A,(SYSVAR_CURSORX)        ;[0772] 
    CP    L                         ;[0775] 
    RET   Z                         ;[0776] 
    LD    A,$0D                     ;[0777] 
    RST   $08                       ;[0779] 
    RET                             ;[077A] 

VDU_13_31:
    CALL  $079B                     ;[077B] Carriage return, linefeed, clears to end of line
VDU_10:
    LD    DE,(SYSVAR_CURSORX)       ;[077E] Line feed (moves cursor down 10 pixel lines)
    CALL  $0754                     ;[0782] 
    JR    $07E1                     ;[0785] 

VDU_6:
    LD    C,$01                     ;[0787] Moves cursor down one pixel
    JR    $078D                     ;[0789] 

VDU_29:
    LD    C,$03                     ;[078B] Moves cursor down 3 pixels
    LD    DE,(SYSVAR_CURSORX)       ;[078D] 
    LD    HL,($6258)                ;[0791] 
    LD    A,D                       ;[0794] 
    ADD   A,C                       ;[0795] 
    CALL  $075D                     ;[0796] 
    JR    $07E1                     ;[0799] 
    LD    A,(SYSVAR_WINDST)         ;[079B] Move cursor to left hand column of the WINDOW.
    LD    (SYSVAR_CURSORX),A        ;[079E] 
    RET                             ;[07A1] 

VDU_9:
    LD    A,(SYSVAR_CURSORX)        ;[07A2] Tabs cursor to next field
    INC   A                         ;[07A5] 
    LD    HL,$07BB                  ;[07A6] 
    INC   HL                        ;[07A9] 
    CP    (HL)                      ;[07AA] 
    JR    NC,$07A9                  ;[07AB] 
    LD    H,(HL)                    ;[07AD] 
    INC   H                         ;[07AE] 
    JR    Z,VDU_13_31               ;[07AF] 
    DEC   H                         ;[07B1] 
    LD    A,$20                     ;[07B2] 
    RST   $08                       ;[07B4] 
    LD    A,(SYSVAR_CURSORX)        ;[07B5] 
    CP    H                         ;[07B8] 
    RET   NC                        ;[07B9] 
    JR    $07B2                     ;[07BA] 
    DEC   DE                        ;[07BC] 
    INC   SP                        ;[07BD] 
    LD    C,E                       ;[07BE] 
    LD    H,E                       ;[07BF] 
    RST   $38                       ;[07C0] 

VDU_30:
    LD    A,($6257)                 ;[07C1] Clears to end of line
    DEC   A                         ;[07C4] 
    LD    HL,(SYSVAR_CURSORX)       ;[07C5] 
    PUSH  HL                        ;[07C8] 
    LD    (SYSVAR_CURSORX),HL       ;[07C9] 
    PUSH  HL                        ;[07CC] 
    PUSH  AF                        ;[07CD] 
    LD    A,$20                     ;[07CE] 
    CALL  SYSVAR_VIDEO              ;[07D0] 
    POP   AF                        ;[07D3] 
    POP   HL                        ;[07D4] 
    INC   L                         ;[07D5] 
    INC   L                         ;[07D6] 
    INC   L                         ;[07D7] 
    CP    L                         ;[07D8] 
    JR    NC,$07C9                  ;[07D9] 
    POP   DE                        ;[07DB] 
    JR    $07E1                     ;[07DC] 

VDU_22:
    CALL  $07E6                     ;[07DE] Backspace cursor
    LD    (SYSVAR_CURSORX),DE       ;[07E1] 
    RET                             ;[07E5] 

    LD    HL,(SYSVAR_WINDST)        ;[07E6] Called by backspace routine.
    LD    DE,(SYSVAR_CURSORX)       ;[07E9] 
    DEC   L                         ;[07ED] 
    LD    B,$03                     ;[07EE] 
    DEC   E                         ;[07F0] 
    LD    A,E                       ;[07F1] 
    CP    L                         ;[07F2] 
    JR    Z,$07F8                   ;[07F3] 
    DJNZ  $07F0                     ;[07F5] 
    RET                             ;[07F7] 

    LD    E,H                       ;[07F8] 
    DEC   E                         ;[07F9] 
    DEC   E                         ;[07FA] 
    DEC   E                         ;[07FB] 
    LD    HL,($6258)                ;[07FC] 
    LD    A,D                       ;[07FF] 
    SUB   $0A                       ;[0800] 
    LD    D,A                       ;[0802] 
    SUB   L                         ;[0803] 
    CP    $F6                       ;[0804] 
    RET   C                         ;[0806] 
    LD    A,H                       ;[0807] 
    SUB   $0A                       ;[0808] 
    LD    D,A                       ;[080A] 
    RET                             ;[080B] 

VDU_5:
    LD    C,$01                     ;[080C] Moves cursor up one pixel
    JR    $0812                     ;[080E] 

VDU_28:
    LD    C,$03                     ;[0810] Moves cursor up 3 pixels 
    LD    DE,(SYSVAR_CURSORX)       ;[0812] 
    LD    HL,($6258)                ;[0816] 
    LD    A,D                       ;[0819] 
    SUB   C                         ;[081A] 
    CALL  $0802                     ;[081B] 
    JR    $07E1                     ;[081E] 

VDU_8:
    CALL  VDU_22                    ;[0820] Backspace and erase character
    LD    A,$20                     ;[0823] 
    JP    SYSVAR_VIDEO              ;[0825] 

VDU_14:
    LD    A,$01                     ;[0828] Turns cursor on
    LD    (SYSVAR_CURSTAT),A        ;[082A] 
    RET                             ;[082D] 

VDU_15:
    XOR   A                         ;[082E] Turns cursor off
    JR    $082A                     ;[082F] 

BASIC_COM_WINDOW:
    LD    B,$04                     ;[0831] WINDOW routine.
    LD    HL,SYSVAR_WINDST          ;[0833] 
    PUSH  HL                        ;[0836] 
    PUSH  BC                        ;[0837] 
    CALL  SUB_ARGUMENT              ;[0838] 
    INC   DE                        ;[083B] 
    LD    A,L                       ;[083C] 
    POP   BC                        ;[083D] 
    POP   HL                        ;[083E] 
    LD    (HL),A                    ;[083F] 
    INC   HL                        ;[0840] 
    DJNZ  $0836                     ;[0841] 
    RET                             ;[0843] 

    EXX                             ;[0844] A routine to decide which bits need to be set. Used in the output of characters to the screen.
    XOR   A                         ;[0845] 
    SRL   H                         ;[0846] 
    ADC   A,A                       ;[0848] 
    SRL   L                         ;[0849] 
    ADC   A,A                       ;[084B] 
    EXX                             ;[084C] 
    JR    Z,$085C                   ;[084D] 
    DEC   A                         ;[084F] 
    RET   Z                         ;[0850] 
    DEC   A                         ;[0851] 
    JR    Z,$0859                   ;[0852] 
    LD    A,$FF                     ;[0854] 
    XOR   E                         ;[0856] 
    LD    D,A                       ;[0857] 
    RET                             ;[0858] 

    LD    A,D                       ;[0859] 
    OR    E                         ;[085A] 
    CPL                             ;[085B] 
    LD    D,A                       ;[085C] 
    RET                             ;[085D] 

    EXX                             ;[085E] via OUTB - outputs byte with data in A, mask in C and relative displacement from top left in HL. Uses colour selected by INK and PAPER.
    EX    AF,AF'                    ;[085F] 
    PUSH  AF                        ;[0860] 
    EX    AF,AF'                    ;[0861] 
    PUSH  HL                        ;[0862] 
    LD    HL,(SYSVAR_INKST)         ;[0863] 
    EXX                             ;[0866] 
    PUSH  DE                        ;[0867] 
    LD    E,C                       ;[0868] 
    LD    D,A                       ;[0869] 
    PUSH  DE                        ;[086A] 
    CALL  $0844                     ;[086B] Output a byte to vdu ram.
    LD    A,(SYSVAR_PROTST)         ;[086E] 
    RRCA                            ;[0871] 
    JR    C,$0880                   ;[0872] 
    LD    A,$E8                     ;[0874] 
    EX    AF,AF'                    ;[0876] 
    LD    A,$63                     ;[0877] 
    LD    BC,(SYSVAR_BLUBNK)        ;[0879] 
    CALL  $08B6                     ;[087D] 
    POP   DE                        ;[0880] 
    PUSH  DE                        ;[0881] 
    CALL  $0844                     ;[0882] 
    LD    A,(SYSVAR_PROTST)         ;[0885] 
    BIT   1,A                       ;[0888] 
    JR    NZ,$0898                  ;[088A] 
    LD    A,$E8                     ;[088C] 
    EX    AF,AF'                    ;[088E] 
    LD    A,$63                     ;[088F] 
    LD    BC,(SYSVAR_REDBNK)        ;[0891] 
    CALL  $08B6                     ;[0895] 
    POP   DE                        ;[0898] 
    CALL  $0844                     ;[0899] 
    LD    A,(SYSVAR_PROTST)         ;[089C] 
    BIT   2,A                       ;[089F] 
    JR    NZ,$08AF                  ;[08A1] 
    LD    A,$E4                     ;[08A3] 
    EX    AF,AF'                    ;[08A5] 
    LD    A,$65                     ;[08A6] 
    LD    BC,(SYSVAR_GRNBNK)        ;[08A8] 
    CALL  $08B6                     ;[08AC] 
    POP   DE                        ;[08AF] 
    EXX                             ;[08B0] 
    POP   HL                        ;[08B1] 
    EXX                             ;[08B2] 
    POP   AF                        ;[08B3] 
    EX    AF,AF'                    ;[08B4] 
    RET                             ;[08B5] 

    PUSH  HL                        ;[08B6] 
    ADD   HL,BC                     ;[08B7] 
    LD    BC,$FF7F                  ;[08B8] 
    OUT   (C),A                     ;[08BB] 
    LD    A,$40                     ;[08BD] 
    OUT   ($80),A                   ;[08BF] 
    EX    AF,AF'                    ;[08C1] 
    OUT   ($80),A                   ;[08C2] 
    LD    A,(HL)                    ;[08C4] 
    AND   E                         ;[08C5] 
    OR    D                         ;[08C6] 
    LD    (HL),A                    ;[08C7] 
    XOR   A                         ;[08C8] 
    OUT   ($80),A                   ;[08C9] 
    OUT   (C),A                     ;[08CB] 
    POP   HL                        ;[08CD] 
    RET                             ;[08CE] 

    LD    BC,$FF7F                  ;[08CF] Called by clear screen routine.
    OUT   (C),A                     ;[08D2] 
    LD    BC,$4000                  ;[08D4] 
    LD    (HL),D                    ;[08D7] 
    DEC   BC                        ;[08D8] 
    INC   HL                        ;[08D9] 
    LD    A,B                       ;[08DA] 
    OR    C                         ;[08DB] 
    JR    NZ,$08D7                  ;[08DC] 
    XOR   A                         ;[08DE] 
    LD    BC,$FF7F                  ;[08DF] 
    OUT   (C),A                     ;[08E2] 
    RET                             ;[08E4] 

    LD    A,$20                     ;[08E5] Called by clear screen routine.
    OUT   ($80),A                   ;[08E7] 
    LD    DE,(SYSVAR_PAPST)         ;[08E9] 
    CALL  $0926                     ;[08ED] 
    LD    A,(SYSVAR_PROTST)         ;[08F0] 
    RRCA                            ;[08F3] 
    JR    C,$08FE                   ;[08F4] 
    LD    HL,(SYSVAR_BLUBNK)        ;[08F6] 
    LD    A,$23                     ;[08F9] 
    CALL  $08CF                     ;[08FB] 
    CALL  $0926                     ;[08FE] 
    LD    A,(SYSVAR_PROTST)         ;[0901] 
    BIT   1,A                       ;[0904] 
    JR    NZ,$0910                  ;[0906] 
    LD    HL,(SYSVAR_REDBNK)        ;[0908] 
    LD    A,$23                     ;[090B] 
    CALL  $08CF                     ;[090D] 
    CALL  $0926                     ;[0910] 
    LD    A,(SYSVAR_PROTST)         ;[0913] 
    BIT   2,A                       ;[0916] 
    JR    NZ,$0922                  ;[0918] 
    LD    HL,(SYSVAR_GRNBNK)        ;[091A] 
    LD    A,$25                     ;[091D] 
    CALL  $08CF                     ;[091F] 
    XOR   A                         ;[0922] 
    OUT   ($80),A                   ;[0923] 
    RET                             ;[0925] 

    LD    D,$00                     ;[0926] Returns D set to FF or 00. Used by CLS.
    SRL   E                         ;[0928] 
    RET   NC                        ;[092A] 
    DEC   D                         ;[092B] 
    RET                             ;[092C] 

VDU_7:
    LD    HL,$00B4                  ;[092D] beeps
    LD    DE,$01C8                  ;[0930] 
    LD    BC,$3F84                  ;[0933] 
    LD    A,$01                     ;[0936] 
    OUT   ($80),A                   ;[0938] 
    JP    $095D                     ;[093A] 

BASIC_COM_BEEP:
    LD    A,$01                     ;[093D] Basic BEEP routine.
    OUT   ($80),A                   ;[093F] 
    CALL  SUB_ARGUMENT              ;[0941] 
    INC   DE                        ;[0944] 
    PUSH  HL                        ;[0945] 
    CALL  SUB_ARGUMENT              ;[0946] 
    INC   DE                        ;[0949] 
    PUSH  HL                        ;[094A] 
    CALL  SUB_ARGUMENT              ;[094B] 

LYNX_BEEP:
    AND   $3F                       ;[094E] Beep routine (see Lynx User 2)
    LD    B,A                       ;[0950] 
    LD    C,$84                     ;[0951] 
    POP   HL                        ;[0953] 
    INC   HL                        ;[0954] 
    POP   DE                        ;[0955] 
    INC   DE                        ;[0956] 
    INC   D                         ;[0957] 
    INC   E                         ;[0958] 
    DEC   E                         ;[0959] 
    JR    NZ,$095D                  ;[095A] 
    INC   E                         ;[095C] 
    XOR   A                         ;[095D] 
    OUT   (C),B                     ;[095E] 
    CALL  LYNX_DELAY                ;[0960] 
    OUT   (C),A                     ;[0963] 
    CALL  LYNX_DELAY                ;[0965] 
    PUSH  BC                        ;[0968] 
    LD    BC,$0080                  ;[0969] 
    IN    B,(C)                     ;[096C] 
    BIT   6,B                       ;[096E] 
    POP   BC                        ;[0970] 
    RET   Z                         ;[0971] 
    DEC   HL                        ;[0972] 
    LD    A,H                       ;[0973] 
    OR    L                         ;[0974] 
    JR    NZ,$095D                  ;[0975] 
    RET                             ;[0977] 

LYNX_DELAY:
    PUSH  DE                        ;[0978] Delay routine (used by Beep)
    DEC   E                         ;[0979] 
    JR    NZ,$0979                  ;[097A] 
    DEC   D                         ;[097C] 
    JR    NZ,$0979                  ;[097D] 
    POP   DE                        ;[097F] 
    RET                             ;[0980] 

BASIC_COM_SOUND:
    LD    A,$01                     ;[0981] SOUND routine.
    OUT   ($80),A                   ;[0983] 
    CALL  SUB_ARGUMENT              ;[0985] 
    INC   DE                        ;[0988] 
    PUSH  HL                        ;[0989] 
    CALL  SUB_ARGUMENT              ;[098A] 
    EX    DE,HL                     ;[098D] 
    INC   D                         ;[098E] 
    POP   HL                        ;[098F] 

LYNX_SOUND:
    LD    A,(HL)                    ;[0990] Sound routine  (see Lynx User 2)
    INC   HL                        ;[0991] 
    AND   $3F                       ;[0992] 
    RET   Z                         ;[0994] 
    OUT   ($84),A                   ;[0995] 
    CALL  LYNX_DELAY                ;[0997] 
    LD    BC,$0080                  ;[099A] 
    IN    B,(C)                     ;[099D] 
    BIT   6,B                       ;[099F] 
    JR    NZ,LYNX_SOUND             ;[09A1] 
    RET                             ;[09A3] 

    LD    HL,SYSVAR_OLDESC          ;[09A4] Test for escape.
    LD    BC,$0080                  ;[09A7] 
    IN    A,(C)                     ;[09AA] 
    CPL                             ;[09AC] 
    AND   $40                       ;[09AD] 
    LD    E,A                       ;[09AF] 
    XOR   (HL)                      ;[09B0] 
    LD    (HL),E                    ;[09B1] 
    AND   E                         ;[09B2] 
    RET   Z                         ;[09B3] 
    CALL  $0089                     ;[09B4] 
    AND   $40                       ;[09B7] 
    RET   Z                         ;[09B9] 
    LD    A,$1B                     ;[09BA] 
    RET                             ;[09BC] 

LYNX_KEYDVR:
    PUSH  HL                        ;[09BD] Keyboard driver. Returns code of key pressed in A. Without single key entries. 
    PUSH  BC                        ;[09BE] 
    PUSH  DE                        ;[09BF] 
    XOR   A                         ;[09C0] 
    LD    (SYSVAR_STATUS),A         ;[09C1] 
    CALL  $09A4                     ;[09C4] 
    JR    NZ,$0A41                  ;[09C7] 
    LD    C,$80                     ;[09C9] 
    LD    B,$0A                     ;[09CB] 
    LD    HL,SYSVAR_OLDKEY          ;[09CD] 
    DEC   B                         ;[09D0] 
    JP    M,$0A4E                   ;[09D1] 
    IN    A,(C)                     ;[09D4] 
    CPL                             ;[09D6] 
    AND   $3F                       ;[09D7] 
    OR    A                         ;[09D9] 
    JR    Z,$09DF                   ;[09DA] 
    LD    (SYSVAR_STATUS),A         ;[09DC] 
    LD    E,A                       ;[09DF] 
    XOR   (HL)                      ;[09E0] 
    LD    (HL),E                    ;[09E1] 
    AND   E                         ;[09E2] 
    INC   HL                        ;[09E3] 
    JR    Z,$09D0                   ;[09E4] 
    LD    C,E                       ;[09E6] 
    PUSH  BC                        ;[09E7] 
    LD    C,$FF                     ;[09E8] 
    INC   C                         ;[09EA] 
    RRCA                            ;[09EB] 
    JR    NC,$09EA                  ;[09EC] 
    LD    A,B                       ;[09EE] 
    RLCA                            ;[09EF] 
    ADD   A,B                       ;[09F0] 
    RLCA                            ;[09F1] 
    ADD   A,C                       ;[09F2] 
    LD    E,A                       ;[09F3] 
    LD    HL,DATA_KEYBOARD          ;[09F4] 
    LD    BC,$0080                  ;[09F7] 
    IN    A,(C)                     ;[09FA] 
    RLCA                            ;[09FC] 
    JR    C,$0A02                   ;[09FD] 
    LD    HL,$0ADF                  ;[09FF] 
    LD    B,$02                     ;[0A02] 
    IN    A,(C)                     ;[0A04] 
    BIT   6,A                       ;[0A06] 
    JR    NZ,$0A0D                  ;[0A08] 
    LD    HL,$0AB2                  ;[0A0A] 
    LD    D,$00                     ;[0A0D] 
    ADD   HL,DE                     ;[0A0F] 
    POP   DE                        ;[0A10] 
    LD    B,D                       ;[0A11] 
    CALL  $0089                     ;[0A12] 
    AND   $3F                       ;[0A15] 
    XOR   E                         ;[0A17] 
    JR    NZ,$0A40                  ;[0A18] 
    LD    A,(HL)                    ;[0A1A] 
    LD    HL,SYSVAR_SHLKT           ;[0A1B] 
    BIT   0,(HL)                    ;[0A1E] 
    CALL  NZ,$0A45                  ;[0A20] 
    BIT   1,(HL)                    ;[0A23] 
    CALL  NZ,$0A4B                  ;[0A25] 
    LD    (SYSVAR_LASTK),A          ;[0A28] 
    LD    C,$02                     ;[0A2B] 
    CP    $03                       ;[0A2D] 
    JR    Z,$0A3B                   ;[0A2F] 
    CP    $83                       ;[0A31] 
    JR    Z,$0A3B                   ;[0A33] 
    LD    C,$01                     ;[0A35] 
    CP    $00                       ;[0A37] 
    JR    NZ,$0A41                  ;[0A39] 
    LD    A,(SYSVAR_SHLKT)          ;[0A3B] 
    XOR   C                         ;[0A3E] 
    LD    (HL),A                    ;[0A3F] 
    XOR   A                         ;[0A40] 
    POP   DE                        ;[0A41] 
    POP   BC                        ;[0A42] 
    POP   HL                        ;[0A43] 
    RET                             ;[0A44] 

    CP    $40                       ;[0A45] 
    RET   C                         ;[0A47] 
    XOR   $20                       ;[0A48] 
    RET                             ;[0A4A] 

    XOR   $80                       ;[0A4B] 
    RET                             ;[0A4D] 

    LD    A,(SYSVAR_STATUS)         ;[0A4E] 
    OR    A                         ;[0A51] 
    LD    HL,(SYSVAR_RPTDLY)        ;[0A52] 
    JR    Z,$0A5F                   ;[0A55] 
    LD    HL,(SYSVAR_RPT)           ;[0A57] 
    DEC   HL                        ;[0A5A] 
    LD    A,H                       ;[0A5B] 
    OR    L                         ;[0A5C] 
    JR    Z,$0A65                   ;[0A5D] 
    LD    (SYSVAR_RPT),HL           ;[0A5F] 
    XOR   A                         ;[0A62] 
    JR    $0A41                     ;[0A63] 
    LD    BC,$1000                  ;[0A65] 
    CALL  $0A70                     ;[0A68] 
    LD    A,(SYSVAR_LASTK)          ;[0A6B] 
    JR    $0A41                     ;[0A6E] 
    DEC   BC                        ;[0A70] 
    LD    A,B                       ;[0A71] 
    OR    C                         ;[0A72] 
    JR    NZ,$0A70                  ;[0A73] 
    RET                             ;[0A75] 


DATA_KEYBOARD:
    defb 0x31,0x2A,0x2A,0x00,0x0B,0x0A,0x33,0x34        ;[0A76]
    defb 0x45,0x58,0x44,0x43,0x32,0x51,0x57,0x5A        ;[0A7E]
    defb 0x53,0x41,0x35,0x52,0x54,0x56,0x47,0x46        ;[0A86]
    defb 0x36,0x59,0x48,0x20,0x4E,0x42,0x37,0x38        ;[0A8E]
    defb 0x55,0x4D,0x2A,0x4A,0x39,0x49,0x4F,0x2C        ;[0A96]
    defb 0x2A,0x4B,0x30,0x50,0x4C,0x2E,0x2A,0x3B        ;[0A9E]
    defb 0x2D,0x40,0x5B,0x2F,0x2A,0x3A,0x08,0x5D        ;[0AA6]
    defb 0x16,0x0D,0x2A,0x0C,0x03,0x00,0x00,0x00        ;[0AAE]
    defb 0x00,0x00,0x1C,0x1D,0x05,0x18,0x04,0x03        ;[0AB6]
    defb 0x1B,0x11,0x17,0x1A,0x13,0x01,0x1E,0x12        ;[0ABE]
    defb 0x14,0x16,0x07,0x06,0x1F,0x19,0x08,0x00        ;[0AC6]
    defb 0x0E,0x02,0x00,0x00,0x15,0x0D,0x00,0x0A        ;[0ACE]
    defb 0x00,0x09,0x0F,0x00,0x00,0x0B,0x00,0x10        ;[0AD6]
    defb 0x0C,0x21,0x2A,0x2A,0x00,0x0B,0x0A,0x23        ;[0ADE]
    defb 0x24,0x65,0x78,0x64,0x63,0x22,0x71,0x77        ;[0AE6]
    defb 0x7A,0x73,0x61,0x25,0x72,0x74,0x76,0x67        ;[0AEE]
    defb 0x66,0x26,0x79,0x68,0x20,0x6E,0x62,0x27        ;[0AF6]
    defb 0x28,0x75,0x6D,0x3F,0x6A,0x29,0x69,0x6F        ;[0AFE]
    defb 0x3C,0x3F,0x6B,0x5F,0x70,0x6C,0x3E,0x3F        ;[0B06]
    defb 0x2B,0x3D,0x60,0x5E,0x3F                       ;[0B0E]

    LD    HL,($082A)                ;[0B13] Find word in a list.
    LD    A,A                       ;[0B16] 
    LD    D,$0D                     ;[0B17] 
    LD    HL,($3A0C)                ;[0B19] 
    LD    ($B762),A                 ;[0B1C] 
    JR    NZ,$0B49                  ;[0B1F] 
    CALL  LYNX_KEYDVR               ;[0B21] 
    CALL  LYNX_ESC                  ;[0B24] 
    RET   NZ                        ;[0B27] 
    RES   5,A                       ;[0B28] 
    CP    $41                       ;[0B2A] 
    RET   C                         ;[0B2C] 
    CP    $5B                       ;[0B2D] 
    RET   NC                        ;[0B2F] 
    SUB   $41                       ;[0B30] 
    LD    HL,SYSVAR_KTBL            ;[0B32] 
    LD    C,A                       ;[0B35] 
    LD    B,$00                     ;[0B36] 
    ADD   HL,BC                     ;[0B38] 
    LD    A,(HL)                    ;[0B39] 
    LD    HL,(SYSVAR_XTTBL)         ;[0B3A] 
    INC   A                         ;[0B3D] 
    LD    B,A                       ;[0B3E] 
    CALL  $1893                     ;[0B3F] 
    LD    (SYSVAR_KSMS),HL          ;[0B42] 
    LD    A,(HL)                    ;[0B45] 
    RES   7,A                       ;[0B46] 
    RET                             ;[0B48] 

    LD    HL,(SYSVAR_KSMS)          ;[0B49] 
    INC   HL                        ;[0B4C] 
    LD    (SYSVAR_KSMS),HL          ;[0B4D] 
    LD    A,(HL)                    ;[0B50] 
    BIT   7,A                       ;[0B51] 
    RET   Z                         ;[0B53] 
    XOR   A                         ;[0B54] 
    LD    ($6232),A                 ;[0B55] 
    LD    A,$20                     ;[0B58] 
    RET                             ;[0B5A] 

    PUSH  HL                        ;[0B5B] Scan for a key.
    PUSH  BC                        ;[0B5C] 
    PUSH  DE                        ;[0B5D] 
    CALL  $0B1B                     ;[0B5E] 
    POP   DE                        ;[0B61] 
    POP   BC                        ;[0B62] 
    POP   HL                        ;[0B63] 
    RET                             ;[0B64] 

LYNX_RSYNC:
    PUSH  BC                        ;[0B65] Reads sync from cassette. 
    LD    A,(SYSVAR_PLYLEV)         ;[0B66] 
    OUT   ($84),A                   ;[0B69] 
    CALL  LYNX_MOTON                ;[0B6B] 
    LD    A,$20                     ;[0B6E] 
    OUT   ($87),A                   ;[0B70] 
    LD    B,$28                     ;[0B72] 
    CALL  LYNX_RBYTE                ;[0B74] 
    OR    A                         ;[0B77] 
    JR    NZ,$0B72                  ;[0B78] 
    DJNZ  $0B74                     ;[0B7A] 
    CALL  SYSVAR_RBIT               ;[0B7C] 
    CP    $A5                       ;[0B7F] 
    JR    NZ,$0B7C                  ;[0B81] 
    POP   BC                        ;[0B83] 
    RET                             ;[0B84] 

LYNX_RBYTE:
    PUSH  BC                        ;[0B85] Reads byte from cassette into A. 
    PUSH  DE                        ;[0B86] 
    LD    B,$08                     ;[0B87] 
    PUSH  BC                        ;[0B89] 
    CALL  SYSVAR_RBIT               ;[0B8A] 
    POP   BC                        ;[0B8D] 
    DJNZ  $0B89                     ;[0B8E] 
    POP   DE                        ;[0B90] 
    POP   BC                        ;[0B91] 
    RET                             ;[0B92] 

LYNX_WSYNC:
    PUSH  BC                        ;[0B93] Writes sync to cassette. 
    PUSH  AF                        ;[0B94] 
    CALL  LYNX_MOTON                ;[0B95] 
    LD    A,$10                     ;[0B98] 
    OUT   ($87),A                   ;[0B9A] 
    LD    A,(SYSVAR_SYNCLEN)        ;[0B9C] 
    LD    B,A                       ;[0B9F] 
    PUSH  BC                        ;[0BA0] 
    LD    B,$00                     ;[0BA1] 
    XOR   A                         ;[0BA3] 
    CALL  SYSVAR_WBYTE              ;[0BA4] 
    DJNZ  $0BA4                     ;[0BA7] 
    POP   BC                        ;[0BA9] 
    DJNZ  $0BA0                     ;[0BAA] 
    LD    A,$A5                     ;[0BAC] 
    CALL  SYSVAR_WBYTE              ;[0BAE] 
    POP   AF                        ;[0BB1] 
    POP   BC                        ;[0BB2] 
    RET                             ;[0BB3] 

    CALL  LYNX_WSYNC                ;[0BB4] 
    LD    A,(DE)                    ;[0BB7] 
    CALL  SYSVAR_WBYTE              ;[0BB8] 
    INC   DE                        ;[0BBB] 
    LD    A,(DE)                    ;[0BBC] 
    CALL  SYSVAR_WBYTE              ;[0BBD] 
    CP    $22                       ;[0BC0] 
    JR    NZ,$0BBB                  ;[0BC2] 
    RET                             ;[0BC4] 

SUB_SAVE:
    CALL  LYNX_MOTOFF               ;[0BC5] Part of SAVE routine.
    CALL  $3B2C                     ;[0BC8] 

BASIC_COM_SAVE:
    CALL  $0BB4                     ;[0BCB] SAVE routine.
    INC   DE                        ;[0BCE] 
    LD    A,(DE)                    ;[0BCF] 
    LD    HL,START                  ;[0BD0] 
    PUSH  HL                        ;[0BD3] 
    CP    $0D                       ;[0BD4] 
    JR    Z,$0BED                   ;[0BD6] 
    POP   HL                        ;[0BD8] 
    INC   DE                        ;[0BD9] 
    CALL  $2059                     ;[0BDA] 
    CALL  LYNX_FNDLN                ;[0BDD] 
    JR    NZ,SUB_SAVE               ;[0BE0] 
    PUSH  IX                        ;[0BE2] 
    POP   HL                        ;[0BE4] 
    LD    DE,(SYSVAR_EOB)           ;[0BE5] 
    OR    A                         ;[0BE9] 
    SBC   HL,DE                     ;[0BEA] 
    PUSH  HL                        ;[0BEC] 
    LD    HL,(SYSVAR_EOB)           ;[0BED] 
    LD    DE,(SYSVAR_SOB)           ;[0BF0] 
    OR    A                         ;[0BF4] 
    SBC   HL,DE                     ;[0BF5] 
    INC   HL                        ;[0BF7] 
    PUSH  HL                        ;[0BF8] 
    LD    HL,(SYSVAR_SOB)           ;[0BF9] 
    CALL  LYNX_WSYNC                ;[0BFC] 
    LD    A,$42                     ;[0BFF] 
    CALL  SYSVAR_WBYTE              ;[0C01] 
    POP   BC                        ;[0C04] 
    LD    A,C                       ;[0C05] 
    CALL  SYSVAR_WBYTE              ;[0C06] 
    LD    A,B                       ;[0C09] 
    CALL  SYSVAR_WBYTE              ;[0C0A] 
    LD    A,(HL)                    ;[0C0D] 
    CALL  SYSVAR_WBYTE              ;[0C0E] 
    INC   HL                        ;[0C11] 
    DEC   BC                        ;[0C12] 
    LD    A,B                       ;[0C13] 
    OR    C                         ;[0C14] 
    JR    NZ,$0C0D                  ;[0C15] 
    POP   HL                        ;[0C17] 
    LD    A,L                       ;[0C18] 
    CALL  SYSVAR_WBYTE              ;[0C19] 
    LD    A,H                       ;[0C1C] 
    CALL  SYSVAR_WBYTE              ;[0C1D] 
    CALL  SYSVAR_WBYTE              ;[0C20] 
    JP    LYNX_MOTOFF               ;[0C23] 
    INC   DE                        ;[0C26] 
    PUSH  DE                        ;[0C27] 
    LD    HL,$6000                  ;[0C28] 
    CALL  LYNX_RSYNC                ;[0C2B] 
    CALL  LYNX_RBYTE                ;[0C2E] 
    CP    $22                       ;[0C31] 
    JR    NZ,$0C2B                  ;[0C33] 
    CALL  LYNX_RBYTE                ;[0C35] 
    LD    (HL),A                    ;[0C38] 
    INC   L                         ;[0C39] 
    CP    $22                       ;[0C3A] 
    JR    NZ,$0C35                  ;[0C3C] 
    POP   DE                        ;[0C3E] 
    PUSH  DE                        ;[0C3F] 
    LD    A,$20                     ;[0C40] 
    RST   $08                       ;[0C42] 
    LD    A,$22                     ;[0C43] 
    RST   $08                       ;[0C45] 
    LD    (HL),$00                  ;[0C46] 
    LD    HL,$6000                  ;[0C48] 
    PUSH  HL                        ;[0C4B] 
    CALL  LYNX_PLINE                ;[0C4C] 
    DEC   HL                        ;[0C4F] 
    LD    (HL),$0D                  ;[0C50] 
    POP   HL                        ;[0C52] 
    CALL  $22D3                     ;[0C53] 
    POP   DE                        ;[0C56] 
    JR    NZ,$0C27                  ;[0C57] 
    RET                             ;[0C59] 

BASIC_COM_VERIFY:
    CALL  $0C26                     ;[0C5A] VERIFY.
    LD    HL,(SYSVAR_SOB)           ;[0C5D] 
    CALL  LYNX_RSYNC                ;[0C60] 
    CALL  LYNX_RBYTE                ;[0C63] 
    CP    $42                       ;[0C66] 
    JR    NZ,$0C81                  ;[0C68] 
    CALL  LYNX_RBYTE                ;[0C6A] 
    LD    C,A                       ;[0C6D] 
    CALL  LYNX_RBYTE                ;[0C6E] 
    LD    B,A                       ;[0C71] 
    CALL  LYNX_RBYTE                ;[0C72] 
    CP    (HL)                      ;[0C75] 
    INC   HL                        ;[0C76] 
    JR    NZ,$0C81                  ;[0C77] 
    DEC   BC                        ;[0C79] 
    LD    A,B                       ;[0C7A] 
    OR    C                         ;[0C7B] 
    JR    NZ,$0C72                  ;[0C7C] 
    JP    LYNX_MOTOFF               ;[0C7E] 
    CALL  LYNX_MOTOFF               ;[0C81] 
    JP    $3AF9                     ;[0C84] 

BASIC_COM_APPEND:
    CALL  $0C26                     ;[0C87] APPEND.
    LD    HL,(SYSVAR_EOB)           ;[0C8A] 
    JR    $0C95                     ;[0C8D] 

BASIC_COM_LOAD:
    CALL  $0C26                     ;[0C8F] 
    LD    HL,(SYSVAR_SOB)           ;[0C92] 
    CALL  LYNX_RSYNC                ;[0C95] 
    CALL  LYNX_RBYTE                ;[0C98] 
    CP    $42                       ;[0C9B] 
    JR    NZ,$0C95                  ;[0C9D] 
    CALL  LYNX_RBYTE                ;[0C9F] 
    LD    C,A                       ;[0CA2] 
    CALL  LYNX_RBYTE                ;[0CA3] 
    LD    B,A                       ;[0CA6] 
    CALL  LYNX_RBYTE                ;[0CA7] 
    LD    (HL),A                    ;[0CAA] 
    INC   HL                        ;[0CAB] 
    DEC   BC                        ;[0CAC] 
    LD    A,B                       ;[0CAD] 
    OR    C                         ;[0CAE] 
    JR    NZ,$0CA7                  ;[0CAF] 
    DEC   HL                        ;[0CB1] 
    LD    (SYSVAR_EOB),HL           ;[0CB2] 
    CALL  LYNX_RBYTE                ;[0CB5] 
    LD    E,A                       ;[0CB8] 
    CALL  LYNX_RBYTE                ;[0CB9] 
    LD    D,A                       ;[0CBC] 
    OR    E                         ;[0CBD] 
    JP    Z,LYNX_MOTOFF             ;[0CBE] 
    ADD   HL,DE                     ;[0CC1] 
    PUSH  HL                        ;[0CC2] 
    CALL  LYNX_MOTOFF               ;[0CC3] 
    CALL  $1F6E                     ;[0CC6] 
    POP   IX                        ;[0CC9] 
    JP    $24C5                     ;[0CCB] 
    CALL  LYNX_MOTOFF               ;[0CCE] Escape route for read bit routine.
    JP    $38E8                     ;[0CD1] 
    LD    BC,$0080                  ;[0CD4] Read bit routine.
    LD    D,$00                     ;[0CD7] 
    IN    E,(C)                     ;[0CD9] 
    SRL   E                         ;[0CDB] 
    JR    C,$0CD9                   ;[0CDD] 
    BIT   5,E                       ;[0CDF] 
    JR    Z,$0CCE                   ;[0CE1] 
    IN    E,(C)                     ;[0CE3] 
    INC   D                         ;[0CE5] 
    SRL   E                         ;[0CE6] 
    JR    NC,$0CE3                  ;[0CE8] 
    LD    E,A                       ;[0CEA] 
    LD    A,(SYSVAR_CASLEV)         ;[0CEB] 
    CP    D                         ;[0CEE] 
    LD    A,E                       ;[0CEF] 
    RLA                             ;[0CF0] 
    RET                             ;[0CF1] 

LYNX_MOTON:
    LD    A,$02                     ;[0CF2] Turns cassette motor on. 
    OUT   ($80),A                   ;[0CF4] 
    LD    A,$0C                     ;[0CF6] 
    OUT   ($86),A                   ;[0CF8] 
    RET                             ;[0CFA] 

LYNX_MOTOFF:
    XOR   A                         ;[0CFB] Turns cassette motor off. NB must follow MOTON. 
    OUT   ($87),A                   ;[0CFC] 
    OUT   ($80),A                   ;[0CFE] 
    LD    BC,$1770                  ;[0D00] 
    DEC   BC                        ;[0D03] 
    LD    A,B                       ;[0D04] 
    OR    C                         ;[0D05] 
    JR    NZ,$0D03                  ;[0D06] 
    RET                             ;[0D08] 


DATA_CASTBL:
    defb 0x1D,0x1B,0x18,0x16,0x14,0x12,0x10,0x0E        ;[0D09]
    defb 0x0C,0x0A,0x09,0x07,0x06,0x05,0x04,0x03        ;[0D11]
    defb 0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x03        ;[0D19]
    defb 0x04,0x05,0x06,0x07,0x09,0x0A,0x0C,0x0E        ;[0D21]
    defb 0x10,0x12,0x14,0x16,0x18,0x1B,0x1D,0x20        ;[0D29]
    defb 0x22,0x24,0x27,0x29,0x2B,0x2D,0x2F,0x31        ;[0D31]
    defb 0x33,0x35,0x36,0x38,0x39,0x3A,0x3B,0x3C        ;[0D39]
    defb 0x3D,0x3D,0x3D,0x3E,0x3D,0x3D,0x3D,0x3C        ;[0D41]
    defb 0x3B,0x3A,0x39,0x38,0x36,0x35,0x33,0x31        ;[0D49]
    defb 0x2F,0x2D,0x2B,0x29,0x27,0x24,0x22,0x20        ;[0D51]
    defb 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00        ;[0D59]
    defb 0x00,0x00,0x00,0x00,0x00,0x00                  ;[0D61]

    PUSH  AF                        ;[0D67] Write byte to tape.
    PUSH  HL                        ;[0D68] 
    PUSH  DE                        ;[0D69] 
    PUSH  BC                        ;[0D6A] 
    LD    B,$00                     ;[0D6B] 
    LD    E,A                       ;[0D6D] 
    LD    A,(SYSVAR_FINE)           ;[0D6E] 
    LD    D,A                       ;[0D71] 
    SCF                             ;[0D72] 
    RL    E                         ;[0D73] 
    JR    Z,$0D8D                   ;[0D75] 
    LD    A,(SYSVAR_COARSE)         ;[0D77] 
    JR    C,$0D7D                   ;[0D7A] 
    RLCA                            ;[0D7C] 
    LD    C,A                       ;[0D7D] 
    LD    HL,(SYSVAR_CASTBL)        ;[0D7E] 
    LD    A,(HL)                    ;[0D81] 
    OR    A                         ;[0D82] 
    JR    Z,$0D73                   ;[0D83] 
    OUT   ($84),A                   ;[0D85] 
    ADD   HL,BC                     ;[0D87] 
    LD    B,D                       ;[0D88] 
    DJNZ  $0D89                     ;[0D89] 
    JR    $0D81                     ;[0D8B] 
    POP   BC                        ;[0D8D] 
    POP   DE                        ;[0D8E] 
    POP   HL                        ;[0D8F] 
    POP   AF                        ;[0D90] 
    RET                             ;[0D91] 

BASIC_COM_TAPE:
    RST   $18                       ;[0D92] TAPE.
    CP    $06                       ;[0D93] 
    CALL  NC,$3B29                  ;[0D95] 
    RLCA                            ;[0D98] 
    RLCA                            ;[0D99] 
    LD    E,A                       ;[0D9A] 
    LD    D,$00                     ;[0D9B] 
    LD    HL,DATA_TAPE              ;[0D9D] 
    ADD   HL,DE                     ;[0DA0] 
    LD    DE,SYSVAR_CASLEV          ;[0DA1] 
    LD    B,$04                     ;[0DA4] 
    LD    A,(HL)                    ;[0DA6] 
    LD    (DE),A                    ;[0DA7] 
    INC   DE                        ;[0DA8] 
    INC   HL                        ;[0DA9] 
    DJNZ  $0DA6                     ;[0DAA] 
    RET                             ;[0DAC] 


DATA_TAPE:
    defb 0x50,0x01,0x04,0x03,0x38,0x01,0x01,0x04        ;[0DAD]
    defb 0x2C,0x02,0x04,0x05,0x23,0x02,0x02,0x06        ;[0DB5]
    defb 0x1B,0x02,0x01,0x07,0x14,0x03,0x02,0x08        ;[0DBD]

VDU_12:
    CALL  $0746                     ;[0DC5] Moves cursor one character block to the right
    JP    $07E1                     ;[0DC8] 
    LD    HL,$9FF8                  ;[0DCB] All set to FF ie not used.
    LD    DE,$BFF8                  ;[0DCE] 
    LD    A,(DE)                    ;[0DD1] 
    CPL                             ;[0DD2] 
    LD    (DE),A                    ;[0DD3] 
    LD    C,(HL)                    ;[0DD4] 
    CPL                             ;[0DD5] 
    LD    (DE),A                    ;[0DD6] 
    LD    A,(HL)                    ;[0DD7] 
    CP    C                         ;[0DD8] 
    JR    NZ,$0DEB                  ;[0DD9] 
    LD    HL,$0FF8                  ;[0DDB] 
    LD    DE,$F000                  ;[0DDE] 
    ADD   HL,DE                     ;[0DE1] 
    LD    A,(HL)                    ;[0DE2] 
    CPL                             ;[0DE3] 
    LD    (HL),A                    ;[0DE4] 
    LD    C,(HL)                    ;[0DE5] 
    CPL                             ;[0DE6] 
    LD    (HL),A                    ;[0DE7] 
    CP    C                         ;[0DE8] 
    JR    Z,$0DE1                   ;[0DE9] 
    LD    SP,HL                     ;[0DEB] 
    JP    $16A3                     ;[0DEC] 
    INC   D                         ;[0DEF] 
    INC   DE                        ;[0DF0] 
    LD    A,$00                     ;[0DF1] 
    CALL  SYSVAR_LINP               ;[0DF3] 
    CALL  LYNX_ESC                  ;[0DF6] 
    RET   NZ                        ;[0DF9] 
    POP   DE                        ;[0DFA] 
    POP   DE                        ;[0DFB] 
    POP   BC                        ;[0DFC] 
    LD    IX,(SYSVAR_CURRLP)        ;[0DFD] 
    JP    $1E3E                     ;[0E01] 
    RST   $38                       ;[0E04] 

BASIC_COM_ERROR:
    RST   $18                       ;[0E05] ERROR.
    JP    $3B4F                     ;[0E06] 

BASIC_FN_LETTER:
    CALL  LYNX_FPINT                ;[0E09] 
    LD    A,L                       ;[0E0C] 
    CP    $20                       ;[0E0D] 
    CALL  C,$3B29                   ;[0E0F] 
    CALL  LYNX_FONT                 ;[0E12] 
    JP    LYNX_INTFP                ;[0E15] 

BASIC_FN_MOD:
    CALL  LYNX_SWAP                 ;[0E18] MOD.
    CALL  BASIC_FN_ABS              ;[0E1B] 
    CALL  $2F2C                     ;[0E1E] 
    CALL  $2F2C                     ;[0E21] 
    CALL  LYNX_SWAP                 ;[0E24] 
    CALL  LYNX_DIV                  ;[0E27] 
    CALL  BASIC_FN_FRAC             ;[0E2A] 
    CALL  $2F3C                     ;[0E2D] 
    CALL  LYNX_MLT                  ;[0E30] 
    CALL  $2F3C                     ;[0E33] 
    LD    A,(SYSVAR_WRA1)           ;[0E36] 
    CALL  $3FF1                     ;[0E39] 
    JP    BASIC_FN_INT              ;[0E3C] 

BASIC_FN_DIV:
    CALL  LYNX_DIV                  ;[0E3F] DIV.
    JR    $0E3C                     ;[0E42] 

BASIC_FN_INK:
    LD    HL,(SYSVAR_INKST)         ;[0E44] Return INK value.
    LD    H,$00                     ;[0E47] 
    JP    LYNX_INTFP                ;[0E49] 

BASIC_FN_PAPER:
    LD    HL,(SYSVAR_PAPST)         ;[0E4C] Return PAPER value.
    JR    $0E47                     ;[0E4F] 

BASIC_FN_POS:
    LD    HL,(SYSVAR_CURSORX)       ;[0E51] POS.
    JR    $0E47                     ;[0E54] 

BASIC_FN_VPOS:
    LD    HL,(SYSVAR_CURSORY)       ;[0E56] VPOS.
    JR    $0E47                     ;[0E59] 

BASIC_FN_GRAPHIC:
    LD    HL,SYSVAR_GPHTBL          ;[0E5B] GRAPHIC.
    JR    $0E49                     ;[0E5E] 

BASIC_FN_ALPHA:
    LD    HL,SYSVAR_CHRTBL          ;[0E60] ALPHA.
    JR    $0E49                     ;[0E63] 

BASIC_FN_INF:
    LD    HL,DATA_INF               ;[0E65] INF.
    JP    LYNX_LNUM1                ;[0E68] 

DATA_INF:
    defb 0xFF,0x99,0x99,0x99,0x99                       ;[0E6B]

    CALL  LYNX_FPINT                ;[0E70] Utility routine called by BNOR, BNXOR & BNAND.
    PUSH  HL                        ;[0E73] 
    LD    HL,SYSVAR_WRA2            ;[0E74] 
    CALL  LYNX_LNUM1                ;[0E77] 
    CALL  LYNX_FPINT                ;[0E7A] 
    POP   BC                        ;[0E7D] 
    RET                             ;[0E7E] 

BASIC_FN_BNOR:
    CALL  $0E70                     ;[0E7F] BNOR.
    LD    A,B                       ;[0E82] 
    OR    H                         ;[0E83] 
    LD    H,A                       ;[0E84] 
    LD    A,C                       ;[0E85] 
    OR    L                         ;[0E86] 
    LD    L,A                       ;[0E87] 
    JP    LYNX_INTFP                ;[0E88] 

BASIC_FN_BNXOR:
    CALL  $0E70                     ;[0E8B] BNXOR.
    LD    A,B                       ;[0E8E] 
    XOR   H                         ;[0E8F] 
    LD    H,A                       ;[0E90] 
    LD    A,C                       ;[0E91] 
    XOR   L                         ;[0E92] 
    JR    $0E87                     ;[0E93] 

BASIC_FN_BNAND:
    CALL  $0E70                     ;[0E95] BNAND.
    LD    A,B                       ;[0E98] 
    AND   H                         ;[0E99] 
    LD    H,A                       ;[0E9A] 
    LD    A,C                       ;[0E9B] 
    AND   L                         ;[0E9C] 
    JR    $0E87                     ;[0E9D] 

BASIC_FN_RAND:
    CALL  $2F2C                     ;[0E9F] RAND.
    CALL  BASIC_FN_RND              ;[0EA2] 
    CALL  $2F3C                     ;[0EA5] 
    CALL  LYNX_MLT                  ;[0EA8] 
    JP    BASIC_FN_INT              ;[0EAB] 

BASIC_COM_CFR:
    RST   $18                       ;[0EAE] 
    LD    (SYSVAR_FLASH),HL         ;[0EAF] CFR.
    RET                             ;[0EB2] 

BASIC_COM_CCHAR:
    RST   $18                       ;[0EB3] CCHAR.
    LD    (SYSVAR_INPCUR),HL        ;[0EB4] 
    RET                             ;[0EB7] 

BASIC_FN_WHITE:
    XOR   A                         ;[0EB8] WHITE.
    INC   A                         ;[0EB9] 
    LD    B,$AF                     ;[0EBA] 
    INC   A                         ;[0EBC] 
    LD    B,$AF                     ;[0EBD] 
    INC   A                         ;[0EBF] 
    LD    B,$AF                     ;[0EC0] 
    INC   A                         ;[0EC2] 
    LD    B,$AF                     ;[0EC3] 
    INC   A                         ;[0EC5] 
    LD    B,$AF                     ;[0EC6] 
    INC   A                         ;[0EC8] 
    LD    B,$AF                     ;[0EC9] 
    INC   A                         ;[0ECB] 
    LD    B,$AF                     ;[0ECC] 
    LD    L,A                       ;[0ECE] 
    LD    H,$00                     ;[0ECF] 
    JP    LYNX_INTFP                ;[0ED1] 
    CALL  LYNX_RP                   ;[0ED4] 
    LD    (HL),A                    ;[0ED7] 
    CP    $0D                       ;[0ED8] 
    RET   Z                         ;[0EDA] 
    INC   HL                        ;[0EDB] 
    CP    $2C                       ;[0EDC] 
    JR    Z,$0ED4                   ;[0EDE] 
    CALL  $3B3B                     ;[0EE0] 

BASIC_COM_VDU:
    RST   $18                       ;[0EE3] VDU routine.
    RST   $08                       ;[0EE4] 
    LD    A,(DE)                    ;[0EE5] 
    CP    $0D                       ;[0EE6] 
    RET   Z                         ;[0EE8] 
    INC   DE                        ;[0EE9] 
    JR    BASIC_COM_VDU             ;[0EEA] 
    LD    B,$05                     ;[0EEC] 
    JR    $0EF6                     ;[0EEE] 

VALIDATE_WINDOW:
    LD    B,$03                     ;[0EF0] Validation for WINDOW.
    JR    $0EF6                     ;[0EF2] 
    LD    B,$02                     ;[0EF4] Validation for PLOT;BEEP;PAINT.
    PUSH  BC                        ;[0EF6] Validation. Words of the form:- WORD a,b,c,d.
    CALL  LYNX_RP                   ;[0EF7] 
    RST   $20                       ;[0EFA] 
    INC   L                         ;[0EFB] 
    LD    (HL),A                    ;[0EFC] 
    INC   HL                        ;[0EFD] 
    POP   BC                        ;[0EFE] 
    DJNZ  $0EF6                     ;[0EFF] 
    JP    $2707                     ;[0F01] 

VALIDATE_PRINT:
    DEC   HL                        ;[0F04] Validation for '?'.
    LD    A,$1D                     ;[0F05] 
    JP    $27BC                     ;[0F07] 
    LD    A,(IX-$01)                ;[0F0A] 
    SUB   $08                       ;[0F0D] 
    LD    B,A                       ;[0F0F] 
    CALL  $352A                     ;[0F10] 
    LD    A,(DE)                    ;[0F13] 
    INC   DE                        ;[0F14] 
    CALL  $2239                     ;[0F15] 
    DJNZ  $0F10                     ;[0F18] 
    JP    $2840                     ;[0F1A] 

VALIDATE_CODE1:
    LD    A,(DE)                    ;[0F1D] Part of CODE validation.
    LD    (HL),A                    ;[0F1E] 
    CP    $0D                       ;[0F1F] 
    RET   Z                         ;[0F21] 
    RST   $20                       ;[0F22] 
    JR    NZ,$0EFC                  ;[0F23] 

VALIDATE_CODE:
    CALL  VALIDATE_CODE2            ;[0F25] Validation for CODE.
    LD    (HL),C                    ;[0F28] 
    INC   HL                        ;[0F29] 
    JR    VALIDATE_CODE1            ;[0F2A] 

VALIDATE_CODE2:
    LD    C,$00                     ;[0F2C] Part of CODE validation.
    LD    A,(DE)                    ;[0F2E] 
    SUB   $30                       ;[0F2F] 
    RET   C                         ;[0F31] 
    CP    $0A                       ;[0F32] 
    JR    C,$0F3E                   ;[0F34] 
    SUB   $07                       ;[0F36] 
    CP    $0A                       ;[0F38] 
    RET   C                         ;[0F3A] 
    CP    $10                       ;[0F3B] 
    RET   NC                        ;[0F3D] 
    SLA   C                         ;[0F3E] 
    SLA   C                         ;[0F40] 
    SLA   C                         ;[0F42] 
    SLA   C                         ;[0F44] 
    ADD   A,C                       ;[0F46] 
    LD    C,A                       ;[0F47] 
    INC   DE                        ;[0F48] 
    JR    $0F2E                     ;[0F49] 

BASIC_COM_INK:
    RST   $18                       ;[0F4B] Set INK routine.
    LD    (SYSVAR_INKST),A          ;[0F4C] 
    RET                             ;[0F4F] 

BASIC_COM_PAPER:
    RST   $18                       ;[0F50] Set PAPER routine.
    LD    (SYSVAR_PAPST),A          ;[0F51] 
    RET                             ;[0F54] 

BASIC_COM_MOVE:
    RST   $18                       ;[0F55] MOVE.
    INC   DE                        ;[0F56] 
    LD    (SYSVAR_GOLDX),HL         ;[0F57] 
    RST   $18                       ;[0F5A] 
    LD    (SYSVAR_GOLDY),A          ;[0F5B] 
    RET                             ;[0F5E] 

BASIC_COM_DRAW:
    RST   $18                       ;[0F5F] DRAW.
    INC   DE                        ;[0F60] 
    LD    (SYSVAR_GNEWX),HL         ;[0F61] 
    RST   $18                       ;[0F64] 
    LD    (SYSVAR_GNEWY),A          ;[0F65] 
    JP    SYSVAR_GLINE              ;[0F68] 

SUB_PLOT1:
    RST   $18                       ;[0F6B] PLOT subroutine.
    INC   DE                        ;[0F6C] 
    LD    BC,(SYSVAR_GOLDX)         ;[0F6D] 
    ADD   HL,BC                     ;[0F71] 
    LD    (SYSVAR_GOLDX),HL         ;[0F72] 
    RST   $18                       ;[0F75] 
    LD    A,(SYSVAR_GOLDY)          ;[0F76] 
    ADD   A,L                       ;[0F79] 
    LD    (SYSVAR_GOLDY),A          ;[0F7A] 
    RET                             ;[0F7D] 

SUB_PLOT2:
    RST   $18                       ;[0F7E] PLOT subroutine.
    INC   DE                        ;[0F7F] 
    LD    BC,(SYSVAR_GOLDX)         ;[0F80] 
    ADD   HL,BC                     ;[0F84] 
    LD    (SYSVAR_GNEWX),HL         ;[0F85] 
    RST   $18                       ;[0F88] 
    LD    A,(SYSVAR_GOLDY)          ;[0F89] 
    ADD   A,L                       ;[0F8C] 
    LD    (SYSVAR_GNEWY),A          ;[0F8D] 
    JP    SYSVAR_GLINE              ;[0F90] 

BASIC_COM_DOT:
    RST   $18                       ;[0F93] PLOT subroutine.
    INC   DE                        ;[0F94] 
    LD    (SYSVAR_GNEWX),HL         ;[0F95] 
    LD    (SYSVAR_GOLDX),HL         ;[0F98] 
    RST   $18                       ;[0F9B] 
    LD    (SYSVAR_GNEWY),A          ;[0F9C] 
    LD    (SYSVAR_GOLDY),A          ;[0F9F] 
    JP    SYSVAR_GLINE              ;[0FA2] 

BASIC_COM_PLOT:
    RST   $18                       ;[0FA5] PLOT.
    INC   DE                        ;[0FA6] 
    OR    A                         ;[0FA7] 
    JP    Z,BASIC_COM_MOVE          ;[0FA8] 
    DEC   L                         ;[0FAB] 
    JP    Z,SUB_PLOT1               ;[0FAC] 
    DEC   L                         ;[0FAF] 
    JP    Z,BASIC_COM_DRAW          ;[0FB0] 
    DEC   L                         ;[0FB3] 
    JP    Z,SUB_PLOT2               ;[0FB4] 
    DEC   L                         ;[0FB7] 
    JP    Z,BASIC_COM_DOT           ;[0FB8] 
    CALL  $3B32                     ;[0FBB] 
    LD    HL,(SYSVAR_GNEWX)         ;[0FBE] 
    PUSH  HL                        ;[0FC1] 
    LD    DE,(SYSVAR_GOLDX)         ;[0FC2] 
    LD    H,$00                     ;[0FC6] 
    LD    D,H                       ;[0FC8] 
    OR    A                         ;[0FC9] 
    SBC   HL,DE                     ;[0FCA] 
    EX    DE,HL                     ;[0FCC] 
    LD    HL,($6264)                ;[0FCD] 
    LD    L,$80                     ;[0FD0] 
    EXX                             ;[0FD2] 
    LD    HL,(SYSVAR_GNEWY)         ;[0FD3] 
    PUSH  HL                        ;[0FD6] 
    LD    DE,(SYSVAR_GOLDY)         ;[0FD7] 
    LD    H,$00                     ;[0FDB] 
    LD    D,H                       ;[0FDD] 
    OR    A                         ;[0FDE] 
    SBC   HL,DE                     ;[0FDF] 
    EX    DE,HL                     ;[0FE1] 
    LD    HL,($6266)                ;[0FE2] 
    LD    L,$80                     ;[0FE5] 
    LD    A,D                       ;[0FE7] 
    OR    E                         ;[0FE8] 
    EXX                             ;[0FE9] 
    LD    B,$01                     ;[0FEA] 
    OR    E                         ;[0FEC] 
    OR    D                         ;[0FED] 
    JR    Z,$1008                   ;[0FEE] 
    DEC   B                         ;[0FF0] 
    CALL  SUB_PLOT5                 ;[0FF1] 
    JR    NZ,$1001                  ;[0FF4] 
    SCF                             ;[0FF6] 
    RR    B                         ;[0FF7] 
    CALL  SUB_PLOT4                 ;[0FF9] 
    CALL  SUB_PLOT5                 ;[0FFC] 
    JR    Z,$0FF7                   ;[0FFF] 
    CALL  SUB_PLOT3                 ;[1001] 
    ADD   HL,DE                     ;[1004] 
    EXX                             ;[1005] 
    ADD   HL,DE                     ;[1006] 
    EXX                             ;[1007] 
    CALL  SUB_PLOT3                 ;[1008] 
    DJNZ  $1004                     ;[100B] 
    POP   HL                        ;[100D] 
    LD    A,L                       ;[100E] 
    LD    (SYSVAR_GOLDY),A          ;[100F] 
    POP   HL                        ;[1012] 
    LD    (SYSVAR_GOLDX),HL         ;[1013] 
    RET                             ;[1016] 

SUB_PLOT3:
    EXX                             ;[1017] PLOT subroutine.
    LD    A,H                       ;[1018] 
    EXX                             ;[1019] 
    PUSH  HL                        ;[101A] 
    PUSH  DE                        ;[101B] 
    PUSH  BC                        ;[101C] 
    LD    L,A                       ;[101D] 
    LD    A,H                       ;[101E] 
    LD    H,$00                     ;[101F] 
    ADD   HL,HL                     ;[1021] 
    ADD   HL,HL                     ;[1022] 
    ADD   HL,HL                     ;[1023] 
    ADD   HL,HL                     ;[1024] 
    ADD   HL,HL                     ;[1025] 
    LD    C,A                       ;[1026] 
    SRL   C                         ;[1027] 
    SRL   C                         ;[1029] 
    SRL   C                         ;[102B] 
    LD    B,$00                     ;[102D] 
    ADD   HL,BC                     ;[102F] 
    LD    C,$80                     ;[1030] 
    AND   $07                       ;[1032] 
    JR    Z,$103B                   ;[1034] 
    SRL   C                         ;[1036] 
    DEC   A                         ;[1038] 
    JR    NZ,$1036                  ;[1039] 
    LD    A,C                       ;[103B] 
    CPL                             ;[103C] 
    LD    C,A                       ;[103D] 
    CPL                             ;[103E] 
    CALL  SYSVAR_OUTB               ;[103F] 
    POP   BC                        ;[1042] 
    POP   DE                        ;[1043] 
    POP   HL                        ;[1044] 
    RET                             ;[1045] 

SUB_PLOT4:
    SLA   E                         ;[1046] PLOT subroutine.
    RL    D                         ;[1048] 
    EXX                             ;[104A] 
    SLA   E                         ;[104B] 
    RL    D                         ;[104D] 
    EXX                             ;[104F] 
    RET                             ;[1050] 

SUB_PLOT5:
    EXX                             ;[1051] PLOT subroutine.
    LD    A,D                       ;[1052] 
    XOR   E                         ;[1053] 
    AND   $80                       ;[1054] 
    EXX                             ;[1056] 
    LD    C,A                       ;[1057] 
    LD    A,D                       ;[1058] 
    XOR   E                         ;[1059] 
    AND   $80                       ;[105A] 
    OR    C                         ;[105C] 
    RET                             ;[105D] 

LYNX_PRTSTR:
    LD    A,(HL)                    ;[105E] Displays string pointed to by HL and terminated by a CR.
    CP    $0D                       ;[105F] 
    RET   Z                         ;[1061] 
    RST   $08                       ;[1062] 
    INC   HL                        ;[1063] 
    JR    LYNX_PRTSTR               ;[1064] 
    CALL  $1095                     ;[1066] Flash cursor and scan keyboard.
    CALL  LYNX_KEY                  ;[1069] 
    OR    A                         ;[106C] 
    JR    Z,$1066                   ;[106D] 
    RET                             ;[106F] 

LYNX_DISPLAY_BUFFER:
    PUSH  HL                        ;[1070] Display buffer.
    PUSH  DE                        ;[1071] 
    LD    DE,(SYSVAR_CURSORX)       ;[1072] 
    LD    A,$20                     ;[1076] 
    RST   $08                       ;[1078] 
    DEC   HL                        ;[1079] 
    INC   HL                        ;[107A] 
    LD    A,(HL)                    ;[107B] 
    CP    $0D                       ;[107C] 
    JR    Z,$1083                   ;[107E] 
    RST   $08                       ;[1080] 
    JR    $107A                     ;[1081] 
    LD    A,$20                     ;[1083] 
    RST   $08                       ;[1085] 
    LD    (SYSVAR_CURSORX),DE       ;[1086] 
    POP   DE                        ;[108A] 
    POP   HL                        ;[108B] 
    RET                             ;[108C] 

    LD    A,(DE)                    ;[108D] Loop until CR.
    CP    $0D                       ;[108E] 
    RET   Z                         ;[1090] 
    INC   B                         ;[1091] 
    INC   DE                        ;[1092] 
    JR    $108D                     ;[1093] 
    EXX                             ;[1095] Output the cursor.
    DEC   HL                        ;[1096] 
    LD    A,H                       ;[1097] 
    OR    L                         ;[1098] 
    JR    NZ,$10A5                  ;[1099] 
    LD    HL,(SYSVAR_FLASH)         ;[109B] 
    LD    A,B                       ;[109E] 
    LD    B,C                       ;[109F] 
    LD    C,A                       ;[10A0] 
    RST   $08                       ;[10A1] 
    LD    A,$16                     ;[10A2] 
    RST   $08                       ;[10A4] 
    EXX                             ;[10A5] 
    RET                             ;[10A6] 

    EX    AF,AF'                    ;[10A7] Character input routines
    LD    A,B                       ;[10A8] 
    CP    $F0                       ;[10A9] 
    JR    NC,$10F5                  ;[10AB] 
    EX    AF,AF'                    ;[10AD] 
    RST   $08                       ;[10AE] 
    INC   DE                        ;[10AF] 
    PUSH  HL                        ;[10B0] 
    PUSH  DE                        ;[10B1] 
    PUSH  BC                        ;[10B2] 
    PUSH  DE                        ;[10B3] 
    EX    DE,HL                     ;[10B4] 
    OR    A                         ;[10B5] 
    SBC   HL,DE                     ;[10B6] 
    LD    C,L                       ;[10B8] 
    LD    B,H                       ;[10B9] 
    POP   DE                        ;[10BA] 
    LD    L,E                       ;[10BB] 
    LD    H,D                       ;[10BC] 
    DEC   HL                        ;[10BD] 
    LDDR                            ;[10BE] 
    POP   BC                        ;[10C0] 
    POP   DE                        ;[10C1] 
    POP   HL                        ;[10C2] 
    LD    (HL),A                    ;[10C3] 
    INC   HL                        ;[10C4] 
    CALL  LYNX_DISPLAY_BUFFER       ;[10C5] 
    INC   B                         ;[10C8] 
    INC   C                         ;[10C9] 
    JR    $10F5                     ;[10CA] 
    LD    HL,$6000                  ;[10CC] 
    LD    D,H                       ;[10CF] 
    LD    E,L                       ;[10D0] 
    LD    BC,START                  ;[10D1] 
    EXX                             ;[10D4] 
    LD    HL,(SYSVAR_FLASH)         ;[10D5] 
    LD    BC,(SYSVAR_INPCUR)        ;[10D8] 
    EXX                             ;[10DC] 
    RET                             ;[10DD] 

    LD    (HL),$0D                  ;[10DE] 
    JR    $10FF                     ;[10E0] 
    CALL  $10CC                     ;[10E2] 
    LD    A,$0F                     ;[10E5] 
    RST   $08                       ;[10E7] 
    CALL  $1066                     ;[10E8] 
    CP    $11                       ;[10EB] 
    JR    NZ,$10DE                  ;[10ED] 
    CALL  $108D                     ;[10EF] 
    CALL  LYNX_DISPLAY_BUFFER       ;[10F2] 
    EXX                             ;[10F5] 
    LD    A,B                       ;[10F6] 
    RST   $08                       ;[10F7] 
    LD    A,$16                     ;[10F8] 
    RST   $08                       ;[10FA] 
    EXX                             ;[10FB] 
    CALL  $1066                     ;[10FC] 
    CP    $20                       ;[10FF] 
    JR    NC,$10A7                  ;[1101] 
    CP    $08                       ;[1103] 
    JR    Z,$1145                   ;[1105] 
    CP    $0B                       ;[1107] 
    JP    Z,$11C7                   ;[1109] 
    CP    $0A                       ;[110C] 
    JP    Z,$11D6                   ;[110E] 
    CP    $16                       ;[1111] 
    JR    Z,$112E                   ;[1113] 
    CP    $0C                       ;[1115] 
    JR    Z,$113C                   ;[1117] 
    CP    $05                       ;[1119] 
    JP    Z,$1167                   ;[111B] 
    CP    $0D                       ;[111E] 
    JR    NZ,$10F5                  ;[1120] 
    CALL  LYNX_PRTSTR               ;[1122] 
    LD    A,$20                     ;[1125] 
    RST   $08                       ;[1127] 
    LD    A,$0D                     ;[1128] 
    RST   $08                       ;[112A] 
    INC   B                         ;[112B] 
    DEC   B                         ;[112C] 
    RET                             ;[112D] 

    DEC   C                         ;[112E] 
    INC   C                         ;[112F] 
    JR    Z,$10F5                   ;[1130] 
    DEC   HL                        ;[1132] 
    DEC   C                         ;[1133] 
    LD    A,(HL)                    ;[1134] 
    RST   $08                       ;[1135] 
    LD    A,$16                     ;[1136] 
    RST   $08                       ;[1138] 
    RST   $08                       ;[1139] 
    JR    $10F5                     ;[113A] 
    LD    A,(HL)                    ;[113C] 
    CP    $0D                       ;[113D] 
    JR    Z,$10F5                   ;[113F] 
    INC   HL                        ;[1141] 
    INC   C                         ;[1142] 
    JR    $1139                     ;[1143] 
    DEC   C                         ;[1145] 
    INC   C                         ;[1146] 
    JR    Z,$10F5                   ;[1147] 
    DEC   HL                        ;[1149] 
    PUSH  HL                        ;[114A] 
    PUSH  DE                        ;[114B] 
    PUSH  BC                        ;[114C] 
    EX    DE,HL                     ;[114D] 
    OR    A                         ;[114E] 
    SBC   HL,DE                     ;[114F] 
    LD    C,L                       ;[1151] 
    LD    B,H                       ;[1152] 
    LD    L,E                       ;[1153] 
    LD    H,D                       ;[1154] 
    INC   HL                        ;[1155] 
    LDIR                            ;[1156] 
    POP   BC                        ;[1158] 
    POP   DE                        ;[1159] 
    POP   HL                        ;[115A] 
    DEC   DE                        ;[115B] 
    DEC   B                         ;[115C] 
    DEC   C                         ;[115D] 
    LD    A,$16                     ;[115E] 
    RST   $08                       ;[1160] 
    CALL  LYNX_DISPLAY_BUFFER       ;[1161] 
    JP    $10F5                     ;[1164] 
    INC   B                         ;[1167] 
    DEC   B                         ;[1168] 
    JP    NZ,$10F5                  ;[1169] 
    LD    HL,DATA_LINE_NUMBER       ;[116C] 
    CALL  LYNX_PLINE                ;[116F] 
    CALL  $10CC                     ;[1172] 
    CALL  $10DE                     ;[1175] 
    LD    DE,$6000                  ;[1178] 
    RST   $10                       ;[117B] 
    CALL  LYNX_RDN                  ;[117C] 
    CALL  LYNX_FNDLN                ;[117F] 
    CALL  NZ,$3B2C                  ;[1182] 
    LD    HL,(SYSVAR_PRINTD)        ;[1185] 
    PUSH  HL                        ;[1188] 
    LD    HL,$11A6                  ;[1189] 
    LD    (SYSVAR_PRINTD),HL        ;[118C] 
    LD    HL,$6000                  ;[118F] 
    LD    (SYSVAR_EDST),HL          ;[1192] 
    XOR   A                         ;[1195] 
    LD    (SYSVAR_SBC),A            ;[1196] 
    CALL  SYSVAR_DBASLN             ;[1199] 
    POP   HL                        ;[119C] 
    LD    (SYSVAR_PRINTD),HL        ;[119D] 
    CALL  $10CC                     ;[11A0] 
    JP    $10EF                     ;[11A3] 
    PUSH  AF                        ;[11A6] 
    CP    $1E                       ;[11A7] 
    JR    NZ,$11AD                  ;[11A9] 
    LD    A,$0D                     ;[11AB] 
    PUSH  HL                        ;[11AD] 
    LD    HL,(SYSVAR_EDST)          ;[11AE] 
    LD    (HL),A                    ;[11B1] 
    INC   HL                        ;[11B2] 
    LD    (SYSVAR_EDST),HL          ;[11B3] 
    POP   HL                        ;[11B6] 
    POP   AF                        ;[11B7] 
    RET                             ;[11B8] 


DATA_LINE_NUMBER:
    defb 0x4C,0x69,0x6E,0x65,0x20,0x6E,0x75,0x6D        ;[11B9]
    defb 0x62,0x65,0x72,0x3F,0x20,0x00                  ;[11C1]

    DEC   C                         ;[11C7] 
    INC   C                         ;[11C8] 
    JP    Z,$10F5                   ;[11C9] 
    DEC   HL                        ;[11CC] 
    DEC   C                         ;[11CD] 
    LD    A,(HL)                    ;[11CE] 
    RST   $08                       ;[11CF] 
    LD    A,$16                     ;[11D0] 
    RST   $08                       ;[11D2] 
    RST   $08                       ;[11D3] 
    JR    $11C7                     ;[11D4] 
    LD    A,(HL)                    ;[11D6] 
    CP    $0D                       ;[11D7] 
    JP    Z,$10F5                   ;[11D9] 
    INC   HL                        ;[11DC] 
    INC   C                         ;[11DD] 
    RST   $08                       ;[11DE] 
    JR    $11D6                     ;[11DF] 

DATA_TTBL:
    defb 0xCD,0x45,0x4D,0xD0,0x49,0xCB,0x45,0x59        ;[11E1]
    defb 0x4E,0xD2,0x4E,0x44,0xC8,0x4C,0xCC,0x45        ;[11E9]
    defb 0x4E,0x28,0xD6,0x41,0x4C,0x28,0xC1,0x53        ;[11F1]
    defb 0x43,0x28,0xC8,0x49,0x4D,0x45,0x4D,0xC7        ;[11F9]
    defb 0x45,0x54,0x4E,0xC9,0x4E,0x4B,0xD0,0x41        ;[1201]
    defb 0x50,0x45,0x52,0xD0,0x4F,0x53,0xD6,0x50        ;[1209]
    defb 0x4F,0x53,0xD4,0x52,0x55,0x45,0xC6,0x41        ;[1211]
    defb 0x4C,0x53,0x45,0xC9,0x4E,0x46,0xC2,0x4C        ;[1219]
    defb 0x41,0x43,0x4B,0xC2,0x4C,0x55,0x45,0xD2        ;[1221]
    defb 0x45,0x44,0xCD,0x41,0x47,0x45,0x4E,0x54        ;[1229]
    defb 0x41,0xC7,0x52,0x45,0x45,0x4E,0xC3,0x59        ;[1231]
    defb 0x41,0x4E,0xD9,0x45,0x4C,0x4C,0x4F,0x57        ;[1239]
    defb 0xD7,0x48,0x49,0x54,0x45,0xC1,0x4C,0x50        ;[1241]
    defb 0x48,0x41,0xC7,0x52,0x41,0x50,0x48,0x49        ;[1249]
    defb 0x43,0xD3,0x49,0x4E,0xC3,0x4F,0x53,0xD4        ;[1251]
    defb 0x41,0x4E,0xC5,0x58,0x50,0xCC,0x4F,0x47        ;[1259]
    defb 0xC1,0x4E,0x54,0x49,0x4C,0x4F,0x47,0xCC        ;[1261]
    defb 0x4E,0xD3,0x47,0x4E,0xC1,0x42,0x53,0xC9        ;[1269]
    defb 0x4E,0x54,0xC6,0x52,0x41,0x43,0xD3,0x51        ;[1271]
    defb 0x52,0xD0,0x45,0x45,0x4B,0xC4,0x50,0x45        ;[1279]
    defb 0x45,0x4B,0xC9,0x4E,0x50,0xC6,0x41,0x43        ;[1281]
    defb 0x54,0xC1,0x52,0x43,0x54,0x41,0x4E,0xC1        ;[1289]
    defb 0x52,0x43,0x43,0x4F,0x53,0xC1,0x52,0x43        ;[1291]
    defb 0x53,0x49,0x4E,0xCC,0x43,0x54,0x4E,0xC2        ;[1299]
    defb 0x49,0x4E,0xC4,0x45,0x47,0xD2,0x41,0x44        ;[12A1]
    defb 0xD2,0x41,0x4E,0x44,0xCC,0x49,0x47,0x48        ;[12A9]
    defb 0x54,0x50,0x45,0x4E,0xCA,0x4F,0x59,0x53        ;[12B1]
    defb 0x54,0x4B,0xD5,0x53,0x45,0x52,0x30,0xD5        ;[12B9]
    defb 0x53,0x45,0x52,0x31,0xD5,0x53,0x45,0x52        ;[12C1]
    defb 0x32,0xD5,0x53,0x45,0x52,0x33,0xCC,0x45        ;[12C9]
    defb 0x54,0x54,0x45,0x52,0x80,0x80,0x80,0x80        ;[12D1]
    defb 0x80,0xA8,0xCE,0x4F,0x54,0xAD,0x80,0x80        ;[12D9]
    defb 0x80,0xAA,0x2A,0xAA,0xAF,0xAB,0xAD,0xBE        ;[12E1]
    defb 0x3D,0xBC,0x3D,0xBC,0x3E,0xBE,0xBC,0xBD        ;[12E9]
    defb 0xCF,0x52,0xC1,0x4E,0x44,0xC2,0x4E,0x4F        ;[12F1]
    defb 0x52,0xC2,0x4E,0x58,0x4F,0x52,0xC2,0x4E        ;[12F9]
    defb 0x41,0x4E,0x44,0xC4,0x49,0x56,0xCD,0x4F        ;[1301]
    defb 0x44,0xD4,0x48,0x45,0x4E,0xCC,0x41,0x42        ;[1309]
    defb 0x45,0x4C,0xC0,0xCF,0x4E,0xCF,0x46,0x46        ;[1311]
    defb 0xD3,0x54,0x45,0x50,0xD4,0x4F,0xD4,0x41        ;[1319]
    defb 0x42,0xC3,0x48,0x52,0x24,0x28,0xCC,0x45        ;[1321]
    defb 0x46,0x54,0x24,0x28,0xD2,0x49,0x47,0x48        ;[1329]
    defb 0x54,0x24,0x28,0xCD,0x49,0x44,0x24,0x28        ;[1331]
    defb 0xD5,0x50,0x43,0x24,0x28,0xCB,0x45,0x59        ;[1339]
    defb 0x24,0xC7,0x45,0x54,0x24,0xD3,0x54,0x52        ;[1341]
    defb 0x24,0x28,0x80,0x80                            ;[1349]


DATA_BLANK:
    defb 0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80        ;[134D]
    defb 0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80        ;[1355]
    defb 0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80        ;[135D]
    defb 0x80,0x80,0x80                                 ;[1365]


DATA_FTBL:
    defb 0x69,0x1E,0x0C,0x36,0x26,0x20,0x57,0x1E        ;[1368]
    defb 0x24,0x33,0x14,0x2D,0x0E,0x2D,0x26,0x2D        ;[1370]
    defb 0x1D,0x33,0x1E,0x20,0x44,0x0E,0x4C,0x0E        ;[1378]
    defb 0x51,0x0E,0x56,0x0E,0xBF,0x35,0xAE,0x35        ;[1380]
    defb 0x65,0x0E,0xCD,0x0E,0xCA,0x0E,0xC7,0x0E        ;[1388]
    defb 0xC4,0x0E,0xC1,0x0E,0xBE,0x0E,0xBB,0x0E        ;[1390]
    defb 0xB8,0x0E,0x60,0x0E,0x5B,0x0E,0x23,0x32        ;[1398]
    defb 0x1A,0x32,0x90,0x31,0x84,0x31,0xE4,0x30        ;[13A0]
    defb 0xAB,0x31,0x4C,0x2F,0x3A,0x34,0x34,0x34        ;[13A8]
    defb 0x56,0x34,0x75,0x34,0x52,0x30,0x3F,0x33        ;[13B0]
    defb 0x36,0x33,0x29,0x33,0x10,0x30,0xA5,0x2F        ;[13B8]
    defb 0x85,0x2F,0x58,0x2F,0x9D,0x1F,0xD9,0x28        ;[13C0]
    defb 0x45,0x33,0x4E,0x33,0x9F,0x0E,0x76,0x62        ;[13C8]
    defb 0x79,0x62,0x7C,0x62,0x7F,0x62,0x82,0x62        ;[13D0]
    defb 0x85,0x62,0x09,0x0E,0x32,0x3B,0x32,0x3B        ;[13D8]
    defb 0x32,0x3B,0x32,0x3B,0x32,0x3B,0x00,0x00        ;[13E0]
    defb 0xA5,0x32,0x11,0x33,0x07,0x33,0x04,0x33        ;[13E8]
    defb 0xD8,0x1D,0x9A,0x30,0xC8,0x36,0xB0,0x37        ;[13F0]
    defb 0x6D,0x36,0x6A,0x36,0xDA,0x32,0xD0,0x32        ;[13F8]
    defb 0xBD,0x32,0xC2,0x32,0xD5,0x32,0xAF,0x32        ;[1400]
    defb 0xDF,0x32,0xF6,0x32,0x7F,0x0E,0x8B,0x0E        ;[1408]
    defb 0x95,0x0E,0x3F,0x0E,0x18,0x0E                  ;[1410]


DATA_XTTBL:
    defb 0x4B,0xCC,0x45,0x54,0xD6,0x44,0x55,0xC4        ;[1416]
    defb 0x45,0x46,0x50,0x52,0x4F,0x43,0xD0,0x52        ;[141E]
    defb 0x4F,0x43,0xC5,0x4E,0x44,0x50,0x52,0x4F        ;[1426]
    defb 0x43,0xCE,0x45,0x58,0x54,0xC9,0x4E,0x4B        ;[142E]
    defb 0xD0,0x41,0x50,0x45,0x52,0xD2,0x41,0x4E        ;[1436]
    defb 0x44,0x4F,0x4D,0xD6,0x45,0x52,0x49,0x46        ;[143E]
    defb 0x59,0xC4,0x50,0x4F,0x4B,0x45,0xC4,0x4F        ;[1446]
    defb 0x54,0xD0,0x4F,0x4B,0x45,0xC5,0x4E,0x44        ;[144E]
    defb 0xD3,0x54,0x4F,0x50,0xC6,0x4F,0x52,0xC7        ;[1456]
    defb 0x4F,0x54,0x4F,0xC7,0x4F,0x53,0x55,0x42        ;[145E]
    defb 0xD2,0x45,0x54,0x55,0x52,0x4E,0xC3,0x4C        ;[1466]
    defb 0x53,0xD2,0x55,0x4E,0xC3,0x4F,0x4E,0x54        ;[146E]
    defb 0xCF,0x55,0x54,0xD2,0x45,0x4D,0xD2,0x45        ;[1476]
    defb 0x41,0x44,0xC4,0x41,0x54,0x41,0xCE,0x45        ;[147E]
    defb 0x57,0xC4,0x45,0x4C,0xC1,0x55,0x54,0x4F        ;[1486]
    defb 0xD0,0x52,0x49,0x4E,0x54,0xCC,0x4F,0x41        ;[148E]
    defb 0x44,0xD3,0x41,0x56,0x45,0xD2,0x45,0x53        ;[1496]
    defb 0x54,0x4F,0x52,0x45,0xD0,0x4C,0x4F,0x54        ;[149E]
    defb 0xCD,0x4F,0x56,0x45,0xC4,0x52,0x41,0x57        ;[14A6]
    defb 0xC3,0x41,0x4C,0x4C,0xC9,0x4E,0x50,0x55        ;[14AE]
    defb 0x54,0xC4,0x49,0x4D,0xC9,0x46,0xCC,0x49        ;[14B6]
    defb 0x53,0x54,0xD7,0x49,0x4E,0x44,0x4F,0x57        ;[14BE]
    defb 0xD0,0x41,0x55,0x53,0x45,0xD2,0x4F,0x55        ;[14C6]
    defb 0x4E,0x44,0xD4,0x52,0x41,0x49,0x4C,0xCC        ;[14CE]
    defb 0x50,0x52,0x49,0x4E,0x54,0xCC,0x4C,0x49        ;[14D6]
    defb 0x53,0x54,0xCC,0x41,0x42,0x45,0x4C,0xC2        ;[14DE]
    defb 0x45,0x45,0x50,0xD3,0x4F,0x55,0x4E,0x44        ;[14E6]
    defb 0xC1,0x50,0x50,0x45,0x4E,0x44,0xC3,0x4F        ;[14EE]
    defb 0x44,0x45,0xCC,0x49,0x4E,0x4B,0xD3,0x57        ;[14F6]
    defb 0x41,0x50,0xD7,0x48,0x49,0x4C,0x45,0xD7        ;[14FE]
    defb 0x45,0x4E,0x44,0xD2,0x45,0x50,0x45,0x41        ;[1506]
    defb 0x54,0xD5,0x4E,0x54,0x49,0x4C,0xC0,0x40        ;[150E]
    defb 0x40,0x40,0x40,0xBF,0xC5,0x4C,0x53,0x45        ;[1516]
    defb 0xD2,0x45,0x53,0x45,0x52,0x56,0x45,0xCD        ;[151E]
    defb 0x4F,0x4E,0xD2,0x45,0x4E,0x55,0x4D,0xD8        ;[1526]
    defb 0x52,0x4F,0x4D,0xC5,0x58,0x54,0xC3,0x46        ;[152E]
    defb 0x52,0xC3,0x43,0x48,0x41,0x52,0xD4,0x52        ;[1536]
    defb 0x41,0x43,0x45,0xD3,0x50,0x45,0x45,0x44        ;[153E]
    defb 0xD0,0x52,0x4F,0x54,0x45,0x43,0x54,0xC5        ;[1546]
    defb 0x52,0x52,0x4F,0x52,0xD4,0x41,0x50,0x45        ;[154E]
    defb 0xCD,0x4C,0x4F,0x41,0x44,0xD4,0x45,0x58        ;[1556]
    defb 0x54,0x80                                      ;[155E]


DATA_XITBL:
    defb 0x7C,0x26,0xD4,0x0E,0x6F,0x29,0x5D,0x29        ;[1560]
    defb 0xDB,0x26,0xD8,0x26,0x07,0x27,0x07,0x27        ;[1568]
    defb 0xDB,0x26,0x16,0x26,0xBD,0x26,0xBD,0x26        ;[1570]
    defb 0xBD,0x26,0xDB,0x26,0xDB,0x26,0xDF,0x26        ;[1578]
    defb 0xC3,0x26,0xC3,0x26,0xDB,0x26,0xDB,0x26        ;[1580]
    defb 0x5D,0x26,0xDB,0x26,0xBD,0x26,0x3C,0x27        ;[1588]
    defb 0x39,0x26,0x3C,0x27,0xDB,0x26,0x68,0x26        ;[1590]
    defb 0x64,0x26,0x11,0x2A,0x16,0x26,0x1D,0x26        ;[1598]
    defb 0x5D,0x26,0xF4,0x0E,0xBD,0x26,0xBD,0x26        ;[15A0]
    defb 0x68,0x26,0x2C,0x26,0x66,0x2E,0xFD,0x26        ;[15A8]
    defb 0x64,0x26,0xF0,0x0E,0x07,0x27,0x06,0x26        ;[15B0]
    defb 0x06,0x26,0x11,0x2A,0x64,0x26,0x3C,0x27        ;[15B8]
    defb 0xF4,0x0E,0xBD,0x26,0x16,0x26,0x25,0x0F        ;[15C0]
    defb 0x06,0x26,0x45,0x27,0x07,0x27,0xDB,0x26        ;[15C8]
    defb 0xDB,0x26,0x07,0x27,0xF4,0x0E,0x04,0x0F        ;[15D0]
    defb 0xA9,0x27,0x07,0x27,0xDB,0x26,0x64,0x26        ;[15D8]
    defb 0xDB,0x26,0x21,0x62,0x07,0x27,0x07,0x27        ;[15E0]
    defb 0x06,0x26,0x07,0x27,0x07,0x27,0x07,0x27        ;[15E8]
    defb 0x07,0x27,0x16,0x26,0xDB,0x26                  ;[15F0]


DATA_XETBL:
    defb 0x48,0x21,0xE3,0x0E,0x4A,0x3B,0x04,0x29        ;[15F6]
    defb 0x88,0x29,0xDB,0x23,0x4B,0x0F,0x50,0x0F        ;[15FE]
    defb 0xA8,0x1F,0x5A,0x0C,0x8C,0x23,0x93,0x0F        ;[1606]
    defb 0x85,0x23,0xBE,0x1F,0x2F,0x1E,0x97,0x23        ;[160E]
    defb 0xA2,0x22,0x96,0x22,0x74,0x20,0xB1,0x1F        ;[1616]
    defb 0x80,0x22,0x6D,0x22,0x7D,0x23,0x5F,0x24        ;[161E]
    defb 0xC5,0x21,0x5F,0x24,0x83,0x20,0x3F,0x23        ;[1626]
    defb 0x8A,0x28,0xA9,0x29,0x8F,0x0C,0xCB,0x0B        ;[162E]
    defb 0x7D,0x21,0xA5,0x0F,0x55,0x0F,0x5F,0x0F        ;[1636]
    defb 0x5F,0x20,0x94,0x20,0xCB,0x2D,0x2C,0x24        ;[163E]
    defb 0xE9,0x22,0x31,0x08,0x22,0x21,0x73,0x24        ;[1646]
    defb 0x55,0x24,0x4E,0x22,0x38,0x23,0x5F,0x24        ;[164E]
    defb 0x3D,0x09,0x81,0x09,0x87,0x0C,0x5F,0x24        ;[1656]
    defb 0x7E,0x24,0x5F,0x22,0xD3,0x1F,0xC4,0x1F        ;[165E]
    defb 0x13,0x20,0xFA,0x1F,0x32,0x3B,0x32,0x3B        ;[1666]
    defb 0x5F,0x24,0x4E,0x2A,0x64,0x3B,0x7E,0x2A        ;[166E]
    defb 0x00,0xE0,0x24,0x62,0xAE,0x0E,0xB3,0x0E        ;[1676]
    defb 0x6E,0x24,0x60,0x24,0x2D,0x21,0x05,0x0E        ;[167E]
    defb 0x92,0x0D,0x62,0x3F,0x32,0x21                  ;[1686]

    LD    HL,DATA_INIT              ;[168D] 
    LD    DE,SYSVAR_STACK           ;[1690] 
    LD    BC,$00D3                  ;[1693] 
    LDIR                            ;[1696] 
    LD    HL,(SYSVAR_SOB)           ;[1698] 
    LD    (HL),$80                  ;[169B] 
    DEC   HL                        ;[169D] 
    LD    (HL),$0D                  ;[169E] 
    JP    $0DCB                     ;[16A0] 
    LD    A,($4000)                 ;[16A3] 
    OR    A                         ;[16A6] 
    CALL  Z,$4000                   ;[16A7] 
    CALL  $1F6E                     ;[16AA] 
    LD    HL,$6000                  ;[16AD] 
    LD    (HL),$0D                  ;[16B0] 
    ADD   HL,SP                     ;[16B2] 
    LD    HL,DATA_LYNX_LOGO         ;[16B3] 
    JR    NC,$16BC                  ;[16B6] 
    LD    HL,$17EB                  ;[16B8] 
    NOP                             ;[16BB] 
    CALL  LYNX_PLINE                ;[16BC] 
    CALL  SUB_MAIN                  ;[16BF] 
    JR    $16BF                     ;[16C2] 

SUB_MAIN:
    LD    HL,$0DEF                  ;[16C4] Primary routine - called from MAIN routine.
    CALL  LYNX_PLINE                ;[16C7] 
    LD    A,(SYSVAR_AUTOFL)         ;[16CA] 
    OR    A                         ;[16CD] 
    JR    Z,$16E5                   ;[16CE] 
    LD    HL,SYSVAR_AUTOST          ;[16D0] 
    CALL  LYNX_LNUM1                ;[16D3] 
    CALL  LYNX_FNDLN                ;[16D6] 
    LD    A,$20                     ;[16D9] 
    JR    NZ,$16DF                  ;[16DB] 
    LD    A,$21                     ;[16DD] 
    PUSH  AF                        ;[16DF] 
    CALL  LYNX_PN                   ;[16E0] 
    POP   AF                        ;[16E3] 
    RST   $08                       ;[16E4] 
    CALL  SYSVAR_LINP               ;[16E5] 
    JR    NZ,$16F0                  ;[16E8] 
    LD    HL,SYSVAR_AUTOFL          ;[16EA] 
    LD    (HL),$00                  ;[16ED] 
    RET                             ;[16EF] 

    LD    (SYSVAR_STACK),SP         ;[16F0] 
    LD    DE,$6000                  ;[16F4] 
    CALL  $2524                     ;[16F7] 
    LD    A,(SYSVAR_AUTOFL)         ;[16FA] 
    OR    A                         ;[16FD] 
    JR    Z,SUB_MAIN                ;[16FE] 
    LD    HL,SYSVAR_AUTOST          ;[1700] 
    CALL  LYNX_LNUM1                ;[1703] 
    LD    HL,$62F8                  ;[1706] 
    CALL  LYNX_LNUM2                ;[1709] 
    CALL  LYNX_AD                   ;[170C] 
    LD    DE,SYSVAR_AUTOST          ;[170F] 
    JP    $275C                     ;[1712] 

DATA_INIT:
    defb 0x00,0xFF,0x01,0x00,0x00,0x00,0x00,0x00        ;[1715]
    defb 0x05,0x36,0x4C,0x69,0x4D,0x69,0x4D,0x69        ;[171D]
    defb 0x07,0x63,0xA4,0x06,0x5F,0x24,0x5B,0x0B        ;[1725]
    defb 0x01,0x00,0x01,0x00,0x00,0x07,0x66,0x07        ;[172D]
    defb 0x66,0x07,0x67,0x10,0x68,0xE4,0x68,0x68        ;[1735]
    defb 0x13,0xE1,0x11,0x16,0x14,0x60,0x15,0xF6        ;[173D]
    defb 0x15,0x4E,0x69,0xC3,0x3C,0x27,0xC3,0x32        ;[1745]
    defb 0x3B,0xC9,0x00,0x00,0xC9,0x00,0x00,0x01        ;[174D]
    defb 0x00,0x18,0x35,0x00,0x00,0x00,0x08,0x00        ;[1755]
    defb 0x00,0x00,0x00,0x00,0x1C,0x30,0x15,0x1B        ;[175D]
    defb 0x19,0x02,0x10,0x11,0x25,0x2F,0x3E,0x28        ;[1765]
    defb 0x12,0x05,0x04,0x03,0x17,0x38,0x0E,0x44        ;[176D]
    defb 0x39,0x09,0x36,0x37,0x14,0x20,0x03,0x05        ;[1775]
    defb 0x03,0x7B,0x05,0xF5,0x00,0x07,0x00,0x00        ;[177D]
    defb 0x02,0x20,0xEF,0x00,0xC3,0xBE,0x0F,0x00        ;[1785]
    defb 0x00,0x00,0x00,0x00,0x00,0x00,0xC3,0x5E        ;[178D]
    defb 0x08,0x94,0x00,0xD4,0x01,0x20,0x00,0x00        ;[1795]
    defb 0xC3,0x32,0x3B,0xC3,0x32,0x3B,0xC3,0x32        ;[179D]
    defb 0x3B,0xC3,0x32,0x3B,0xC3,0x32,0x3B,0xC3        ;[17A5]
    defb 0x32,0x3B,0xC9,0x00,0x00,0xC9,0x00,0x00        ;[17AD]
    defb 0x00,0x80,0x00,0xC0,0x00,0xC0,0xC3,0x32        ;[17B5]
    defb 0x3B,0xC3,0x32,0x3B,0xEF,0x38,0x50,0x01        ;[17BD]
    defb 0x04,0x03,0x28,0x09,0x0D,0xC3,0xD4,0x0C        ;[17C5]
    defb 0xC3,0x67,0x0D,0xC3,0xD7,0x18,0xC3,0xBE        ;[17CD]
    defb 0x19,0xC3,0xA9,0x33,0xC3,0xE5,0x27,0xC3        ;[17D5]
    defb 0xE5,0x24,0xC3,0x9A,0x00,0xC3,0xE2,0x10        ;[17DD]
    defb 0xC3,0x5C,0x2D,0x00                            ;[17E5]


DATA_PROMPT:
    defb 0x04,0x07,0x04,0x07                            ;[17E9]


DATA_LYNX_LOGO:
    defb 0x04,0x07,0x18,0xF3,0xF4,0xF5,0xF6,0xF7        ;[17ED]
    defb 0xF8,0xF9,0x19,0x0A,0x0A,0x0D,0x00             ;[17F5]

    LD    A,(DE)                    ;[17FC] BASIC line analysis routine.
    INC   DE                        ;[17FD] 
    CP    $7C                       ;[17FE] 
    JR    Z,$181F                   ;[1800] 
    CP    $79                       ;[1802] 
    JR    Z,$181F                   ;[1804] 
    CP    $85                       ;[1806] 
    JR    Z,$17FC                   ;[1808] 
    CP    $87                       ;[180A] 
    JR    Z,$17FC                   ;[180C] 
    CP    $86                       ;[180E] 
    JR    Z,$17FC                   ;[1810] 
    CP    $7A                       ;[1812] 
    JR    Z,$1819                   ;[1814] 
    CP    $7E                       ;[1816] 
    RET   NZ                        ;[1818] 
    INC   DE                        ;[1819] 
    INC   DE                        ;[181A] 
    INC   DE                        ;[181B] 
    INC   DE                        ;[181C] 
    INC   DE                        ;[181D] 
    RET                             ;[181E] 

    CALL  $17FC                     ;[181F] Line analysis subroutine.
    CP    $7B                       ;[1822] 
    JR    NZ,$181F                  ;[1824] 
    RET                             ;[1826] 

    PUSH  DE                        ;[1827] Line analysis subroutine.
    CALL  $2808                     ;[1828] 
    POP   DE                        ;[182B] 
    RET                             ;[182C] 

    LD    A,(DE)                    ;[182D] Line analysis subroutine.
    CP    $7C                       ;[182E] 
    JR    Z,$1827                   ;[1830] 
    CP    $80                       ;[1832] 
    JR    NC,$1857                  ;[1834] 
    CP    $7E                       ;[1836] 
    JR    Z,$184C                   ;[1838] 
    CP    $7A                       ;[183A] 
    JR    Z,$187B                   ;[183C] 
    RES   6,A                       ;[183E] 
    ADD   A,$40                     ;[1840] 
    CP    $5B                       ;[1842] 
    JP    C,$351B                   ;[1844] 
    ADD   A,$06                     ;[1847] 
    JP    $351B                     ;[1849] 
    PUSH  DE                        ;[184C] 
    INC   DE                        ;[184D] 
    EX    DE,HL                     ;[184E] 
    CALL  LYNX_LNUM1                ;[184F] 
    CALL  LYNX_PN                   ;[1852] 
    POP   DE                        ;[1855] 
    RET                             ;[1856] 

    CP    $85                       ;[1857] Line analysis subroutine.
    JR    Z,$1863                   ;[1859] 
    CP    $87                       ;[185B] 
    JR    Z,$1863                   ;[185D] 
    CP    $86                       ;[185F] 
    JR    NZ,$186D                  ;[1861] 
    CALL  $186D                     ;[1863] 
    PUSH  DE                        ;[1866] 
    INC   DE                        ;[1867] 
    CALL  $1827                     ;[1868] 
    POP   DE                        ;[186B] 
    RET                             ;[186C] 

    CALL  SUB_WORD_LIST             ;[186D] Line analysis subroutine.
    LD    A,(HL)                    ;[1870] 
    RES   7,A                       ;[1871] 
    RST   $08                       ;[1873] 
    INC   HL                        ;[1874] 
    BIT   7,(HL)                    ;[1875] 
    RET   NZ                        ;[1877] 
    LD    A,(HL)                    ;[1878] 
    JR    $1873                     ;[1879] 
    PUSH  DE                        ;[187B] 
    LD    A,$26                     ;[187C] 
    RST   $08                       ;[187E] 
    INC   DE                        ;[187F] 
    EX    DE,HL                     ;[1880] 
    CALL  LYNX_LNUM1                ;[1881] 
    CALL  LYNX_FPINT                ;[1884] 
    CALL  LYNX_PHEXHL               ;[1887] 
    POP   DE                        ;[188A] 
    RET                             ;[188B] 

SUB_WORD_LIST:
    SUB   $7F                       ;[188C] Pick up address of a list of words.
    LD    B,A                       ;[188E] 
    LD    HL,(SYSVAR_TTBL)          ;[188F] 
    DEC   HL                        ;[1892] 
    INC   HL                        ;[1893] Loop down a list of words to find an address.
    BIT   7,(HL)                    ;[1894] 
    JR    Z,$1893                   ;[1896] 
    DJNZ  $1893                     ;[1898] 
    RET                             ;[189A] 

    CP    $C2                       ;[189B] Line analysis subroutine.
    RET   NC                        ;[189D] 
    CP    $BF                       ;[189E] 
    RET   C                         ;[18A0] 
    POP   IX                        ;[18A1] 
    JR    $18B3                     ;[18A3] 
    POP   IX                        ;[18A5] 
    CP    $C5                       ;[18A7] 
    JR    C,$18C9                   ;[18A9] 
    CP    $D0                       ;[18AB] 
    JR    C,$18B3                   ;[18AD] 
    LD    HL,$2020                  ;[18AF] 
    PUSH  HL                        ;[18B2] 
    LD    C,A                       ;[18B3] 
    INC   A                         ;[18B4] 
    CALL  SUB_WORD_LIST             ;[18B5] 
    DEC   HL                        ;[18B8] 
    LD    A,(HL)                    ;[18B9] 
    BIT   7,A                       ;[18BA] 
    RES   7,A                       ;[18BC] 
    PUSH  AF                        ;[18BE] 
    JR    Z,$18B8                   ;[18BF] 
    LD    A,C                       ;[18C1] 
    CP    $D0                       ;[18C2] 
    JR    C,$18C9                   ;[18C4] 
    LD    A,$20                     ;[18C6] 
    PUSH  AF                        ;[18C8] 
    JP    (IX)                      ;[18C9] 
    POP   IX                        ;[18CB] 
    POP   AF                        ;[18CD] 
    OR    A                         ;[18CE] 
    JR    Z,$18D4                   ;[18CF] 
    RST   $08                       ;[18D1] 
    JR    $18CD                     ;[18D2] 
    PUSH  AF                        ;[18D4] 
    JP    (IX)                      ;[18D5] 
    XOR   A                         ;[18D7] 
    PUSH  AF                        ;[18D8] 
    LD    IY,SYSVAR_SYNL            ;[18D9] 
    LD    A,(DE)                    ;[18DD] 
    CP    $7F                       ;[18DE] 
    JP    Z,$1941                   ;[18E0] 
    CP    $BF                       ;[18E3] 
    JR    C,$18F1                   ;[18E5] 
    LD    A,$29                     ;[18E7] 
    CALL  Z,$351B                   ;[18E9] 
    CALL  $17FC                     ;[18EC] 
    JR    $18DD                     ;[18EF] 
    LD    (IY+$00),$00              ;[18F1] 
    LD    L,E                       ;[18F5] 
    LD    H,D                       ;[18F6] 
    INC   (IY+$00)                  ;[18F7] 
    DEC   (IY+$00)                  ;[18FA] 
    JP    M,$1932                   ;[18FD] 
    CALL  $17FC                     ;[1900] 
    LD    A,(DE)                    ;[1903] 
    CP    $7F                       ;[1904] 
    JR    Z,$1932                   ;[1906] 
    CP    $BF                       ;[1908] 
    JP    NC,$1912                  ;[190A] 
    INC   (IY+$00)                  ;[190D] 
    JR    $18F7                     ;[1910] 
    CP    $C3                       ;[1912] 
    JR    C,$1919                   ;[1914] 
    DEC   (IY+$00)                  ;[1916] 
    EXX                             ;[1919] 
    INC   (IY+$00)                  ;[191A] 
    DEC   (IY+$00)                  ;[191D] 
    CALL  Z,$189B                   ;[1920] 
    INC   (IY+$00)                  ;[1923] 
    PUSH  AF                        ;[1926] 
    DEC   (IY+$00)                  ;[1927] 
    POP   AF                        ;[192A] 
    CALL  Z,$18A5                   ;[192B] 
    EXX                             ;[192E] 
    JP    $18F7                     ;[192F] 
    CALL  $18CB                     ;[1932] 
    LD    E,L                       ;[1935] 
    LD    D,H                       ;[1936] 
    LD    A,(DE)                    ;[1937] 
    CALL  $182D                     ;[1938] 
    CALL  $17FC                     ;[193B] 
    JP    $18DD                     ;[193E] 
    POP   AF                        ;[1941] 
    RET                             ;[1942] 

SUB_BASIC_WORD:
    LD    HL,(SYSVAR_TTBL)          ;[1943] Pick up address from a list of BASIC words.
    DEC   HL                        ;[1946] 
    LD    B,$80                     ;[1947] 
    CALL  $197E                     ;[1949] Find word in list, return address if pos.
    INC   HL                        ;[194C] 
    BIT   7,(HL)                    ;[194D] 
    JR    Z,$194C                   ;[194F] 
    CP    (HL)                      ;[1951] 
    JR    Z,$1959                   ;[1952] 
    DJNZ  $194C                     ;[1954] 
    LD    A,(DE)                    ;[1956] 
    SCF                             ;[1957] 
    RET                             ;[1958] 

    PUSH  DE                        ;[1959] 
    INC   DE                        ;[195A] 
    INC   HL                        ;[195B] 
    EX    DE,HL                     ;[195C] 
    RST   $10                       ;[195D] 
    EX    DE,HL                     ;[195E] 
    RST   $10                       ;[195F] 
    BIT   7,(HL)                    ;[1960] 
    JR    NZ,$1979                  ;[1962] 
    CP    $2E                       ;[1964] 
    JR    Z,$1977                   ;[1966] 
    CP    $40                       ;[1968] 
    JR    C,$196E                   ;[196A] 
    AND   $DF                       ;[196C] 
    CP    (HL)                      ;[196E] 
    JR    Z,$195A                   ;[196F] 
    POP   DE                        ;[1971] 
    CALL  $197E                     ;[1972] 
    JR    $1954                     ;[1975] 
    INC   DE                        ;[1977] 
    RST   $10                       ;[1978] 
    POP   HL                        ;[1979] 
    XOR   A                         ;[197A] 
    SUB   B                         ;[197B] 
    OR    A                         ;[197C] 
    RET                             ;[197D] 

    RST   $10                       ;[197E] Search for start of BASIC word in a list.
    OR    $80                       ;[197F] 
    CP    $C0                       ;[1981] 
    RET   C                         ;[1983] 
    AND   $DF                       ;[1984] 
    RET                             ;[1986] 

    LD    B,(IX+$02)                ;[1987] Normal to internal language routine.
    LD    C,(IX+$00)                ;[198A] 
    PUSH  IX                        ;[198D] 
    PUSH  BC                        ;[198F] 
    LD    (HL),$7C                  ;[1990] 
    INC   HL                        ;[1992] 
    CALL  $2C9D                     ;[1993] 
    RST   $10                       ;[1996] 
    CP    $3D                       ;[1997] 
    JR    Z,$19A0                   ;[1999] 
    CP    $3E                       ;[199B] 
    CALL  NZ,$3B38                  ;[199D] 
    LD    (HL),A                    ;[19A0] 
    INC   HL                        ;[19A1] 
    INC   DE                        ;[19A2] 
    CALL  $2C9D                     ;[19A3] 
    LD    (HL),$7B                  ;[19A6] 
    INC   HL                        ;[19A8] 
    POP   BC                        ;[19A9] 
    POP   IX                        ;[19AA] 
    LD    (IX+$02),B                ;[19AC] 
    LD    (IX+$00),C                ;[19AF] 
    LD    (IX+$01),$01              ;[19B2] 
    INC   (IX+$02)                  ;[19B6] 
    LD    A,$01                     ;[19B9] 
    JP    $19D1                     ;[19BB] 
    XOR   A                         ;[19BE] 
    PUSH  AF                        ;[19BF] 
    LD    IX,SYSVAR_SYNL            ;[19C0] 
    LD    (IX+$00),$04              ;[19C4] 
    LD    (IX+$01),$04              ;[19C8] 
    LD    (IX+$02),$FF              ;[19CC] 
    XOR   A                         ;[19D0] 
    LD    (SYSVAR_NPM),A            ;[19D1] 
    CALL  $1B70                     ;[19D4] 
    RST   $10                       ;[19D7] 
    CALL  $2B4B                     ;[19D8] 
    JR    Z,$1987                   ;[19DB] 
    LD    A,(DE)                    ;[19DD] 
    CP    $2D                       ;[19DE] 
    JP    Z,$1AF7                   ;[19E0] 
    CP    $28                       ;[19E3] 
    JP    Z,$1A8F                   ;[19E5] 
    CP    $29                       ;[19E8] 
    JP    Z,$1AA8                   ;[19EA] 
    CALL  $2D08                     ;[19ED] 
    JP    NC,$1A2B                  ;[19F0] 
    CALL  $34F5                     ;[19F3] 
    JP    NC,$1AC4                  ;[19F6] 
    CALL  $34ED                     ;[19F9] 
    JP    NC,$1AD8                  ;[19FC] 
    CP    $26                       ;[19FF] 
    JP    Z,$1AD4                   ;[1A01] 
    CP    $2E                       ;[1A04] 
    JP    Z,$1AD8                   ;[1A06] 
    LD    (IX+$01),$08              ;[1A09] 
    CALL  $1B70                     ;[1A0D] 
    POP   AF                        ;[1A10] 
    OR    A                         ;[1A11] 
    JR    Z,$1A20                   ;[1A12] 
    CP    $28                       ;[1A14] 
    CALL  Z,$3B44                   ;[1A16] 
    LD    (HL),A                    ;[1A19] 
    INC   HL                        ;[1A1A] 
    CALL  $1B32                     ;[1A1B] 
    JR    $1A10                     ;[1A1E] 
    LD    (HL),$7F                  ;[1A20] 
    INC   HL                        ;[1A22] 
    XOR   A                         ;[1A23] 
    OR    (IX+$02)                  ;[1A24] 
    CALL  NZ,$3B38                  ;[1A27] 
    RET                             ;[1A2A] 

    LD    (SYSVAR_NPM),A            ;[1A2B] 
    CP    $C0                       ;[1A2E] 
    JP    Z,$1B02                   ;[1A30] 
    CP    $D7                       ;[1A33] 
    JR    NC,$1A09                  ;[1A35] 
    CP    $BF                       ;[1A37] 
    JP    NC,$1B0A                  ;[1A39] 
    LD    (HL),A                    ;[1A3C] 
    INC   HL                        ;[1A3D] 
    INC   (IX+$02)                  ;[1A3E] 
    LD    B,$C3                     ;[1A41] 
    LD    C,$03                     ;[1A43] 
    CP    $9B                       ;[1A45] 
    JR    NC,$1A89                  ;[1A47] 
    LD    B,$C2                     ;[1A49] 
    INC   (IX+$02)                  ;[1A4B] 
    LD    (IX+$03),$00              ;[1A4E] 
    CP    $85                       ;[1A52] 
    JR    Z,$1A5E                   ;[1A54] 
    CP    $87                       ;[1A56] 
    JR    Z,$1A5E                   ;[1A58] 
    CP    $86                       ;[1A5A] 
    JR    NZ,$1A87                  ;[1A5C] 
    PUSH  BC                        ;[1A5E] 
    CALL  $2B4B                     ;[1A5F] 
    CALL  NZ,$3B23                  ;[1A62] 
    LD    (HL),$79                  ;[1A65] 
    INC   HL                        ;[1A67] 
    PUSH  IX                        ;[1A68] 
    LD    B,(IX+$02)                ;[1A6A] 
    LD    C,(IX+$00)                ;[1A6D] 
    PUSH  BC                        ;[1A70] 
    CALL  $2C9D                     ;[1A71] 
    POP   BC                        ;[1A74] 
    POP   IX                        ;[1A75] 
    LD    (IX+$00),C                ;[1A77] 
    LD    (IX+$02),B                ;[1A7A] 
    RST   $10                       ;[1A7D] 
    RST   $20                       ;[1A7E] 
    ADD   HL,HL                     ;[1A7F] 
    LD    (HL),A                    ;[1A80] 
    INC   HL                        ;[1A81] 
    INC   DE                        ;[1A82] 
    LD    (HL),$7B                  ;[1A83] 
    INC   HL                        ;[1A85] 
    POP   BC                        ;[1A86] 
    LD    C,$02                     ;[1A87] 
    LD    (IX+$01),C                ;[1A89] 
    JP    $1B0F                     ;[1A8C] 
    PUSH  AF                        ;[1A8F] 
    INC   DE                        ;[1A90] 
    LD    A,(SYSVAR_SYNL)           ;[1A91] 
    CP    $01                       ;[1A94] 
    JR    NZ,$1AA1                  ;[1A96] 
    POP   BC                        ;[1A98] 
    LD    A,$C4                     ;[1A99] 
    PUSH  AF                        ;[1A9B] 
    PUSH  BC                        ;[1A9C] 
    DEC   HL                        ;[1A9D] 
    SET   6,(HL)                    ;[1A9E] 
    INC   HL                        ;[1AA0] 
    LD    (IX+$01),$04              ;[1AA1] 
    JP    $19D0                     ;[1AA5] 
    POP   AF                        ;[1AA8] 
    CP    $28                       ;[1AA9] 
    JR    Z,$1AB8                   ;[1AAB] 
    OR    A                         ;[1AAD] 
    JP    Z,$1A20                   ;[1AAE] 
    LD    (HL),A                    ;[1AB1] 
    INC   HL                        ;[1AB2] 
    CALL  $1B32                     ;[1AB3] 
    JR    $1AA8                     ;[1AB6] 
    LD    A,$BF                     ;[1AB8] 
    INC   DE                        ;[1ABA] 
    LD    (HL),A                    ;[1ABB] 
    INC   HL                        ;[1ABC] 
    LD    (IX+$01),$05              ;[1ABD] 
    JP    $19D1                     ;[1AC1] 
    CALL  $3504                     ;[1AC4] 
    LD    (HL),A                    ;[1AC7] 
    INC   HL                        ;[1AC8] 
    INC   DE                        ;[1AC9] 
    LD    (IX+$01),$01              ;[1ACA] 
    INC   (IX+$02)                  ;[1ACE] 
    JP    $19D1                     ;[1AD1] 
    LD    (HL),$7A                  ;[1AD4] 
    JR    $1ADA                     ;[1AD6] 
    LD    (HL),$7E                  ;[1AD8] 
    INC   HL                        ;[1ADA] 
    PUSH  HL                        ;[1ADB] 
    CALL  LYNX_RDN                  ;[1ADC] 
    POP   HL                        ;[1ADF] 
    PUSH  DE                        ;[1AE0] 
    EX    DE,HL                     ;[1AE1] 
    LD    HL,SYSVAR_WRA1            ;[1AE2] 
    LD    BC,$0005                  ;[1AE5] 
    LDIR                            ;[1AE8] 
    EX    DE,HL                     ;[1AEA] 
    POP   DE                        ;[1AEB] 
    LD    A,$02                     ;[1AEC] 
    LD    (SYSVAR_SYNP),A           ;[1AEE] 
    INC   (IX+$02)                  ;[1AF1] 
    JP    $19D1                     ;[1AF4] 
    LD    A,(SYSVAR_NPM)            ;[1AF7] 
    OR    A                         ;[1AFA] 
    LD    A,$C9                     ;[1AFB] 
    INC   DE                        ;[1AFD] 
    JR    NZ,$1B0A                  ;[1AFE] 
    LD    A,$C1                     ;[1B00] 
    PUSH  AF                        ;[1B02] 
    LD    (IX+$01),$06              ;[1B03] 
    JP    $19D0                     ;[1B07] 
    LD    B,A                       ;[1B0A] 
    LD    (IX+$01),$07              ;[1B0B] 
    POP   AF                        ;[1B0F] 
    OR    A                         ;[1B10] 
    JR    Z,$1B25                   ;[1B11] 
    CP    $28                       ;[1B13] 
    JR    Z,$1B25                   ;[1B15] 
    LD    C,A                       ;[1B17] 
    CALL  $1B42                     ;[1B18] 
    LD    A,C                       ;[1B1B] 
    JR    C,$1B25                   ;[1B1C] 
    LD    (HL),A                    ;[1B1E] 
    INC   HL                        ;[1B1F] 
    CALL  $1B32                     ;[1B20] 
    JR    $1B0F                     ;[1B23] 
    PUSH  AF                        ;[1B25] 
    PUSH  BC                        ;[1B26] 
    LD    A,(IX+$03)                ;[1B27] 
    OR    A                         ;[1B2A] 
    JP    NZ,$19D0                  ;[1B2B] 
    INC   A                         ;[1B2E] 
    JP    $19D1                     ;[1B2F] 
    CP    $C1                       ;[1B32] 
    RET   Z                         ;[1B34] 
    CP    $BF                       ;[1B35] 
    RET   Z                         ;[1B37] 
    CP    $C0                       ;[1B38] 
    RET   Z                         ;[1B3A] 
    DEC   (IX+$02)                  ;[1B3B] 
    CALL  M,$3B38                   ;[1B3E] 
    RET                             ;[1B41] 

    PUSH  HL                        ;[1B42] 
    PUSH  DE                        ;[1B43] 
    LD    DE,$1A95                  ;[1B44] 
    LD    H,$00                     ;[1B47] 
    LD    L,C                       ;[1B49] 
    ADD   HL,DE                     ;[1B4A] 
    LD    A,(HL)                    ;[1B4B] 
    LD    H,$00                     ;[1B4C] 
    LD    L,B                       ;[1B4E] 
    ADD   HL,DE                     ;[1B4F] 
    CP    (HL)                      ;[1B50] 
    POP   DE                        ;[1B51] 
    POP   HL                        ;[1B52] 
    RET                             ;[1B53] 

    NOP                             ;[1B54] This looks like data : No idea
    LD    B,$0E                     ;[1B55] 
    INC   D                         ;[1B57] 
    LD    (DE),A                    ;[1B58] 
    LD    D,$10                     ;[1B59] 
    INC   C                         ;[1B5B] 
    INC   C                         ;[1B5C] 
    LD    A,(BC)                    ;[1B5D] 
    LD    A,(BC)                    ;[1B5E] 
    EX    AF,AF'                    ;[1B5F] 
    EX    AF,AF'                    ;[1B60] 
    EX    AF,AF'                    ;[1B61] 
    EX    AF,AF'                    ;[1B62] 
    EX    AF,AF'                    ;[1B63] 
    EX    AF,AF'                    ;[1B64] 
    LD    (BC),A                    ;[1B65] 
    INC   B                         ;[1B66] 
    LD    (BC),A                    ;[1B67] 
    LD    (BC),A                    ;[1B68] 
    INC   B                         ;[1B69] 
    INC   C                         ;[1B6A] 
    INC   C                         ;[1B6B] 
    INC   C                         ;[1B6C] 
    INC   C                         ;[1B6D] 
    INC   C                         ;[1B6E] 
    INC   C                         ;[1B6F] 
    PUSH  HL                        ;[1B70] Line analysis subroutine.
    LD    A,(SYSVAR_SYNL)           ;[1B71] 
    LD    BC,$1B90                  ;[1B74] 
    LD    L,A                       ;[1B77] 
    LD    H,$00                     ;[1B78] 
    ADD   HL,BC                     ;[1B7A] 
    LD    A,(SYSVAR_SYNP)           ;[1B7B] 
    LD    (SYSVAR_SYNL),A           ;[1B7E] 
    LD    C,$01                     ;[1B81] 
    DEC   A                         ;[1B83] 
    JR    Z,$1B8A                   ;[1B84] 
    SLA   C                         ;[1B86] 
    JR    $1B83                     ;[1B88] 
    LD    A,C                       ;[1B8A] 
    AND   (HL)                      ;[1B8B] 
    CALL  Z,$3B3B                   ;[1B8C] 
    POP   HL                        ;[1B8F] 
    RET                             ;[1B90] 

    RET   C                         ;[1B91] This looks like data: No idea
    RET   NC                        ;[1B92] 
    EX    AF,AF'                    ;[1B93] 
    CPL                             ;[1B94] 
    RET   NC                        ;[1B95] 
    RRCA                            ;[1B96] 
    CPL                             ;[1B97] 

LYNX_RDN:
    LD    A,(DE)                    ;[1B98] Reads number pointed to by DE into WRA1 as floating point. (Asc l) 
    CP    $45                       ;[1B99] 
    JR    Z,$1BC6                   ;[1B9B] 
    CP    $26                       ;[1B9D] 
    JR    NZ,$1BCC                  ;[1B9F] 
    LD    HL,START                  ;[1BA1] 
    INC   DE                        ;[1BA4] 
    LD    A,(DE)                    ;[1BA5] 
    SUB   $30                       ;[1BA6] 
    JR    C,$1BC0                   ;[1BA8] 
    CP    $0A                       ;[1BAA] 
    JR    C,$1BB8                   ;[1BAC] 
    SUB   $07                       ;[1BAE] 
    CP    $0A                       ;[1BB0] 
    JR    C,$1BC0                   ;[1BB2] 
    CP    $10                       ;[1BB4] 
    JR    NC,$1BC0                  ;[1BB6] 
    ADD   HL,HL                     ;[1BB8] 
    ADD   HL,HL                     ;[1BB9] 
    ADD   HL,HL                     ;[1BBA] 
    ADD   HL,HL                     ;[1BBB] 
    ADD   A,L                       ;[1BBC] 
    LD    L,A                       ;[1BBD] 
    JR    $1BA4                     ;[1BBE] 
    PUSH  DE                        ;[1BC0] 
    CALL  LYNX_INTFP                ;[1BC1] 
    POP   DE                        ;[1BC4] 
    RET                             ;[1BC5] 

    PUSH  DE                        ;[1BC6] 
    CALL  LYNX_LZERO                ;[1BC7] 
    POP   DE                        ;[1BCA] 
    RET                             ;[1BCB] 

    LD    C,$C0                     ;[1BCC] 
    CALL  LYNX_ZWRA1                ;[1BCE] 
    LD    A,(DE)                    ;[1BD1] 
    CP    $2D                       ;[1BD2] 
    EX    AF,AF'                    ;[1BD4] 
    LD    A,(DE)                    ;[1BD5] 
    CP    $2D                       ;[1BD6] 
    JR    NZ,$1BDD                  ;[1BD8] 
    RES   7,C                       ;[1BDA] 
    INC   DE                        ;[1BDC] 
    LD    A,(DE)                    ;[1BDD] 
    CP    $30                       ;[1BDE] 
    JR    Z,$1BDC                   ;[1BE0] 
    CP    $2E                       ;[1BE2] 
    JR    Z,$1C3D                   ;[1BE4] 
    SUB   $30                       ;[1BE6] 
    CP    $0A                       ;[1BE8] 
    JR    NC,$1C17                  ;[1BEA] 
    LD    B,$08                     ;[1BEC] 
    DEC   C                         ;[1BEE] 
    LD    A,(DE)                    ;[1BEF] 
    CP    $2E                       ;[1BF0] 
    JR    Z,$1C47                   ;[1BF2] 
    SUB   $30                       ;[1BF4] 
    CP    $0A                       ;[1BF6] 
    JR    NC,$1C12                  ;[1BF8] 
    INC   C                         ;[1BFA] 
    CALL  $3657                     ;[1BFB] 
    INC   DE                        ;[1BFE] 
    DJNZ  $1BEF                     ;[1BFF] 
    DEC   DE                        ;[1C01] 
    DEC   C                         ;[1C02] 
    LD    A,(DE)                    ;[1C03] 
    CP    $2E                       ;[1C04] 
    JR    Z,$1C54                   ;[1C06] 
    SUB   $30                       ;[1C08] 
    CP    $0A                       ;[1C0A] 
    JR    NC,$1C17                  ;[1C0C] 
    INC   DE                        ;[1C0E] 
    INC   C                         ;[1C0F] 
    JR    $1C03                     ;[1C10] 
    CALL  $3656                     ;[1C12] 
    DJNZ  $1C12                     ;[1C15] 
    LD    A,(SYSVAR_WRA1)           ;[1C17] 
    OR    C                         ;[1C1A] 
    PUSH  AF                        ;[1C1B] 
    CALL  $1C5E                     ;[1C1C] 
    POP   AF                        ;[1C1F] 
    ADD   A,L                       ;[1C20] 
    BIT   7,A                       ;[1C21] 
    JR    Z,$1C2B                   ;[1C23] 
    EX    AF,AF'                    ;[1C25] 
    CALL  Z,$3B3E                   ;[1C26] 
    JR    $1C2F                     ;[1C29] 
    EX    AF,AF'                    ;[1C2B] 
    CALL  NZ,$3B3E                  ;[1C2C] 
    EX    AF,AF'                    ;[1C2F] 
    LD    (SYSVAR_WRA1),A           ;[1C30] 
    LD    A,($62E6)                 ;[1C33] 
    OR    A                         ;[1C36] 
    PUSH  DE                        ;[1C37] 
    CALL  Z,LYNX_LZERO              ;[1C38] 
    POP   DE                        ;[1C3B] 
    RET                             ;[1C3C] 

    INC   DE                        ;[1C3D] Number analysis.
    LD    A,(DE)                    ;[1C3E] 
    DEC   C                         ;[1C3F] 
    CP    $30                       ;[1C40] 
    JR    Z,$1C3D                   ;[1C42] 
    LD    B,$08                     ;[1C44] 
    DEC   DE                        ;[1C46] 
    INC   DE                        ;[1C47] 
    LD    A,(DE)                    ;[1C48] 
    SUB   $30                       ;[1C49] 
    CP    $0A                       ;[1C4B] 
    JR    NC,$1C12                  ;[1C4D] 
    CALL  $3657                     ;[1C4F] 
    DJNZ  $1C47                     ;[1C52] 
    INC   DE                        ;[1C54] 
    LD    A,(DE)                    ;[1C55] 
    SUB   $30                       ;[1C56] 
    CP    $0A                       ;[1C58] 
    JR    C,$1C54                   ;[1C5A] 
    JR    $1C17                     ;[1C5C] 
    LD    L,$00                     ;[1C5E] 
    LD    A,(DE)                    ;[1C60] 
    CP    $45                       ;[1C61] 
    RET   NZ                        ;[1C63] 
    INC   DE                        ;[1C64] 
    LD    A,(DE)                    ;[1C65] 
    CP    $2D                       ;[1C66] 
    JR    Z,$1C91                   ;[1C68] 
    CP    $2B                       ;[1C6A] 
    INC   DE                        ;[1C6C] 
    JR    Z,$1C77                   ;[1C6D] 
    DEC   DE                        ;[1C6F] 
    CALL  $34ED                     ;[1C70] 
    JR    NC,$1C77                  ;[1C73] 
    DEC   DE                        ;[1C75] 
    RET                             ;[1C76] 

    LD    A,(DE)                    ;[1C77] 
    SUB   $30                       ;[1C78] 
    CP    $0A                       ;[1C7A] 
    RET   NC                        ;[1C7C] 
    LD    L,A                       ;[1C7D] 
    INC   DE                        ;[1C7E] 
    LD    A,(DE)                    ;[1C7F] 
    SUB   $30                       ;[1C80] 
    CP    $0A                       ;[1C82] 
    RET   NC                        ;[1C84] 
    PUSH  AF                        ;[1C85] 
    LD    A,L                       ;[1C86] 
    RLCA                            ;[1C87] 
    RLCA                            ;[1C88] 
    ADD   A,L                       ;[1C89] 
    RLCA                            ;[1C8A] 
    LD    L,A                       ;[1C8B] 
    POP   AF                        ;[1C8C] 
    ADD   A,L                       ;[1C8D] 
    LD    L,A                       ;[1C8E] 
    INC   DE                        ;[1C8F] 
    RET                             ;[1C90] 

    INC   DE                        ;[1C91] 
    CALL  $1C77                     ;[1C92] 
    LD    A,L                       ;[1C95] 
    NEG                             ;[1C96] 
    LD    L,A                       ;[1C98] 
    RET                             ;[1C99] 

LYNX_PHL:
    PUSH  IY                        ;[1C9A] Displays binary number in HL without leading zeros. 
    CALL  $1CA2                     ;[1C9C] 
    POP   IY                        ;[1C9F] 
    RET                             ;[1CA1] 

    LD    IY,$1CCC                  ;[1CA2] 
    LD    D,$00                     ;[1CA6] 
    XOR   A                         ;[1CA8] 
    LD    B,(IY+$01)                ;[1CA9] 
    LD    C,(IY+$00)                ;[1CAC] 
    OR    A                         ;[1CAF] 
    SBC   HL,BC                     ;[1CB0] 
    JR    C,$1CB7                   ;[1CB2] 
    INC   A                         ;[1CB4] 
    JR    $1CB0                     ;[1CB5] 
    ADD   HL,BC                     ;[1CB7] 
    OR    A                         ;[1CB8] 
    JR    Z,$1CBC                   ;[1CB9] 
    DEC   D                         ;[1CBB] 
    BIT   7,D                       ;[1CBC] 
    JR    Z,$1CC3                   ;[1CBE] 
    ADD   A,$30                     ;[1CC0] 
    RST   $08                       ;[1CC2] 
    BIT   0,C                       ;[1CC3] 
    RET   NZ                        ;[1CC5] 
    INC   IY                        ;[1CC6] 
    INC   IY                        ;[1CC8] 
    JR    $1CA8                     ;[1CCA] 
    DJNZ  $1CF5                     ;[1CCC] 
    RET   PE                        ;[1CCE] 
    INC   BC                        ;[1CCF] 
    LD    H,H                       ;[1CD0] 
    NOP                             ;[1CD1] 
    LD    A,(BC)                    ;[1CD2] 
    NOP                             ;[1CD3] 
    LD    BC,$CD00                  ;[1CD4] 
    JP    PO,$2B1C                  ;[1CD7] 
    CALL  $1CEE                     ;[1CDA] 
    CP    $2E                       ;[1CDD] 
    RET   Z                         ;[1CDF] 
    INC   HL                        ;[1CE0] 
    RET                             ;[1CE1] 

    CALL  $3657                     ;[1CE2] 
    AND   $0F                       ;[1CE5] 
    ADD   A,$30                     ;[1CE7] 
    LD    (HL),A                    ;[1CE9] 
    INC   HL                        ;[1CEA] 
    DJNZ  $1CE2                     ;[1CEB] 
    RET                             ;[1CED] 

    PUSH  BC                        ;[1CEE] 
    LD    B,$08                     ;[1CEF] 
    LD    A,(SYSVAR_ZFLAG)          ;[1CF1] 
    BIT   1,A                       ;[1CF4] 
    JR    Z,$1CFE                   ;[1CF6] 
    LD    B,$03                     ;[1CF8] 
    BIT   0,A                       ;[1CFA] 
    JR    Z,$1D01                   ;[1CFC] 
    CALL  $1D05                     ;[1CFE] 
    POP   BC                        ;[1D01] 
    LD    A,(HL)                    ;[1D02] 
    RET                             ;[1D03] 

    DEC   HL                        ;[1D04] 
    LD    A,(HL)                    ;[1D05] 
    CP    $30                       ;[1D06] 
    RET   NZ                        ;[1D08] 
    DJNZ  $1D04                     ;[1D09] 
    RET                             ;[1D0B] 

    LD    B,$01                     ;[1D0C] 
    CALL  $1CE2                     ;[1D0E] 
    LD    (HL),$2E                  ;[1D11] 
    INC   HL                        ;[1D13] 
    LD    B,$07                     ;[1D14] 
    CALL  $1CD6                     ;[1D16] 
    LD    (HL),$45                  ;[1D19] 
    INC   HL                        ;[1D1B] 
    LD    (HL),$00                  ;[1D1C] 
    LD    HL,SYSVAR_PRTBUF          ;[1D1E] 
    CALL  LYNX_PLINE                ;[1D21] 
    LD    HL,SYSVAR_WRA1            ;[1D24] 
    BIT   6,(HL)                    ;[1D27] 
    LD    A,$2D                     ;[1D29] 
    JR    Z,$1D2F                   ;[1D2B] 
    LD    A,$2B                     ;[1D2D] 
    RST   $08                       ;[1D2F] 
    LD    A,(HL)                    ;[1D30] 
    JR    NZ,$1D35                  ;[1D31] 
    NEG                             ;[1D33] 
    AND   $3F                       ;[1D35] 
    LD    L,A                       ;[1D37] 
    LD    H,$00                     ;[1D38] 
    JP    LYNX_PHL                  ;[1D3A] 
    LD    A,$30                     ;[1D3D] 
    RST   $08                       ;[1D3F] 
    LD    A,(SYSVAR_ZFLAG)          ;[1D40] 
    BIT   1,A                       ;[1D43] 
    RET   Z                         ;[1D45] 
    PUSH  AF                        ;[1D46] 
    LD    A,$2E                     ;[1D47] 
    RST   $08                       ;[1D49] 
    POP   AF                        ;[1D4A] 
    LD    B,$07                     ;[1D4B] 
    BIT   0,A                       ;[1D4D] 
    JR    Z,$1D53                   ;[1D4F] 
    LD    B,$05                     ;[1D51] 
    LD    A,$30                     ;[1D53] 
    RST   $08                       ;[1D55] 
    DJNZ  $1D53                     ;[1D56] 
    RET                             ;[1D58] 

LYNX_PN:
    CALL  $2E93                     ;[1D59] Displays number in WRA1. 
    LD    A,(SYSVAR_WRA1)           ;[1D5C] 
    LD    HL,SYSVAR_PRTBUF          ;[1D5F] 
    BIT   7,A                       ;[1D62] 
    JR    NZ,$1D69                  ;[1D64] 
    LD    (HL),$2D                  ;[1D66] 
    INC   HL                        ;[1D68] 
    AND   $7F                       ;[1D69] 
    JR    Z,$1D3D                   ;[1D6B] 
    SUB   $3E                       ;[1D6D] 
    CP    $0A                       ;[1D6F] 
    JR    NC,$1D0C                  ;[1D71] 
    CP    $02                       ;[1D73] 
    JR    C,$1DA1                   ;[1D75] 
    LD    A,(SYSVAR_WRA1)           ;[1D77] 
    AND   $0F                       ;[1D7A] 
    INC   A                         ;[1D7C] 
    LD    B,A                       ;[1D7D] 
    PUSH  AF                        ;[1D7E] 
    CALL  $1CE2                     ;[1D7F] 
    POP   AF                        ;[1D82] 
    SUB   $08                       ;[1D83] 
    NEG                             ;[1D85] 
    LD    (HL),$2E                  ;[1D87] 
    JR    Z,$1D91                   ;[1D89] 
    LD    B,A                       ;[1D8B] 
    INC   HL                        ;[1D8C] 
    CALL  $1CE2                     ;[1D8D] 
    DEC   HL                        ;[1D90] 
    CALL  $1CEE                     ;[1D91] 
    CP    $2E                       ;[1D94] 
    JR    Z,$1D99                   ;[1D96] 
    INC   HL                        ;[1D98] 
    LD    (HL),$00                  ;[1D99] 
    LD    HL,SYSVAR_PRTBUF          ;[1D9B] 
    JP    LYNX_PLINE                ;[1D9E] 
    LD    (HL),$30                  ;[1DA1] 
    INC   HL                        ;[1DA3] 
    LD    (HL),$2E                  ;[1DA4] 
    INC   HL                        ;[1DA6] 
    SUB   $01                       ;[1DA7] 
    JR    Z,$1DB1                   ;[1DA9] 
    LD    (HL),$30                  ;[1DAB] 
    INC   HL                        ;[1DAD] 
    INC   A                         ;[1DAE] 
    JR    NZ,$1DAB                  ;[1DAF] 
    LD    B,$08                     ;[1DB1] 
    CALL  $1CD6                     ;[1DB3] 
    JR    $1D99                     ;[1DB6] 
    PUSH  HL                        ;[1DB8] 
    LD    C,(IX+$02)                ;[1DB9] 
    LD    B,(IX+$03)                ;[1DBC] 
    OR    A                         ;[1DBF] 
    LD    A,L                       ;[1DC0] 
    OR    H                         ;[1DC1] 
    JR    Z,$1DCA                   ;[1DC2] 
    DEC   HL                        ;[1DC4] 
    SBC   HL,BC                     ;[1DC5] 
    CALL  NC,$3B26                  ;[1DC7] 
    POP   HL                        ;[1DCA] 
    LD    C,L                       ;[1DCB] 
    LD    B,H                       ;[1DCC] 
    ADD   HL,HL                     ;[1DCD] 
    ADD   HL,HL                     ;[1DCE] 
    ADD   HL,BC                     ;[1DCF] 
    LD    C,(IX+$00)                ;[1DD0] 
    LD    B,(IX+$01)                ;[1DD3] 
    ADD   HL,BC                     ;[1DD6] 
    RET                             ;[1DD7] 

    PUSH  DE                        ;[1DD8] 
    CALL  $2EF0                     ;[1DD9] 
    DEC   IY                        ;[1DDC] 
    LD    A,(IY+$00)                ;[1DDE] 
    CALL  $1E23                     ;[1DE1] 
    LD    A,(IX+$00)                ;[1DE4] 
    OR    (IX+$01)                  ;[1DE7] 
    CALL  Z,$3B11                   ;[1DEA] 
    CALL  LYNX_FPINT                ;[1DED] 
    CALL  $1DB8                     ;[1DF0] 
    INC   HL                        ;[1DF3] 
    LD    A,(HL)                    ;[1DF4] 
    INC   A                         ;[1DF5] 
    CALL  Z,$3B11                   ;[1DF6] 
    DEC   HL                        ;[1DF9] 
    CALL  LYNX_LNUM1                ;[1DFA] 
    POP   DE                        ;[1DFD] 
    RET                             ;[1DFE] 

    POP   AF                        ;[1DFF] 
    CALL  $1E13                     ;[1E00] 
    LD    A,(IX+$00)                ;[1E03] 
    OR    (IX+$01)                  ;[1E06] 
    CALL  Z,$3B11                   ;[1E09] 
    JP    $1DB8                     ;[1E0C] 
    CALL  $3504                     ;[1E0F] 
    INC   DE                        ;[1E12] 
    PUSH  AF                        ;[1E13] 
    INC   DE                        ;[1E14] 
    RST   $28                       ;[1E15] 
    LD    A,(DE)                    ;[1E16] 
    CP    $29                       ;[1E17] 
    CALL  NZ,$3B44                  ;[1E19] 
    INC   DE                        ;[1E1C] 
    PUSH  DE                        ;[1E1D] 
    CALL  LYNX_FPINT                ;[1E1E] 
    POP   DE                        ;[1E21] 
    POP   AF                        ;[1E22] 
    LD    IX,(SYSVAR_ATBL)          ;[1E23] 
    RLCA                            ;[1E27] 
    RLA                             ;[1E28] 
    LD    C,A                       ;[1E29] 
    LD    B,$00                     ;[1E2A] 
    ADD   IX,BC                     ;[1E2C] 
    RET                             ;[1E2E] 

BASIC_COM_STOP:
    LD    IX,(SYSVAR_CURRLP)        ;[1E2F] 
    LD    A,(IX+$00)                ;[1E33] 
    CP    $80                       ;[1E36] 
    CALL  Z,$3B4A                   ;[1E38] 
    CALL  $255E                     ;[1E3B] 
    LD    (SYSVAR_CONTLP),IX        ;[1E3E] 
    LD    HL,$1E4E                  ;[1E42] 
    CALL  LYNX_PLINE                ;[1E45] 
    CALL  $1E7F                     ;[1E48] 
    JP    $24E2                     ;[1E4B] 
    DEC   C                         ;[1E4E] 
    defb 0x53,0x74,0x6F,0x70,0x70,0x65,0x64,0x00        ;[1E4F]


BASIC_FN_RND:
    CALL  LYNX_FRNDS                ;[1E57] RND.
    LD    HL,(SYSVAR_RNDNO)         ;[1E5A] 
    CALL  LYNX_INTFP                ;[1E5D] 
    LD    HL,$35D8                  ;[1E60] 
    CALL  LYNX_LNUM2                ;[1E63] 
    JP    LYNX_DIV                  ;[1E66] 

BASIC_FN_MEM:
    LD    BC,(SYSVAR_TOV)           ;[1E69] MEM.
    LD    HL,START                  ;[1E6D] 
    ADD   HL,SP                     ;[1E70] 
    SBC   HL,BC                     ;[1E71] 
    JP    LYNX_INTFP                ;[1E73] 
    LD    HL,$3605                  ;[1E76] Called by 'J' command.
    LD    (SYSVAR_CURRLP),HL        ;[1E79] 
    JP    SUB_LINK_OFF              ;[1E7C] 
    LD    HL,(SYSVAR_CURRLP)        ;[1E7F] 
    LD    A,(HL)                    ;[1E82] 
    CP    $80                       ;[1E83] 
    JR    Z,$1E96                   ;[1E85] 
    LD    HL,$1E9F                  ;[1E87] 
    CALL  LYNX_PLINE                ;[1E8A] 
    LD    HL,(SYSVAR_CURRLP)        ;[1E8D] 
    CALL  LYNX_LNUM1                ;[1E90] 
    CALL  LYNX_PN                   ;[1E93] 
    LD    A,$1E                     ;[1E96] 
    RST   $08                       ;[1E98] 
    LD    A,$0D                     ;[1E99] 
    RST   $08                       ;[1E9B] 
    JP    $1F0D                     ;[1E9C] 
    defb 0x20,0x69,0x6E,0x20,0x6C,0x69,0x6E,0x65        ;[1E9F]
    defb 0x20,0x00                                      ;[1EA7]


BASIC:
    LD    IX,(SYSVAR_CURRLP)        ;[1EA9] Main process loop for BASIC
    LD    A,(IX+$00)                ;[1EAD] 
    CP    $80                       ;[1EB0] 
    JR    Z,$1ECA                   ;[1EB2] 
    LD    A,(IX+$06)                ;[1EB4] 
    CP    $25                       ;[1EB7] 
    JR    NZ,$1ECA                  ;[1EB9] 
    LD    A,$0D                     ;[1EBB] 
    RST   $08                       ;[1EBD] 
    LD    BC,$24BE                  ;[1EBE] 
    POP   HL                        ;[1EC1] 
    OR    A                         ;[1EC2] 
    SBC   HL,BC                     ;[1EC3] 
    JR    NZ,$1EC1                  ;[1EC5] 
    JP    $249C                     ;[1EC7] 
    CALL  $1E7F                     ;[1ECA] 
    JP    $38E8                     ;[1ECD] 

LYNX_FRNDS:
    LD    HL,($61F2)                ;[1ED0] Generates next random number in RNDNO. 
    RL    L                         ;[1ED3] 
    RL    H                         ;[1ED5] 
    RL    L                         ;[1ED7] 
    RL    H                         ;[1ED9] 
    LD    C,H                       ;[1EDB] 
    LD    A,(SYSVAR_RNDNO)          ;[1EDC] 
    RLA                             ;[1EDF] 
    LD    B,A                       ;[1EE0] 
    LD    DE,($61F1)                ;[1EE1] 
    RL    E                         ;[1EE5] 
    RL    D                         ;[1EE7] 
    RES   7,D                       ;[1EE9] 
    LD    HL,(SYSVAR_RNDNO)         ;[1EEB] 
    ADD   HL,BC                     ;[1EEE] 
    LD    (SYSVAR_RNDNO),HL         ;[1EEF] 
    LD    HL,($61F2)                ;[1EF2] 
    ADC   HL,DE                     ;[1EF5] 
    RES   7,H                       ;[1EF7] 
    LD    ($61F2),HL                ;[1EF9] 
    RET   P                         ;[1EFC] 
    LD    HL,SYSVAR_RNDNO           ;[1EFD] 
    INC   (HL)                      ;[1F00] 
    RET   NZ                        ;[1F01] 
    INC   HL                        ;[1F02] 
    JR    $1F00                     ;[1F03] 

LYNX_ESC:
    LD    BC,$0080                  ;[1F05] Sets Z flag if ESC key is currently press- 
    IN    B,(C)                     ;[1F08] 
    BIT   6,B                       ;[1F0A] 
    RET                             ;[1F0C] 

    LD    HL,$1F13                  ;[1F0D] Routine to print 'Ready!'.
    JP    LYNX_PLINE                ;[1F10] 
    defb 0x52,0x65,0x61,0x64,0x79,0x21,0x0D,0x1E        ;[1F13]
    defb 0x00                                           ;[1F1B]

    LD    HL,(SYSVAR_RSTACK)        ;[1F1C] Test for a full return stack
    LD    DE,$0100                  ;[1F1F] 
    ADD   HL,DE                     ;[1F22] 
    LD    DE,(SYSVAR_RSP)           ;[1F23] 
    CALL  LYNX_CHLDE                ;[1F27] 
    CALL  C,$3B05                   ;[1F2A] 
    EX    DE,HL                     ;[1F2D] 
    RET                             ;[1F2E] 

    PUSH  DE                        ;[1F2F] Push HL onto the return stack.
    PUSH  HL                        ;[1F30] 
    CALL  $1F1C                     ;[1F31] 
    POP   DE                        ;[1F34] 
    LD    (HL),E                    ;[1F35] 
    INC   HL                        ;[1F36] 
    LD    (HL),D                    ;[1F37] 
    INC   HL                        ;[1F38] 
    LD    (SYSVAR_RSP),HL           ;[1F39] 
    POP   DE                        ;[1F3C] 
    RET                             ;[1F3D] 

    PUSH  DE                        ;[1F3E] Push A onto the return stack.
    PUSH  AF                        ;[1F3F] 
    CALL  $1F1C                     ;[1F40] 
    POP   AF                        ;[1F43] 
    LD    (HL),A                    ;[1F44] 
    JR    $1F38                     ;[1F45] 
    PUSH  DE                        ;[1F47] Pop HL off the return stack.
    LD    HL,(SYSVAR_RSP)           ;[1F48] 
    DEC   HL                        ;[1F4B] 
    LD    D,(HL)                    ;[1F4C] 
    DEC   HL                        ;[1F4D] 
    LD    E,(HL)                    ;[1F4E] 
    LD    (SYSVAR_RSP),HL           ;[1F4F] 
    EX    DE,HL                     ;[1F52] 
    POP   DE                        ;[1F53] 
    RET                             ;[1F54] 

    LD    HL,(SYSVAR_RSP)           ;[1F55] Pop A off the return stack.
    DEC   HL                        ;[1F58] 
    LD    A,(HL)                    ;[1F59] 
    LD    (SYSVAR_RSP),HL           ;[1F5A] 
    RET                             ;[1F5D] 

SUB_LINK_ON:
    LD    C,$02                     ;[1F5E] LLIST subroutine: 'LINK ON'.
    LD    A,(SYSVAR_OTYPE)          ;[1F60] 
    AND   $80                       ;[1F63] 
    OR    C                         ;[1F65] 
    LD    (SYSVAR_OTYPE),A          ;[1F66] 
    RET                             ;[1F69] 

SUB_LINK_OFF:
    LD    C,$01                     ;[1F6A] LLIST subroutine: "LINK OFF".
    JR    $1F60                     ;[1F6C] 
    CALL  $25CA                     ;[1F6E] Called from MAIN routine. Zeros memory etc.
    LD    HL,START                  ;[1F71] 
    LD    (SYSVAR_PROCST),HL        ;[1F74] 
    LD    HL,(SYSVAR_EOB)           ;[1F77] 
    INC   HL                        ;[1F7A] 
    LD    (SYSVAR_TOV),HL           ;[1F7B] 
    LD    HL,(SYSVAR_SOB)           ;[1F7E] 
    DEC   HL                        ;[1F81] 
    LD    (SYSVAR_DATAP),HL         ;[1F82] 
    LD    HL,(SYSVAR_RSTACK)        ;[1F85] 
    LD    (HL),$00                  ;[1F88] 
    INC   HL                        ;[1F8A] 
    LD    (SYSVAR_RSP),HL           ;[1F8B] 
    LD    HL,(SYSVAR_VTBL)          ;[1F8E] 
    LD    DE,$0005                  ;[1F91] 
    LD    B,$35                     ;[1F94] 
    INC   HL                        ;[1F96] 
    LD    (HL),$FF                  ;[1F97] 
    ADD   HL,DE                     ;[1F99] 
    DJNZ  $1F97                     ;[1F9A] 
    RET                             ;[1F9C] 

BASIC_FN_LCTN:
    CALL  $2B18                     ;[1F9D] LCTN.
    CALL  $251B                     ;[1FA0] 
    EX    DE,HL                     ;[1FA3] 
    INC   HL                        ;[1FA4] 
    JP    LYNX_INTFP                ;[1FA5] 

BASIC_COM_RANDOM:
    LD    A,R                       ;[1FA8] RANDOM.
    AND   $7F                       ;[1FAA] 
    INC   A                         ;[1FAC] 
    LD    (SYSVAR_RNDNO),A          ;[1FAD] 
    RET                             ;[1FB0] 

BASIC_COM_CLS:
    LD    HL,SYSVAR_OTYPE           ;[1FB1] CLS.
    LD    A,(HL)                    ;[1FB4] 
    PUSH  AF                        ;[1FB5] 
    LD    (HL),$01                  ;[1FB6] 
    LD    A,$04                     ;[1FB8] 
    RST   $08                       ;[1FBA] 
    POP   AF                        ;[1FBB] 
    LD    (HL),A                    ;[1FBC] 
    RET                             ;[1FBD] 

BASIC_COM_END:
    CALL  $1F0D                     ;[1FBE] END.
    JP    $24DC                     ;[1FC1] 

BASIC_COM_WEND:
    CALL  $1F55                     ;[1FC4] HEND.
    CP    $36                       ;[1FC7] 
    CALL  NZ,$3B0B                  ;[1FC9] 
    CALL  $1F47                     ;[1FCC] 
    POP   BC                        ;[1FCF] 
    JP    $2493                     ;[1FD0] 

BASIC_COM_WHILE:
    RST   $28                       ;[1FD3] WHILE.
    LD    A,(SYSVAR_WRA1)           ;[1FD4] 
    CP    $80                       ;[1FD7] 
    JR    Z,$1FE7                   ;[1FD9] 
    LD    HL,(SYSVAR_CURRLP)        ;[1FDB] 
    CALL  $1F2F                     ;[1FDE] 
    LD    A,$36                     ;[1FE1] 
    CALL  $1F3E                     ;[1FE3] 
    RET                             ;[1FE6] 

    LD    IX,(SYSVAR_CURRLP)        ;[1FE7] 
    LD    C,$37                     ;[1FEB] 
    LD    B,$36                     ;[1FED] 
    CALL  SUB_WHILE                 ;[1FEF] 
    CALL  C,$3B08                   ;[1FF2] 
    LD    (SYSVAR_CURRLP),IX        ;[1FF5] 
    RET                             ;[1FF9] 

BASIC_COM_UNTIL:
    PUSH  DE                        ;[1FFA] UNTIL.
    CALL  $1F55                     ;[1FFB] 
    CP    $38                       ;[1FFE] 
    CALL  NZ,$3B0E                  ;[2000] 
    CALL  $1F47                     ;[2003] 
    POP   DE                        ;[2006] 
    PUSH  HL                        ;[2007] 
    RST   $28                       ;[2008] 
    LD    A,(SYSVAR_WRA1)           ;[2009] 
    CP    $80                       ;[200C] 
    POP   HL                        ;[200E] 
    RET   NZ                        ;[200F] 
    LD    (SYSVAR_CURRLP),HL        ;[2010] 

BASIC_COM_REPEAT:
    LD    HL,(SYSVAR_CURRLP)        ;[2013] REPEAT.
    CALL  $1F2F                     ;[2016] 
    LD    A,$38                     ;[2019] 
    JP    $1F3E                     ;[201B] 

BASIC_FN_GETN:
    CALL  LYNX_KEY                  ;[201E] GETN.
    OR    A                         ;[2021] 
    JR    Z,BASIC_FN_GETN           ;[2022] 
    JR    $2029                     ;[2024] 

BASIC_FN_KEYN:
    CALL  LYNX_KEY                  ;[2026] KEYN.
    LD    L,A                       ;[2029] 
    LD    H,$00                     ;[202A] 
    JP    LYNX_INTFP                ;[202C] 

LYNX_KEY:
    PUSH  HL                        ;[202F] Calls to keyboard driver in KEYB 
    LD    HL,(SYSVAR_KEYB)          ;[2030] 
    PUSH  BC                        ;[2033] 
    LD    BC,$2039                  ;[2034] 
    PUSH  BC                        ;[2037] 
    JP    (HL)                      ;[2038] 
    POP   BC                        ;[2039] 
    POP   HL                        ;[203A] 
    RET                             ;[203B] 

    LD    C,A                       ;[203C] Display character.
    LD    A,(SYSVAR_OTYPE)          ;[203D] 
    PUSH  BC                        ;[2040] 
    PUSH  AF                        ;[2041] 
    AND   $81                       ;[2042] 
    JR    Z,$204F                   ;[2044] 
    LD    A,C                       ;[2046] 
    LD    HL,(SYSVAR_PRINTD)        ;[2047] 
    LD    BC,$204F                  ;[204A] 
    PUSH  BC                        ;[204D] 
    JP    (HL)                      ;[204E] 
    POP   AF                        ;[204F] 
    POP   BC                        ;[2050] 
    AND   $82                       ;[2051] 
    RET   Z                         ;[2053] 
    LD    A,C                       ;[2054] 
    LD    HL,(SYSVAR_LPRNTD)        ;[2055] 
    JP    (HL)                      ;[2058] 
    LD    A,(DE)                    ;[2059] Check and then evaluate an expression.
    RST   $20                       ;[205A] 
    LD    A,L                       ;[205B] 
    JP    SYSVAR_EE                 ;[205C] 

BASIC_COM_CALL:
    RST   $18                       ;[205F] CALL.
    PUSH  HL                        ;[2060] 
    LD    A,(DE)                    ;[2061] 
    CP    $0D                       ;[2062] 
    JR    Z,$2068                   ;[2064] 
    INC   DE                        ;[2066] 
    RST   $18                       ;[2067] 
    POP   IX                        ;[2068] 
    LD    BC,$2070                  ;[206A] 
    PUSH  BC                        ;[206D] 
    JP    (IX)                      ;[206E] 
    LD    (SYSVAR_HLSTORE),HL       ;[2070] Save the value in HL at 61F4.
    RET                             ;[2073] 

BASIC_COM_RETURN:
    CALL  $1F55                     ;[2074] Check for stack full.
    CP    $11                       ;[2077] 
    CALL  NZ,$3B17                  ;[2079] 
    CALL  $1F47                     ;[207C] 
    LD    (SYSVAR_CURRLP),HL        ;[207F] 
    RET                             ;[2082] 

BASIC_COM_NEW:
    LD    HL,(SYSVAR_SOB)           ;[2083] 
    LD    (SYSVAR_EOB),HL           ;[2086] 
    LD    (HL),$80                  ;[2089] 
    LD    (SYSVAR_CURRLP),HL        ;[208B] 
    CALL  $1F6E                     ;[208E] 
    JP    $24DC                     ;[2091] 

BASIC_COM_INPUT:
    CP    $22                       ;[2094] INPUT.
    JR    NZ,$209D                  ;[2096] 
    CALL  $2257                     ;[2098] 
    INC   DE                        ;[209B] 
    INC   DE                        ;[209C] 
    PUSH  DE                        ;[209D] 
    LD    A,$3F                     ;[209E] 
    RST   $08                       ;[20A0] 
    LD    A,$20                     ;[20A1] 
    RST   $08                       ;[20A3] 
    CALL  $0DF3                     ;[20A4] 
    LD    A,$0F                     ;[20A7] 
    RST   $08                       ;[20A9] 
    LD    DE,$6000                  ;[20AA] 
    EXX                             ;[20AD] 
    POP   DE                        ;[20AE] 
    CALL  $20B5                     ;[20AF] 
    JR    C,$209D                   ;[20B2] 
    RET                             ;[20B4] 

    EXX                             ;[20B5] Input buffer analysis.
    LD    A,(DE)                    ;[20B6] 
    CP    $0D                       ;[20B7] 
    EXX                             ;[20B9] 
    SCF                             ;[20BA] 
    RET   Z                         ;[20BB] 
    CALL  $2113                     ;[20BC] 
    PUSH  DE                        ;[20BF] 
    PUSH  HL                        ;[20C0] 
    JR    C,$20E4                   ;[20C1] 
    EXX                             ;[20C3] 
    LD    HL,(SYSVAR_POLBUF)        ;[20C4] 
    CALL  LYNX_RP                   ;[20C7] 
    CP    $2C                       ;[20CA] 
    JR    Z,$20D1                   ;[20CC] 
    RST   $20                       ;[20CE] 
    DEC   C                         ;[20CF] 
    DEC   DE                        ;[20D0] 
    EXX                             ;[20D1] 
    LD    DE,(SYSVAR_POLBUF)        ;[20D2] 
    RST   $28                       ;[20D6] 
    POP   HL                        ;[20D7] 
    EX    DE,HL                     ;[20D8] 
    CALL  $275C                     ;[20D9] 
    POP   DE                        ;[20DC] 
    LD    A,(DE)                    ;[20DD] 
    CP    $0D                       ;[20DE] 
    RET   Z                         ;[20E0] 
    INC   DE                        ;[20E1] 
    JR    $20B5                     ;[20E2] 
    EXX                             ;[20E4] 
    POP   HL                        ;[20E5] 
    DEC   HL                        ;[20E6] 
    LD    B,(HL)                    ;[20E7] 
    INC   HL                        ;[20E8] 
    CALL  $20F1                     ;[20E9] 
    EXX                             ;[20EC] 
    JR    $20DC                     ;[20ED] 
    LD    B,$10                     ;[20EF] 
    CALL  $2108                     ;[20F1] 
    JR    Z,$2103                   ;[20F4] 
    LD    (HL),A                    ;[20F6] 
    INC   HL                        ;[20F7] 
    INC   DE                        ;[20F8] 
    DJNZ  $20F1                     ;[20F9] 
    CALL  $2108                     ;[20FB] 
    JR    Z,$2103                   ;[20FE] 
    INC   DE                        ;[2100] 
    JR    $20FB                     ;[2101] 
    LD    (HL),$0D                  ;[2103] 
    RET   C                         ;[2105] 
    INC   DE                        ;[2106] 
    RET                             ;[2107] 

    LD    A,(DE)                    ;[2108] Test what DE points to for a comma, a " or a CR.
    CP    $22                       ;[2109] 
    RET   Z                         ;[210B] 
    CP    $2C                       ;[210C] 
    RET   Z                         ;[210E] 
    CP    $0D                       ;[210F] 
    SCF                             ;[2111] 
    RET                             ;[2112] 

    CALL  $21EA                     ;[2113] 
    JR    Z,$211D                   ;[2116] 
    CALL  $2218                     ;[2118] 
    OR    A                         ;[211B] 
    RET                             ;[211C] 

    CALL  SYSVAR_VRPTS              ;[211D] 
    SCF                             ;[2120] 
    RET                             ;[2121] 

BASIC_COM_PAUSE:
    RST   $18                       ;[2122] PAUSE.
    DEC   HL                        ;[2123] 
    LD    B,$1A                     ;[2124] 
    DJNZ  $2126                     ;[2126] 
    LD    A,L                       ;[2128] 
    OR    H                         ;[2129] 
    JR    NZ,$2123                  ;[212A] 
    RET                             ;[212C] 

BASIC_COM_PROTECT:
    RST   $18                       ;[212D] PROTECT.
    LD    (SYSVAR_PROTST),A         ;[212E] 
    RET                             ;[2131] 

LYNX_ETEXT:
    XOR   A                         ;[2132] Same as Basic TEXT command. 
    LD    (SYSVAR_PROTST),A         ;[2133] 
    LD    A,$01                     ;[2136] 
    RST   $08                       ;[2138] 
    LD    A,$04                     ;[2139] 
    RST   $08                       ;[213B] 
    LD    A,$02                     ;[213C] 
    RST   $08                       ;[213E] 
    XOR   A                         ;[213F] 
    RST   $08                       ;[2140] 
    LD    A,$04                     ;[2141] 
    RST   $08                       ;[2143] 
    LD    A,$03                     ;[2144] 
    JR    $212E                     ;[2146] 

BASIC_COM_LET:
    CALL  $21EA                     ;[2148] LET.
    JR    Z,$2161                   ;[214B] 
    CALL  $2218                     ;[214D] 
    INC   DE                        ;[2150] 
    PUSH  HL                        ;[2151] 
    RST   $28                       ;[2152] 
    POP   HL                        ;[2153] 
    EX    DE,HL                     ;[2154] 
    PUSH  HL                        ;[2155] 
    CALL  $275C                     ;[2156] 
    POP   DE                        ;[2159] 
    LD    A,(DE)                    ;[215A] 
    CP    $0D                       ;[215B] 
    RET   Z                         ;[215D] 
    INC   DE                        ;[215E] 
    JR    BASIC_COM_LET             ;[215F] 
    LD    IY,SYSVAR_CSTACK          ;[2161] 
    CALL  SYSVAR_VRPTS              ;[2165] 
    INC   DE                        ;[2168] 
    PUSH  HL                        ;[2169] 
    PUSH  BC                        ;[216A] 
    CALL  $2BDD                     ;[216B] 
    POP   BC                        ;[216E] 
    POP   IX                        ;[216F] 
    LD    HL,SYSVAR_STRBUF          ;[2171] 
    CALL  $2C7F                     ;[2174] 
    LD    (IX+$00),$0D              ;[2177] 
    JR    $215A                     ;[217B] 

BASIC_COM_RESTORE:
    CP    $0D                       ;[217D] RESTORE.
    LD    IX,(SYSVAR_SOB)           ;[217F] 
    JR    Z,$2189                   ;[2183] 
    RST   $28                       ;[2185] 
    CALL  $2B18                     ;[2186] 
    DEC   IX                        ;[2189] 
    LD    (SYSVAR_DATAP),IX         ;[218B] 
    RET                             ;[218F] 

    LD    A,(IX+$00)                ;[2190] Search BASIC file for token in C.
    CP    $80                       ;[2193] 
    SCF                             ;[2195] 
    RET   Z                         ;[2196] 
    LD    A,(IX+$06)                ;[2197] 
    CP    C                         ;[219A] 
    RET   Z                         ;[219B] 
    CALL  $255E                     ;[219C] 
    JR    $2190                     ;[219F] 

SUB_WHILE:
    LD    A,$FF                     ;[21A1] WHILE subroutine.
    EX    AF,AF'                    ;[21A3] 
    LD    A,(IX+$00)                ;[21A4] 
    CP    $80                       ;[21A7] 
    SCF                             ;[21A9] 
    RET   Z                         ;[21AA] 
    LD    A,(IX+$06)                ;[21AB] 
    CP    B                         ;[21AE] 
    JR    Z,$21C0                   ;[21AF] 
    CP    C                         ;[21B1] 
    JR    Z,$21B9                   ;[21B2] 
    CALL  $255E                     ;[21B4] 
    JR    $21A4                     ;[21B7] 
    EX    AF,AF'                    ;[21B9] 
    OR    A                         ;[21BA] 
    RET   Z                         ;[21BB] 
    DEC   A                         ;[21BC] 
    EX    AF,AF'                    ;[21BD] 
    JR    $21B4                     ;[21BE] 
    EX    AF,AF'                    ;[21C0] 
    INC   A                         ;[21C1] 
    EX    AF,AF'                    ;[21C2] 
    JR    $21B4                     ;[21C3] 

BASIC_COM_READ:
    EXX                             ;[21C5] READ.
    LD    DE,(SYSVAR_DATAP)         ;[21C6] 
    EXX                             ;[21CA] 
    CALL  $20B5                     ;[21CB] 
    JR    C,$21D6                   ;[21CE] 
    EXX                             ;[21D0] 
    LD    (SYSVAR_DATAP),DE         ;[21D1] 
    RET                             ;[21D5] 

    EXX                             ;[21D6] 
    INC   DE                        ;[21D7] 
    PUSH  DE                        ;[21D8] 
    POP   IX                        ;[21D9] 
    LD    C,$19                     ;[21DB] 
    CALL  $2190                     ;[21DD] 
    CALL  C,$3B1A                   ;[21E0] 
    CALL  $251B                     ;[21E3] 
    INC   DE                        ;[21E6] 
    EXX                             ;[21E7] 
    JR    $21CB                     ;[21E8] 
    LD    A,(DE)                    ;[21EA] Test for a valid variable.
    CP    $41                       ;[21EB] 
    RET   C                         ;[21ED] 
    INC   DE                        ;[21EE] 
    LD    A,(DE)                    ;[21EF] 
    CP    $24                       ;[21F0] 
    DEC   DE                        ;[21F2] 
    RET                             ;[21F3] 

    LD    A,(DE)                    ;[21F4] Variable validation routine.
    CP    $41                       ;[21F5] 
    CALL  C,$3B3B                   ;[21F7] 
    CP    $5B                       ;[21FA] 
    CALL  NC,$3B3B                  ;[21FC] 
    LD    (HL),A                    ;[21FF] 
    INC   HL                        ;[2200] 
    LD    (HL),$24                  ;[2201] 
    INC   HL                        ;[2203] 
    INC   DE                        ;[2204] 
    INC   DE                        ;[2205] 
    RST   $10                       ;[2206] 
    CP    $28                       ;[2207] 
    RET   NZ                        ;[2209] 
    LD    (HL),A                    ;[220A] 
    INC   HL                        ;[220B] 
    INC   DE                        ;[220C] 
    CALL  LYNX_RP                   ;[220D] 
    CP    $29                       ;[2210] 
    CALL  NZ,$3B44                  ;[2212] 
    LD    (HL),A                    ;[2215] 
    INC   HL                        ;[2216] 
    RET                             ;[2217] 

    CALL  $3504                     ;[2218] Load A with variable number (ie A=1. 9=2 etc) and HL will return with the address of the variable.
    INC   DE                        ;[221B] 
    PUSH  AF                        ;[221C] 
    LD    A,(DE)                    ;[221D] 
    CP    $28                       ;[221E] 
    JP    Z,$1DFF                   ;[2220] 
    POP   AF                        ;[2223] 
    LD    L,A                       ;[2224] 
    LD    H,$00                     ;[2225] 
    PUSH  DE                        ;[2227] 
    LD    E,L                       ;[2228] 
    LD    D,H                       ;[2229] 
    ADD   HL,HL                     ;[222A] 
    ADD   HL,HL                     ;[222B] 
    ADD   HL,DE                     ;[222C] 
    LD    DE,(SYSVAR_VTBL)          ;[222D] 
    ADD   HL,DE                     ;[2231] 
    POP   DE                        ;[2232] 
    RET                             ;[2233] 

LYNX_PHEXHL:
    LD    A,H                       ;[2234] Prints binary number in HL. 
    CALL  $2239                     ;[2235] 
    LD    A,L                       ;[2238] 
    PUSH  AF                        ;[2239] 
    RRCA                            ;[223A] 
    RRCA                            ;[223B] 
    RRCA                            ;[223C] 
    RRCA                            ;[223D] 
    CALL  $2242                     ;[223E] 
    POP   AF                        ;[2241] 
    AND   $0F                       ;[2242] 
    ADD   A,$30                     ;[2244] 
    CP    $3A                       ;[2246] 
    JR    C,$224C                   ;[2248] 
    ADD   A,$07                     ;[224A] 
    RST   $08                       ;[224C] 
    RET                             ;[224D] 

BASIC_COM_LPRINT:
    CALL  SUB_LINK_ON               ;[224E] LPRINT.
    CALL  BASIC_COM_PRINT           ;[2251] 
    JP    SUB_LINK_OFF              ;[2254] 
    INC   DE                        ;[2257] Prints a string.
    LD    A,(DE)                    ;[2258] 
    CP    $22                       ;[2259] 
    RET   Z                         ;[225B] 
    RST   $08                       ;[225C] 
    JR    $2257                     ;[225D] 

BASIC_COM_SWAP:
    CALL  $2218                     ;[225F] SWAP.
    PUSH  HL                        ;[2262] 
    INC   DE                        ;[2263] 
    CALL  $2218                     ;[2264] 
    POP   DE                        ;[2267] 
    LD    B,$05                     ;[2268] 
    JP    $354A                     ;[226A] 

BASIC_COM_CONT:
    LD    HL,(SYSVAR_CURRLP)        ;[226D] 
    LD    A,(HL)                    ;[2270] 
    CP    $80                       ;[2271] 
    RET   NZ                        ;[2273] 
    POP   BC                        ;[2274] 
    LD    HL,(SYSVAR_CONTLP)        ;[2275] 
    LD    A,L                       ;[2278] 
    OR    H                         ;[2279] 
    CALL  Z,$3B1D                   ;[227A] 
    JP    $2493                     ;[227D] 

BASIC_COM_RUN:
    PUSH  DE                        ;[2280] RUN.
    CALL  $1F6E                     ;[2281] 
    POP   DE                        ;[2284] 
    LD    IX,(SYSVAR_SOB)           ;[2285] 
    LD    A,(DE)                    ;[2289] 
    CP    $0D                       ;[228A] 
    JR    Z,$2292                   ;[228C] 
    RST   $28                       ;[228E] 
    CALL  $2B18                     ;[228F] 
    POP   BC                        ;[2292] 
    JP    $24C5                     ;[2293] 

BASIC_COM_GOSUB:
    LD    HL,(SYSVAR_CURRLP)        ;[2296] GOSUB
    CALL  $1F2F                     ;[2299] 
    LD    A,$11                     ;[229C] 
    CALL  $1F3E                     ;[229E] 
    LD    A,(DE)                    ;[22A1] 

BASIC_COM_GOTO:
    CP    $D8                       ;[22A2] 
    JR    NZ,$228E                  ;[22A4] 
    LD    C,$2F                     ;[22A6] 
    INC   DE                        ;[22A8] 
    LD    IX,(SYSVAR_SOB)           ;[22A9] 
    PUSH  DE                        ;[22AD] 
    CALL  $2190                     ;[22AE] 
    CALL  C,$3B2C                   ;[22B1] 
    PUSH  IX                        ;[22B4] 
    LD    DE,$0007                  ;[22B6] 
    ADD   IX,DE                     ;[22B9] 
    PUSH  IX                        ;[22BB] 
    POP   HL                        ;[22BD] 
    POP   IX                        ;[22BE] 
    POP   DE                        ;[22C0] 
    PUSH  DE                        ;[22C1] 
    CALL  $22D3                     ;[22C2] 
    JR    Z,$22CD                   ;[22C5] 
    CALL  $255E                     ;[22C7] 
    POP   DE                        ;[22CA] 
    JR    NZ,$22AD                  ;[22CB] 
    POP   BC                        ;[22CD] 
    LD    (SYSVAR_CURRLP),IX        ;[22CE] 
    RET                             ;[22D2] 

    LD    A,(DE)                    ;[22D3] Compare two strings for compatibility.
    CP    (HL)                      ;[22D4] 
    RET   NZ                        ;[22D5] 
    CP    $28                       ;[22D6] 
    RET   Z                         ;[22D8] 
    CP    $0D                       ;[22D9] 
    RET   Z                         ;[22DB] 
    INC   HL                        ;[22DC] 
    INC   DE                        ;[22DD] 
    JR    $22D3                     ;[22DE] 
    LD    IX,(SYSVAR_SOB)           ;[22E0] LIST (in part)
    LD    DE,$FFFF                  ;[22E4] 
    JR    $230A                     ;[22E7] 

BASIC_COM_LIST:
    CP    $0D                       ;[22E9] 
    LD    A,$00                     ;[22EB] 
    LD    (SYSVAR_SBC),A            ;[22ED] 
    JR    Z,$22E0                   ;[22F0] 
    RST   $28                       ;[22F2] 
    PUSH  DE                        ;[22F3] 
    CALL  LYNX_FNDLN                ;[22F4] 
    POP   DE                        ;[22F7] 
    LD    A,(DE)                    ;[22F8] 
    CP    $0D                       ;[22F9] 
    PUSH  IX                        ;[22FB] 
    JR    Z,$2304                   ;[22FD] 
    INC   DE                        ;[22FF] 
    RST   $28                       ;[2300] 
    CALL  LYNX_FNDLN                ;[2301] 
    PUSH  IX                        ;[2304] 
    POP   DE                        ;[2306] 
    POP   IX                        ;[2307] 
    INC   DE                        ;[2309] 
    LD    A,(IX+$00)                ;[230A] 
    CP    $80                       ;[230D] 
    JR    Z,$2332                   ;[230F] 
    PUSH  DE                        ;[2311] 
    CALL  SYSVAR_DBASLN             ;[2312] 
    LD    (SYSVAR_CURRLP),IX        ;[2315] 
    CALL  LYNX_ESC                  ;[2319] 
    JR    Z,$2332                   ;[231C] 
    LD    BC,$0080                  ;[231E] 
    IN    A,(C)                     ;[2321] 
    RLCA                            ;[2323] 
    JR    NC,$2319                  ;[2324] 
    CALL  $255E                     ;[2326] 
    POP   DE                        ;[2329] 
    PUSH  IX                        ;[232A] 
    POP   HL                        ;[232C] 
    CALL  LYNX_CHLDE                ;[232D] 
    JR    C,$230A                   ;[2330] 
    LD    A,$1E                     ;[2332] 
    RST   $08                       ;[2334] 
    JP    $24E2                     ;[2335] 

BASIC_COM_LLIST:
    CALL  SUB_LINK_ON               ;[2338] LLIST.
    LD    A,(DE)                    ;[233B] 
    JP    BASIC_COM_LIST            ;[233C] 

BASIC_COM_DEL:
    RST   $28                       ;[233F] DEL
    PUSH  DE                        ;[2340] 
    CALL  $2B18                     ;[2341] 
    POP   DE                        ;[2344] 
    LD    A,(DE)                    ;[2345] 
    CP    $0D                       ;[2346] 
    INC   DE                        ;[2348] 
    PUSH  IX                        ;[2349] 
    JR    Z,$2351                   ;[234B] 
    RST   $28                       ;[234D] 
    CALL  $2B18                     ;[234E] 
    CALL  $255E                     ;[2351] 
    PUSH  IX                        ;[2354] 
    POP   BC                        ;[2356] 
    POP   HL                        ;[2357] 
    LD    E,L                       ;[2358] 
    LD    D,H                       ;[2359] 
    OR    A                         ;[235A] 
    SBC   HL,BC                     ;[235B] 
    CALL  $256E                     ;[235D] 
    JP    $24DC                     ;[2360] 

SUB_ARGUMENT:
    RST   $28                       ;[2363] Picks up a Basic argument!
    LD    A,(SYSVAR_WRA1)           ;[2364] 
    BIT   7,A                       ;[2367] 
    CALL  Z,$2371                   ;[2369] 
    CALL  LYNX_FPINT                ;[236C] 
    LD    A,L                       ;[236F] 
    RET                             ;[2370] 

    PUSH  DE                        ;[2371] Called by 2363-2370
    LD    HL,$35D8                  ;[2372] 
    CALL  LYNX_LNUM2                ;[2375] 
    CALL  LYNX_AD                   ;[2378] 
    POP   DE                        ;[237B] 
    RET                             ;[237C] 

BASIC_COM_OUT:
    RST   $18                       ;[237D] OUT.
    PUSH  HL                        ;[237E] 
    INC   DE                        ;[237F] 
    RST   $18                       ;[2380] 
    POP   BC                        ;[2381] 
    OUT   (C),A                     ;[2382] 
    RET                             ;[2384] 

BASIC_COM_POKE:
    RST   $18                       ;[2385] 
    PUSH  HL                        ;[2386] 
    INC   DE                        ;[2387] 
    RST   $18                       ;[2388] 
    POP   HL                        ;[2389] 
    LD    (HL),A                    ;[238A] 
    RET                             ;[238B] 

BASIC_COM_DPOKE:
    RST   $18                       ;[238C] DPOKE.
    PUSH  HL                        ;[238D] 
    INC   DE                        ;[238E] 
    RST   $18                       ;[238F] 
    LD    C,L                       ;[2390] 
    LD    B,H                       ;[2391] 
    POP   HL                        ;[2392] 
    LD    (HL),C                    ;[2393] 
    INC   HL                        ;[2394] 
    LD    (HL),B                    ;[2395] 
    RET                             ;[2396] 

BASIC_COM_FOR:
    PUSH  AF                        ;[2397] FOR
    CALL  $2218                     ;[2398] 
    PUSH  HL                        ;[239B] 
    LD    HL,(SYSVAR_CURRLP)        ;[239C] 
    CALL  $1F2F                     ;[239F] 
    INC   DE                        ;[23A2] 
    RST   $28                       ;[23A3] 
    POP   HL                        ;[23A4] 
    PUSH  DE                        ;[23A5] 
    INC   HL                        ;[23A6] 
    RES   7,(HL)                    ;[23A7] 
    DEC   HL                        ;[23A9] 
    EX    DE,HL                     ;[23AA] 
    CALL  $275C                     ;[23AB] 
    POP   DE                        ;[23AE] 
    INC   DE                        ;[23AF] 
    RST   $28                       ;[23B0] 
    CALL  $23CC                     ;[23B1] 
    LD    A,(DE)                    ;[23B4] 
    CP    $0D                       ;[23B5] 
    JR    Z,$23C7                   ;[23B7] 
    INC   DE                        ;[23B9] 
    RST   $28                       ;[23BA] 
    CALL  $23CC                     ;[23BB] 
    POP   AF                        ;[23BE] 
    CALL  $1F3E                     ;[23BF] 
    LD    A,$0F                     ;[23C2] 
    JP    $1F3E                     ;[23C4] 
    CALL  LYNX_LONE                 ;[23C7] 
    JR    $23BB                     ;[23CA] 
    PUSH  DE                        ;[23CC] 
    LD    B,$05                     ;[23CD] 
    LD    DE,SYSVAR_WRA1            ;[23CF] 
    LD    A,(DE)                    ;[23D2] 
    CALL  $1F3E                     ;[23D3] 
    INC   DE                        ;[23D6] 
    DJNZ  $23D2                     ;[23D7] 
    POP   DE                        ;[23D9] 
    RET                             ;[23DA] 

BASIC_COM_NEXT:
    LD    HL,(SYSVAR_RSP)           ;[23DB] NEXT.
    DEC   HL                        ;[23DE] 
    LD    A,(HL)                    ;[23DF] 
    CP    $0F                       ;[23E0] 
    CALL  NZ,$3B14                  ;[23E2] 
    DEC   HL                        ;[23E5] 
    LD    A,(DE)                    ;[23E6] 
    CP    (HL)                      ;[23E7] 
    CALL  NZ,$3B14                  ;[23E8] 
    DEC   HL                        ;[23EB] 
    PUSH  DE                        ;[23EC] 
    CALL  $2423                     ;[23ED] 
    POP   DE                        ;[23F0] 
    LD    A,(SYSVAR_WRA2)           ;[23F1] 
    PUSH  AF                        ;[23F4] 
    PUSH  HL                        ;[23F5] 
    CALL  $2218                     ;[23F6] 
    PUSH  HL                        ;[23F9] 
    CALL  LYNX_LNUM1                ;[23FA] 
    CALL  LYNX_AD                   ;[23FD] 
    POP   HL                        ;[2400] 
    EX    DE,HL                     ;[2401] 
    CALL  $275C                     ;[2402] 
    POP   HL                        ;[2405] 
    CALL  $2423                     ;[2406] 
    POP   AF                        ;[2409] 
    BIT   7,A                       ;[240A] 
    PUSH  HL                        ;[240C] 
    CALL  Z,LYNX_SWAP               ;[240D] 
    CALL  LYNX_CMP                  ;[2410] 
    POP   HL                        ;[2413] 
    JR    C,$241E                   ;[2414] 
    LD    A,(HL)                    ;[2416] 
    DEC   HL                        ;[2417] 
    LD    L,(HL)                    ;[2418] 
    LD    H,A                       ;[2419] 
    LD    (SYSVAR_CURRLP),HL        ;[241A] 
    RET                             ;[241D] 

    DEC   HL                        ;[241E] 
    LD    (SYSVAR_RSP),HL           ;[241F] 
    RET                             ;[2422] 

    LD    BC,$0005                  ;[2423] 
    LD    DE,$62E4                  ;[2426] 
    LDDR                            ;[2429] 
    RET                             ;[242B] 

BASIC_COM_IF:
    RST   $28                       ;[242C] IF
    LD    A,(SYSVAR_WRA1)           ;[242D] 
    CP    $80                       ;[2430] 
    JR    Z,$2439                   ;[2432] 
    INC   DE                        ;[2434] 
    POP   BC                        ;[2435] 
    JP    $24A6                     ;[2436] 
    LD    IX,(SYSVAR_CURRLP)        ;[2439] 
    CALL  $255E                     ;[243D] 
    LD    A,(IX+$00)                ;[2440] 
    CP    $80                       ;[2443] 
    RET   Z                         ;[2445] 
    LD    A,(IX+$06)                ;[2446] 
    CP    $3C                       ;[2449] 
    RET   NZ                        ;[244B] 
    LD    (SYSVAR_CURRLP),IX        ;[244C] 
    CALL  $251B                     ;[2450] 
    JR    $2434                     ;[2453] 

BASIC_COM_TRAIL:
    LD    HL,SYSVAR_ZFLAG           ;[2455] TRAIL
    RES   1,(HL)                    ;[2458] 
    CP    $DA                       ;[245A] 
    RET   NZ                        ;[245C] is execution address for LABEL: ELSE: DATA:REM.
    SET   1,(HL)                    ;[245D] 

BASIC_COM_BASIC:
    RET                             ;[245F] CODE, REM, DATA, LABEL, ELSE

BASIC_COM_SPEED:
    RST   $18                       ;[2460] SPEED.
    LD    HL,SYSVAR_EXFLAG          ;[2461] 
    LD    (SYSVAR_SPEEDST),A        ;[2464] 
    SET   1,(HL)                    ;[2467] 
    OR    A                         ;[2469] 
    RET   NZ                        ;[246A] 
    RES   1,(HL)                    ;[246B] 
    RET                             ;[246D] 

BASIC_COM_TRACE:
    LD    HL,SYSVAR_EXFLAG          ;[246E] TRACE.
    JR    $2476                     ;[2471] 

BASIC_COM_ROUND:
    LD    HL,SYSVAR_ZFLAG           ;[2473] ROUND.
    RES   0,(HL)                    ;[2476] 
    CP    $DA                       ;[2478] 
    RET   NZ                        ;[247A] 
    SET   0,(HL)                    ;[247B] 
    RET                             ;[247D] 

BASIC_COM_LINK:
    LD    HL,SYSVAR_OTYPE           ;[247E] LINK.
    RES   7,(HL)                    ;[2481] 
    CP    $DA                       ;[2483] 
    RET   NZ                        ;[2485] 
    SET   7,(HL)                    ;[2486] 
    RET                             ;[2488] 

    PUSH  HL                        ;[2489] Called from 252D. (part of LIST)
    LD    HL,$3605                  ;[248A] 
    LD    (SYSVAR_CURRLP),HL        ;[248D] 
    POP   HL                        ;[2490] 
    JR    $2496                     ;[2491] 
    LD    (SYSVAR_CURRLP),HL        ;[2493] 
    LD    A,$0F                     ;[2496] 
    RST   $08                       ;[2498] 
    PUSH  HL                        ;[2499] 
    POP   IX                        ;[249A] 
    LD    A,(SYSVAR_EXFLAG)         ;[249C] 
    OR    A                         ;[249F] 
    CALL  NZ,SYSVAR_DEBUG           ;[24A0] 
    CALL  $251B                     ;[24A3] 
    LD    A,(DE)                    ;[24A6] 
    LD    BC,(SYSVAR_XETBL)         ;[24A7] 
    CALL  SYSVAR_EXECSUB            ;[24AB] 
    RLCA                            ;[24AE] 
    LD    L,A                       ;[24AF] 
    LD    H,$00                     ;[24B0] 
    ADD   HL,BC                     ;[24B2] 
    LD    BC,$24BE                  ;[24B3] 
    PUSH  BC                        ;[24B6] 
    LD    A,(HL)                    ;[24B7] 
    INC   HL                        ;[24B8] 
    LD    H,(HL)                    ;[24B9] 
    LD    L,A                       ;[24BA] 
    INC   DE                        ;[24BB] 
    LD    A,(DE)                    ;[24BC] 
    JP    (HL)                      ;[24BD] 
    LD    IX,(SYSVAR_CURRLP)        ;[24BE] 
    CALL  $255E                     ;[24C2] IF.
    LD    (SYSVAR_CURRLP),IX        ;[24C5] 
    LD    A,(IX+$00)                ;[24C9] 
    CP    $80                       ;[24CC] 
    JR    Z,$24E2                   ;[24CE] 
    LD    (SYSVAR_CONTLP),IX        ;[24D0] 
    CALL  LYNX_ESC                  ;[24D4] 
    JP    Z,$1E42                   ;[24D7] 
    JR    $249C                     ;[24DA] 
    LD    HL,START                  ;[24DC] 
    LD    (SYSVAR_CONTLP),HL        ;[24DF] 
    JP    $38E8                     ;[24E2] 
    PUSH  IX                        ;[24E5] 
    PUSH  AF                        ;[24E7] 
    BIT   0,A                       ;[24E8] 
    CALL  NZ,$24F6                  ;[24EA] 
    POP   AF                        ;[24ED] 
    BIT   1,A                       ;[24EE] 
    CALL  NZ,$250A                  ;[24F0] 
    POP   IX                        ;[24F3] 
    RET                             ;[24F5] 

    LD    HL,(SYSVAR_CURRLP)        ;[24F6] TRACE handling routine.
    LD    A,(HL)                    ;[24F9] 
    CP    $80                       ;[24FA] 
    RET   Z                         ;[24FC] 
    LD    A,$3C                     ;[24FD] 
    RST   $08                       ;[24FF] 
    CALL  LYNX_LNUM1                ;[2500] 
    CALL  LYNX_PN                   ;[2503] 
    LD    A,$3E                     ;[2506] 
    RST   $08                       ;[2508] 
    RET                             ;[2509] 

    LD    HL,(SYSVAR_CURRLP)        ;[250A] SPEED handling routine.
    LD    A,(HL)                    ;[250D] 
    CP    $80                       ;[250E] 
    RET   Z                         ;[2510] 
    LD    HL,(SYSVAR_SPEEDST)       ;[2511] 
    LD    H,L                       ;[2514] 
    DEC   HL                        ;[2515] 
    LD    A,H                       ;[2516] 
    OR    L                         ;[2517] 
    JR    NZ,$2515                  ;[2518] 
    RET                             ;[251A] 

    LD    DE,$0006                  ;[251B] 
    ADD   IX,DE                     ;[251E] 
    PUSH  IX                        ;[2520] 
    POP   DE                        ;[2522] 
    RET                             ;[2523] 

    CALL  $2779                     ;[2524] Input line analysis routine.
    LD    HL,(SYSVAR_POLBUF)        ;[2527] 
    LD    A,(HL)                    ;[252A] 
    CP    $80                       ;[252B] 
    JP    Z,$2489                   ;[252D] 
    CALL  LYNX_LNUM1                ;[2530] 
    PUSH  HL                        ;[2533] 
    LD    HL,START                  ;[2534] 
    LD    (SYSVAR_CONTLP),HL        ;[2537] 
    CALL  LYNX_FNDLN                ;[253A] 
    POP   HL                        ;[253D] 
    LD    L,(HL)                    ;[253E] 
    LD    H,$00                     ;[253F] 
    PUSH  HL                        ;[2541] 
    JR    NZ,$254C                  ;[2542] 
    LD    D,$00                     ;[2544] 
    LD    E,(IX+$05)                ;[2546] 
    OR    A                         ;[2549] 
    SBC   HL,DE                     ;[254A] 
    PUSH  IX                        ;[254C] 
    POP   DE                        ;[254E] 
    PUSH  IX                        ;[254F] 
    CALL  $256E                     ;[2551] 
    POP   DE                        ;[2554] 
    POP   BC                        ;[2555] 
    LD    HL,(SYSVAR_POLBUF)        ;[2556] 
    LDIR                            ;[2559] 
    JP    $1F6E                     ;[255B] 
    PUSH  DE                        ;[255E] Add line length to IX.
    LD    E,(IX+$05)                ;[255F] 
    LD    D,$00                     ;[2562] 
    ADD   IX,DE                     ;[2564] 
    POP   DE                        ;[2566] 
    RET                             ;[2567] 

LYNX_CHLDE:
    LD    A,H                       ;[2568] Compares HL, DE flags set as HL-DE. 
    SUB   D                         ;[2569] 
    RET   NZ                        ;[256A] 
    LD    A,L                       ;[256B] 
    SUB   E                         ;[256C] 
    RET                             ;[256D] 

    LD    A,H                       ;[256E] Load line to memory.
    OR    L                         ;[256F] 
    RET   Z                         ;[2570] 
    PUSH  HL                        ;[2571] 
    LD    HL,START                  ;[2572] 
    LD    (SYSVAR_PROCST),HL        ;[2575] 
    POP   HL                        ;[2578] 
    BIT   7,H                       ;[2579] 
    JR    NZ,$25A1                  ;[257B] 
    LD    BC,(SYSVAR_EOB)           ;[257D] 
    ADD   HL,BC                     ;[2581] 
    PUSH  HL                        ;[2582] 
    PUSH  DE                        ;[2583] 
    LD    DE,(SYSVAR_STACK)         ;[2584] 
    DEC   D                         ;[2588] 
    CALL  LYNX_CHLDE                ;[2589] 
    POP   DE                        ;[258C] 
    CALL  NC,$3B4D                  ;[258D] 
    CALL  $25BB                     ;[2590] 
    PUSH  BC                        ;[2593] 
    LD    L,C                       ;[2594] 
    LD    H,B                       ;[2595] 
    OR    A                         ;[2596] 
    SBC   HL,DE                     ;[2597] 
    PUSH  HL                        ;[2599] 
    POP   BC                        ;[259A] 
    POP   HL                        ;[259B] 
    POP   DE                        ;[259C] 
    INC   BC                        ;[259D] 
    LDDR                            ;[259E] 
    RET                             ;[25A0] 

    PUSH  HL                        ;[25A1] 
    PUSH  DE                        ;[25A2] 
    EX    DE,HL                     ;[25A3] 
    OR    A                         ;[25A4] 
    SBC   HL,DE                     ;[25A5] 
    PUSH  HL                        ;[25A7] 
    EX    DE,HL                     ;[25A8] 
    LD    HL,(SYSVAR_EOB)           ;[25A9] 
    OR    A                         ;[25AC] 
    SBC   HL,DE                     ;[25AD] 
    PUSH  HL                        ;[25AF] 
    POP   BC                        ;[25B0] 
    POP   HL                        ;[25B1] 
    POP   DE                        ;[25B2] 
    INC   BC                        ;[25B3] 
    LDIR                            ;[25B4] 
    POP   DE                        ;[25B6] 
    LD    HL,(SYSVAR_EOB)           ;[25B7] 
    ADD   HL,DE                     ;[25BA] 
    LD    (SYSVAR_EOB),HL           ;[25BB] 
    INC   HL                        ;[25BE] 
    LD    (SYSVAR_TOV),HL           ;[25BF] 
    PUSH  DE                        ;[25C2] 
    PUSH  BC                        ;[25C3] 
    CALL  $25CA                     ;[25C4] 
    POP   BC                        ;[25C7] 
    POP   DE                        ;[25C8] 
    RET                             ;[25C9] 

    LD    HL,(SYSVAR_STBL)          ;[25CA] Called from MAIN. Zeros memory.
    LD    B,$68                     ;[25CD] 
    XOR   A                         ;[25CF] 
    LD    (HL),A                    ;[25D0] 
    INC   HL                        ;[25D1] 
    DJNZ  $25D0                     ;[25D2] 
    LD    HL,(SYSVAR_ATBL)          ;[25D4] 
    LD    E,L                       ;[25D7] 
    LD    D,H                       ;[25D8] 
    INC   DE                        ;[25D9] 
    LD    BC,$00D3                  ;[25DA] 
    LD    (HL),$00                  ;[25DD] 
    LDIR                            ;[25DF] 
    RET                             ;[25E1] 

LYNX_RP:
    LD    (HL),$7D                  ;[25E2] Reads ASCII pointed to by DE into reverse polish pointed to by HL. 
    INC   HL                        ;[25E4] 
    CALL  SYSVAR_NTP                ;[25E5] 
    LD    A,(SYSVAR_NPM)            ;[25E8] 
    CP    $D7                       ;[25EB] 
    RET   NC                        ;[25ED] 
    LD    A,(DE)                    ;[25EE] 
    INC   DE                        ;[25EF] 
    RET                             ;[25F0] 

    RST   $20                       ;[25F1] Validation utility routine.
    LD    ($2377),HL                ;[25F2] 
    INC   DE                        ;[25F5] 
    LD    A,(DE)                    ;[25F6] 
    INC   DE                        ;[25F7] 
    LD    (HL),A                    ;[25F8] 
    INC   HL                        ;[25F9] 
    CP    $0D                       ;[25FA] 
    CALL  Z,$3B3B                   ;[25FC] 
    CP    $22                       ;[25FF] 
    JR    NZ,$25F6                  ;[2601] 
    JP    RST_10H                   ;[2603] 
    CALL  $2D08                     ;[2606] Validation for ROUND, TRAIL, LINK, TRACE.
    CP    $DA                       ;[2609] 
    JR    Z,$260F                   ;[260B] 
    RST   $20                       ;[260D] 
    IN    A,($77)                   ;[260E] 
    INC   HL                        ;[2610] 
    RST   $10                       ;[2611] 
    LD    (HL),A                    ;[2612] 
    RST   $20                       ;[2613] 
    DEC   C                         ;[2614] 
    RET                             ;[2615] 

    CALL  $25F1                     ;[2616] Validation for LOAD.NLOAD.APPEND, VERIFY.
    RST   $20                       ;[2619] 
    DEC   C                         ;[261A] 
    LD    (HL),A                    ;[261B] 
    RET                             ;[261C] 

    CALL  $25F1                     ;[261D] Validation for SAVE.
    CP    $0D                       ;[2620] 
    JR    Z,$261B                   ;[2622] 
    RST   $20                       ;[2624] 
    INC   L                         ;[2625] 
    LD    (HL),A                    ;[2626] 
    INC   HL                        ;[2627] 
    INC   DE                        ;[2628] 
    JP    $2707                     ;[2629] 
    CP    $22                       ;[262C] Validation for INPUT.
    JR    NZ,$2639                  ;[262E] 
    CALL  $25F1                     ;[2630] 
    RST   $20                       ;[2633] 
    DEC   SP                        ;[2634] 
    LD    (HL),A                    ;[2635] 
    INC   HL                        ;[2636] 
    INC   DE                        ;[2637] 
    RST   $10                       ;[2638] 
    PUSH  HL                        ;[2639] 
    LD    HL,(SYSVAR_POLBUF)        ;[263A] 
    LD    A,(HL)                    ;[263D] 
    CP    $80                       ;[263E] 
    CALL  Z,$3B4A                   ;[2640] 
    POP   HL                        ;[2643] 
    CALL  $21EA                     ;[2644] 
    JR    Z,$2657                   ;[2647] 
    CALL  $2721                     ;[2649] 
    LD    (HL),A                    ;[264C] 
    CP    $0D                       ;[264D] 
    RET   Z                         ;[264F] 
    RST   $20                       ;[2650] 
    INC   L                         ;[2651] 
    INC   HL                        ;[2652] 
    INC   DE                        ;[2653] 
    RST   $10                       ;[2654] 
    JR    $2639                     ;[2655] 
    CALL  $21F4                     ;[2657] 
    RST   $10                       ;[265A] 
    JR    $264C                     ;[265B] 
    CP    $0D                       ;[265D] Validation for RESTORE.
    JP    NZ,$2707                  ;[265F] 
    LD    (HL),A                    ;[2662] 
    RET                             ;[2663] 

    CP    $0D                       ;[2664] Validation for LIST.LLIST. RENUM.
    JR    Z,$2662                   ;[2666] 
    CALL  LYNX_RP                   ;[2668] Validation for CALL.
    CP    $0D                       ;[266B] 
    JR    Z,$2662                   ;[266D] 
    RST   $20                       ;[266F] 
    INC   L                         ;[2670] 
    LD    (HL),A                    ;[2671] 
    INC   HL                        ;[2672] 
    JP    $2707                     ;[2673] 
    POP   AF                        ;[2676] 
    POP   HL                        ;[2677] 
    LD    A,$00                     ;[2678] 
    LD    (HL),A                    ;[267A] 
    INC   HL                        ;[267B] 
    CALL  $21EA                     ;[267C] Validation routine for LET.
    JR    Z,$2696                   ;[267F] 
    CALL  $2721                     ;[2681] 
    CP    $3D                       ;[2684] 
    JP    NZ,$26A6                  ;[2686] 
    LD    (HL),A                    ;[2689] 
    INC   HL                        ;[268A] 
    INC   DE                        ;[268B] 
    CALL  LYNX_RP                   ;[268C] 
    CP    $2C                       ;[268F] 
    JR    Z,$267A                   ;[2691] 
    JP    $26DB                     ;[2693] 
    CALL  $21F4                     ;[2696] 
    RST   $10                       ;[2699] 
    RST   $20                       ;[269A] 
    DEC   A                         ;[269B] 
    LD    (HL),A                    ;[269C] 
    INC   HL                        ;[269D] 
    INC   DE                        ;[269E] 
    RST   $10                       ;[269F] 
    CALL  $2C9D                     ;[26A0] 
    INC   DE                        ;[26A3] 
    JR    $268F                     ;[26A4] 
    LD    DE,$6000                  ;[26A6] 
    LD    HL,(SYSVAR_POLBUF)        ;[26A9] 
    PUSH  HL                        ;[26AC] 
    CALL  $2707                     ;[26AD] 
    POP   DE                        ;[26B0] 
    CALL  SYSVAR_EE                 ;[26B1] 
    CALL  LYNX_PN                   ;[26B4] 
    LD    A,$0D                     ;[26B7] 
    RST   $08                       ;[26B9] 
    JP    $38E8                     ;[26BA] 
    CALL  $270D                     ;[26BD] Validation routine for DPOKE, POKE, DOT, OUT, MOVE, DRAW.SOUND.
    JP    $2707                     ;[26C0] 
    PUSH  DE                        ;[26C3] Validation routine for GOSUB.GOTO.
    CALL  $2D08                     ;[26C4] 
    JR    C,$26CD                   ;[26C7] 
    CP    $D8                       ;[26C9] 
    JR    Z,$26D1                   ;[26CB] 
    POP   DE                        ;[26CD] 
    JP    $2707                     ;[26CE] 
    POP   BC                        ;[26D1] 
    LD    (HL),A                    ;[26D2] 
    INC   HL                        ;[26D3] 
    RST   $10                       ;[26D4] 
    JP    $273C                     ;[26D5] 
    CALL  $2715                     ;[26D8] Validation routine for NEXT.
    LD    (HL),A                    ;[26DB] Validation for MON, ENDPROC, RANDOM, END, STOP, RETURN, CLS, CONT, NEW, WEND, REPEAT, DISK, TEXT.
    RST   $20                       ;[26DC] 
    DEC   C                         ;[26DD] 
    RET                             ;[26DE] 

    CALL  $2715                     ;[26DF] Validation for FOR.
    RST   $20                       ;[26E2] 
    DEC   A                         ;[26E3] 
    INC   DE                        ;[26E4] 
    LD    (HL),A                    ;[26E5] 
    INC   HL                        ;[26E6] 
    CALL  LYNX_RP                   ;[26E7] 
    RST   $20                       ;[26EA] 
    LD    (IX+$23),A                ;[26EB] 
    CALL  LYNX_RP                   ;[26EE] 
    CP    $0D                       ;[26F1] 
    JP    Z,$2662                   ;[26F3] 
    RST   $20                       ;[26F6] 
    CALL  C,$2377                   ;[26F7] 
    JP    $2707                     ;[26FA] 
    CALL  LYNX_RP                   ;[26FD] Validation for IF.
    RST   $20                       ;[2700] 
    RST   $10                       ;[2701] 
    LD    (HL),A                    ;[2702] 
    INC   HL                        ;[2703] 
    JP    $27A9                     ;[2704] 
    CALL  LYNX_RP                   ;[2707] Validation for INK, PAPER, PAUSE, WHILE, UNTIL, RESERVE, CFR,  CCHAR, SPEED, PROTECT, ERROR, TAPE.
    JP    $26DB                     ;[270A] 
    CALL  LYNX_RP                   ;[270D] Convert to internal language and check for a comma.
    RST   $20                       ;[2710] 
    INC   L                         ;[2711] 
    LD    (HL),A                    ;[2712] 
    INC   HL                        ;[2713] 
    RET                             ;[2714] 

    CALL  $34F5                     ;[2715] Test for a variable and find next non-blank.
    CALL  C,$3B3B                   ;[2718] 
    LD    (HL),A                    ;[271B] 
    INC   DE                        ;[271C] 
    INC   HL                        ;[271D] 
    JP    RST_10H                   ;[271E] 
    CALL  $34F5                     ;[2721] is validation routine for READ.
    JP    C,$26A6                   ;[2724] 
    LD    (HL),A                    ;[2727] 
    INC   HL                        ;[2728] 
    INC   DE                        ;[2729] 
    RST   $10                       ;[272A] 
    CP    $28                       ;[272B] 
    RET   NZ                        ;[272D] 
    LD    (HL),$28                  ;[272E] 
    INC   HL                        ;[2730] 
    INC   DE                        ;[2731] 
    CALL  LYNX_RP                   ;[2732] 
    RST   $20                       ;[2735] 
    ADD   HL,HL                     ;[2736] 
    LD    (HL),A                    ;[2737] 
    INC   HL                        ;[2738] 
    JP    RST_10H                   ;[2739] 
    LD    A,(DE)                    ;[273C] Validation for REM, DATA, EXT, LABEL.
    LD    (HL),A                    ;[273D] 
    CP    $0D                       ;[273E] 
    RET   Z                         ;[2740] 
    INC   HL                        ;[2741] 
    INC   DE                        ;[2742] 
    JR    $273C                     ;[2743] 
    CALL  $2721                     ;[2745] Validation for SWAP.
    LD    (HL),A                    ;[2748] 
    CP    $2C                       ;[2749] 
    JR    NZ,$2756                  ;[274B] 
    INC   HL                        ;[274D] 
    INC   DE                        ;[274E] 
    CALL  $2721                     ;[274F] 
    LD    (HL),A                    ;[2752] 
    CP    $0D                       ;[2753] 
    RET   Z                         ;[2755] 
    CALL  $3B38                     ;[2756] 
    LD    DE,SYSVAR_WRA2            ;[2759] 
    LD    HL,SYSVAR_WRA1            ;[275C] Copy WRA1 to where DE points.
    LD    BC,$0005                  ;[275F] 
    LDIR                            ;[2762] 
    RET                             ;[2764] 

    LD    A,(SYSVAR_AUTOFL)         ;[2765] Line analysis subroutine.
    OR    A                         ;[2768] 
    JP    Z,SUB_FIND                ;[2769] 
    PUSH  HL                        ;[276C] 
    LD    HL,SYSVAR_AUTOST          ;[276D] 
    PUSH  DE                        ;[2770] 
    CALL  LYNX_LNUM1                ;[2771] 
    POP   DE                        ;[2774] 
    POP   HL                        ;[2775] 
    JP    $2796                     ;[2776] 
    CALL  $2765                     ;[2779] Line analysis subroutine.
    INC   HL                        ;[277C] 
    LD    (HL),$80                  ;[277D] 
    LD    DE,(SYSVAR_POLBUF)        ;[277F] 
    PUSH  DE                        ;[2783] 
    POP   IX                        ;[2784] 
    OR    A                         ;[2786] 
    SBC   HL,DE                     ;[2787] 
    XOR   A                         ;[2789] 
    CP    H                         ;[278A] 
    CALL  NZ,$3B20                  ;[278B] 
    LD    (IX+$05),L                ;[278E] 
    RET                             ;[2791] 

SUB_FIND:
    RST   $10                       ;[2792] Part of the find logic for looking at words in a list.
    CALL  LYNX_RDN                  ;[2793] 
    LD    A,(SYSVAR_WRA1)           ;[2796] 
    BIT   7,A                       ;[2799] 
    JP    Z,$26A6                   ;[279B] 
    PUSH  DE                        ;[279E] 
    LD    DE,(SYSVAR_POLBUF)        ;[279F] 
    CALL  $275C                     ;[27A3] 
    EX    DE,HL                     ;[27A6] 
    INC   HL                        ;[27A7] 
    POP   DE                        ;[27A8] 
    RST   $10                       ;[27A9] Validation for ELSE.
    CALL  SYSVAR_INPLSUB            ;[27AA] 
    PUSH  HL                        ;[27AD] 
    LD    HL,(SYSVAR_XTTBL)         ;[27AE] 
    LD    B,(HL)                    ;[27B1] 
    PUSH  BC                        ;[27B2] 
    CALL  $1949                     ;[27B3] 
    JP    C,$2676                   ;[27B6] 
    POP   AF                        ;[27B9] 
    SUB   B                         ;[27BA] 
    POP   HL                        ;[27BB] 
    LD    (HL),A                    ;[27BC] 
    INC   HL                        ;[27BD] 
    LD    IX,(SYSVAR_XITBL)         ;[27BE] 
    RLCA                            ;[27C2] 
    LD    C,A                       ;[27C3] 
    LD    B,$00                     ;[27C4] 
    ADD   IX,BC                     ;[27C6] 
    LD    C,(IX+$00)                ;[27C8] 
    LD    B,(IX+$01)                ;[27CB] 
    PUSH  BC                        ;[27CE] 
    JP    RST_10H                   ;[27CF] 
    CALL  $352A                     ;[27D2] Print a word from a list (6219).
    LD    HL,(SYSVAR_XTTBL)         ;[27D5] 
    LD    B,A                       ;[27D8] 
    INC   B                         ;[27D9] 
    CALL  $1893                     ;[27DA] 
    CALL  $1870                     ;[27DD] 
    CALL  $352A                     ;[27E0] 
    INC   DE                        ;[27E3] 
    RET                             ;[27E4] 

    PUSH  IX                        ;[27E5] Display coded line. Pointed to from 62B2.
    POP   HL                        ;[27E7] 
    PUSH  HL                        ;[27E8] 
    CALL  LYNX_LNUM1                ;[27E9] 
    CALL  LYNX_PN                   ;[27EC] 
    CALL  $285F                     ;[27EF] 
    CALL  $2877                     ;[27F2] 
    CALL  $251B                     ;[27F5] 
    LD    A,(DE)                    ;[27F8] 
    PUSH  AF                        ;[27F9] 
    CALL  $27D2                     ;[27FA] 
    POP   AF                        ;[27FD] 
    CP    $3C                       ;[27FE] 
    JR    Z,$27F8                   ;[2800] 
    CP    $33                       ;[2802] 
    JP    Z,$0F0A                   ;[2804] 
    DEC   DE                        ;[2807] 
    INC   DE                        ;[2808] 
    LD    A,(DE)                    ;[2809] 
    CP    $7B                       ;[280A] 
    RET   Z                         ;[280C] 
    CP    $0D                       ;[280D] 
    JR    Z,$2840                   ;[280F] 
    CP    $7D                       ;[2811] 
    JR    Z,$2824                   ;[2813] 
    CP    $80                       ;[2815] 
    JR    NC,$282A                  ;[2817] 
    RST   $08                       ;[2819] 
    CP    $22                       ;[281A] 
    JR    NZ,$2808                  ;[281C] 
    CALL  $2257                     ;[281E] 
    RST   $08                       ;[2821] 
    JR    $2808                     ;[2822] 
    INC   DE                        ;[2824] 
    CALL  SYSVAR_PP                 ;[2825] 
    JR    $2808                     ;[2828] 
    CP    $DF                       ;[282A] 
    PUSH  AF                        ;[282C] 
    CALL  C,$352A                   ;[282D] 
    CALL  $1857                     ;[2830] 
    POP   AF                        ;[2833] 
    PUSH  AF                        ;[2834] 
    CALL  C,$352A                   ;[2835] 
    POP   AF                        ;[2838] 
    INC   DE                        ;[2839] 
    CP    $D7                       ;[283A] 
    JR    Z,$27F8                   ;[283C] 
    JR    $2809                     ;[283E] 
    POP   IX                        ;[2840] 
    CALL  $284C                     ;[2842] 
    LD    A,$1E                     ;[2845] 
    RST   $08                       ;[2847] 
    LD    A,$1F                     ;[2848] 
    RST   $08                       ;[284A] 
    RET                             ;[284B] 

    LD    A,(IX+$06)                ;[284C] Test for FOR, WHILE and REPEAT,
    CP    $36                       ;[284F] 
    JR    Z,$285A                   ;[2851] 
    CP    $0F                       ;[2853] 
    JR    Z,$285A                   ;[2855] 
    CP    $38                       ;[2857] 
    RET   NZ                        ;[2859] 
    LD    HL,SYSVAR_SBC             ;[285A] 
    INC   (HL)                      ;[285D] 
    RET                             ;[285E] 

    LD    A,(IX+$06)                ;[285F] Test for NEXT, WEND and UNTIL.
    CP    $37                       ;[2862] 
    JR    Z,$286D                   ;[2864] 
    CP    $05                       ;[2866] 
    JR    Z,$286D                   ;[2868] 
    CP    $39                       ;[286A] 
    RET   NZ                        ;[286C] 
    LD    A,(SYSVAR_SBC)            ;[286D] 
    OR    A                         ;[2870] 
    RET   Z                         ;[2871] 
    DEC   A                         ;[2872] 
    LD    (SYSVAR_SBC),A            ;[2873] 
    RET                             ;[2876] 

    LD    A,(SYSVAR_SBC)            ;[2877] Print spaces for indentation
    OR    A                         ;[287A] 
    RET   Z                         ;[287B] 
    CP    $0A                       ;[287C] 
    JR    C,$2882                   ;[287E] 
    LD    A,$0A                     ;[2880] 
    RLCA                            ;[2882] 
    LD    B,A                       ;[2883] 
    CALL  $352A                     ;[2884] 
    DJNZ  $2884                     ;[2887] 
    RET                             ;[2889] 

BASIC_COM_AUTO:
    LD    HL,DATA_AUTO              ;[288A] AUTO.
    PUSH  DE                        ;[288D] 
    LD    DE,SYSVAR_AUTOST          ;[288E] 
    LD    BC,$000A                  ;[2891] 
    LDIR                            ;[2894] 
    POP   DE                        ;[2896] 
    CP    $0D                       ;[2897] 
    JR    Z,$28C9                   ;[2899] 
    RST   $28                       ;[289B] 
    LD    A,(SYSVAR_WRA1)           ;[289C] 
    PUSH  DE                        ;[289F] 
    CP    $C0                       ;[28A0] 
    CALL  C,$3B29                   ;[28A2] 
    CP    $C7                       ;[28A5] 
    CALL  NC,$3B29                  ;[28A7] 
    LD    DE,SYSVAR_AUTOST          ;[28AA] 
    CALL  $275C                     ;[28AD] 
    POP   DE                        ;[28B0] 
    LD    A,(DE)                    ;[28B1] 
    CP    $0D                       ;[28B2] 
    JR    Z,$28C9                   ;[28B4] 
    INC   DE                        ;[28B6] 
    RST   $28                       ;[28B7] 
    LD    A,(SYSVAR_WRA1)           ;[28B8] 
    CP    $C0                       ;[28BB] 
    JR    C,$28A2                   ;[28BD] 
    CP    $F0                       ;[28BF] 
    JR    NC,$28A7                  ;[28C1] 
    LD    DE,$62F8                  ;[28C3] 
    CALL  $275C                     ;[28C6] 
    LD    A,$01                     ;[28C9] 
    LD    (SYSVAR_AUTOFL),A         ;[28CB] 
    RET                             ;[28CE] 


DATA_AUTO:
    defb 0xC2,0x10,0x00,0x00,0x00,0xC1,0x10,0x00        ;[28CF]
    defb 0x00,0x00                                      ;[28D7]

BASIC_FN_BIN:
    LD    A,(SYSVAR_WRA1)           ;[28D9] BIN.
    CP    $C0                       ;[28DC] 
    JP    C,LYNX_LZERO              ;[28DE] 
    CP    $C8                       ;[28E1] 
    CALL  NC,$3B23                  ;[28E3] 
    SUB   $BF                       ;[28E6] 
    LD    B,A                       ;[28E8] 
    LD    C,$00                     ;[28E9] 
    PUSH  BC                        ;[28EB] 
    CALL  $3656                     ;[28EC] 
    POP   BC                        ;[28EF] 
    AND   $0F                       ;[28F0] 
    CP    $02                       ;[28F2] 
    CALL  NC,$3B23                  ;[28F4] 
    CP    $01                       ;[28F7] 
    CCF                             ;[28F9] 
    RL    C                         ;[28FA] 
    DJNZ  $28EB                     ;[28FC] 
    LD    L,C                       ;[28FE] 
    LD    H,$00                     ;[28FF] 
    JP    LYNX_INTFP                ;[2901] 

BASIC_COM_PROC:
    LD    HL,(SYSVAR_CURRLP)        ;[2904] Load (DE) to (HL) testing for CR and (.
    CALL  $1F2F                     ;[2907] 
    LD    A,$04                     ;[290A] 
    CALL  $1F3E                     ;[290C] 
    LD    C,$02                     ;[290F] 
    LD    HL,(SYSVAR_PROCST)        ;[2911] 
    LD    A,L                       ;[2914] 
    OR    H                         ;[2915] 
    PUSH  HL                        ;[2916] 
    POP   IX                        ;[2917] 
    CALL  Z,$293F                   ;[2919] 
    LD    C,$02                     ;[291C] 
    CALL  $22AD                     ;[291E] 
    CP    $0D                       ;[2921] 
    RET   Z                         ;[2923] 
    LD    A,(DE)                    ;[2924] 
    CP    $29                       ;[2925] 
    RET   Z                         ;[2927] 
    INC   HL                        ;[2928] 
    INC   DE                        ;[2929] 
    PUSH  HL                        ;[292A] 
    RST   $28                       ;[292B] 
    POP   HL                        ;[292C] 
    PUSH  DE                        ;[292D] 
    EX    DE,HL                     ;[292E] 
    CALL  $2218                     ;[292F] 
    PUSH  DE                        ;[2932] 
    INC   HL                        ;[2933] 
    RES   7,(HL)                    ;[2934] 
    DEC   HL                        ;[2936] 
    EX    DE,HL                     ;[2937] 
    CALL  $275C                     ;[2938] 
    POP   HL                        ;[293B] 
    POP   DE                        ;[293C] 
    JR    $2924                     ;[293D] 
    LD    IX,(SYSVAR_SOB)           ;[293F] 
    CALL  $2190                     ;[2943] 
    CALL  C,$3B2C                   ;[2946] 
    LD    (SYSVAR_PROCST),IX        ;[2949] 
    RET                             ;[294D] 

    LD    A,(DE)                    ;[294E] 
    INC   DE                        ;[294F] 
    LD    (HL),A                    ;[2950] 
    CP    $0D                       ;[2951] 
    JR    Z,$295B                   ;[2953] 
    INC   HL                        ;[2955] 
    CP    $28                       ;[2956] 
    JR    NZ,$294E                  ;[2958] 
    RET                             ;[295A] 

    POP   BC                        ;[295B] 
    RET                             ;[295C] 

    CALL  $294E                     ;[295D] Validation for PROC.
    CALL  LYNX_RP                   ;[2960] 
    LD    (HL),A                    ;[2963] 
    INC   HL                        ;[2964] 
    CP    $2C                       ;[2965] 
    JR    Z,$2960                   ;[2967] 
    RST   $20                       ;[2969] 
    ADD   HL,HL                     ;[296A] 
    RST   $10                       ;[296B] 
    JP    $26DB                     ;[296C] 
    CALL  $294E                     ;[296F] Validation for DEFPPOC.
    RST   $10                       ;[2972] 
    CALL  $34F5                     ;[2973] 
    CALL  C,$3B3B                   ;[2976] 
    LD    (HL),A                    ;[2979] 
    INC   DE                        ;[297A] 
    RST   $10                       ;[297B] 
    INC   HL                        ;[297C] 
    LD    A,(DE)                    ;[297D] 
    LD    (HL),A                    ;[297E] 
    INC   HL                        ;[297F] 
    INC   DE                        ;[2980] 
    CP    $2C                       ;[2981] 
    JR    Z,$2972                   ;[2983] 
    JP    $2969                     ;[2985] 

BASIC_COM_ENDPROC:
    CALL  $1F55                     ;[2988] ENDPROC.
    CP    $04                       ;[298B] 
    CALL  NZ,$3AFC                  ;[298D] 
    JP    $207C                     ;[2990] 

SUB_PRINT:
    INC   DE                        ;[2993] Part of the PRINT routine.
    RST   $28                       ;[2994] 
    PUSH  DE                        ;[2995] 
    CALL  LYNX_FPINT                ;[2996] 
    POP   DE                        ;[2999] 
    CALL  LYNX_PHEXHL               ;[299A] 
    LD    A,$48                     ;[299D] 
    RST   $08                       ;[299F] 
    JP    BASIC_COM_PRINT           ;[29A0] 
    RST   $28                       ;[29A3] 
    PUSH  DE                        ;[29A4] 
    CALL  LYNX_PN                   ;[29A5] 
    POP   DE                        ;[29A8] 

BASIC_COM_PRINT:
    LD    C,$00                     ;[29A9] PRINT.
    LD    A,(DE)                    ;[29AB] 
    CP    $0D                       ;[29AC] 
    JR    Z,$29D6                   ;[29AE] 
    CP    $2C                       ;[29B0] 
    JR    Z,$29DD                   ;[29B2] 
    CP    $3B                       ;[29B4] 
    JR    Z,$29E0                   ;[29B6] 
    CP    $23                       ;[29B8] 
    JR    Z,SUB_PRINT               ;[29BA] 
    CP    $7D                       ;[29BC] 
    JR    Z,$29A3                   ;[29BE] 
    CP    $DE                       ;[29C0] 
    JP    Z,$29E5                   ;[29C2] 
    CP    $D9                       ;[29C5] 
    JP    Z,$29F8                   ;[29C7] 
    CALL  $2BDD                     ;[29CA] 
    LD    HL,SYSVAR_STRBUF          ;[29CD] 
    CALL  LYNX_PRTSTR               ;[29D0] 
    JP    BASIC_COM_PRINT           ;[29D3] 
    LD    A,C                       ;[29D6] 
    OR    A                         ;[29D7] 
    RET   NZ                        ;[29D8] 
    LD    A,$0D                     ;[29D9] 
    RST   $08                       ;[29DB] 
    RET                             ;[29DC] 

    LD    A,$09                     ;[29DD] 
    RST   $08                       ;[29DF] 
    LD    C,$01                     ;[29E0] 
    INC   DE                        ;[29E2] 
    JR    $29AB                     ;[29E3] 
    INC   DE                        ;[29E5] 
    RST   $18                       ;[29E6] 
    RLCA                            ;[29E7] 
    ADD   A,L                       ;[29E8] 
    LD    HL,(SYSVAR_CURSORX)       ;[29E9] 
    CP    L                         ;[29EC] 
    JR    C,$29F5                   ;[29ED] 
    LD    (SYSVAR_CURSORX),A        ;[29EF] 
    LD    A,$1E                     ;[29F2] 
    RST   $08                       ;[29F4] 
    JP    BASIC_COM_PRINT           ;[29F5] 
    INC   DE                        ;[29F8] 
    RST   $18                       ;[29F9] 
    LD    (SYSVAR_CURSORX),HL       ;[29FA] 
    INC   DE                        ;[29FD] 
    RST   $18                       ;[29FE] 
    LD    (SYSVAR_CURSORY),A        ;[29FF] 
    JR    $29F5                     ;[2A02] 
    LD    (HL),A                    ;[2A04] 
    INC   DE                        ;[2A05] 
    INC   HL                        ;[2A06] 
    JR    $2A43                     ;[2A07] 
    CALL  $2C9D                     ;[2A09] 
    JR    $2A10                     ;[2A0C] 
    INC   HL                        ;[2A0E] 
    INC   DE                        ;[2A0F] 
    RST   $10                       ;[2A10] 
    LD    (HL),A                    ;[2A11] Validation for PRINT.
    CP    $0D                       ;[2A12] 
    RET   Z                         ;[2A14] 
    CP    $23                       ;[2A15] 
    JR    Z,$2A04                   ;[2A17] 
    CP    $2C                       ;[2A19] 
    JR    Z,$2A0E                   ;[2A1B] 
    CP    $3B                       ;[2A1D] 
    JR    Z,$2A0E                   ;[2A1F] 
    CALL  $2B4B                     ;[2A21] 
    JR    Z,$2A09                   ;[2A24] 
    PUSH  DE                        ;[2A26] 
    CALL  $2D08                     ;[2A27] 
    JR    C,$2A42                   ;[2A2A] 
    CP    $DE                       ;[2A2C] 
    JR    Z,$2A3E                   ;[2A2E] 
    CP    $D9                       ;[2A30] 
    JR    NZ,$2A42                  ;[2A32] 
    POP   BC                        ;[2A34] 
    LD    (HL),A                    ;[2A35] 
    INC   HL                        ;[2A36] 
    CALL  LYNX_RP                   ;[2A37] 
    RST   $20                       ;[2A3A] 
    INC   L                         ;[2A3B] 
    JR    $2A3F                     ;[2A3C] 
    POP   BC                        ;[2A3E] 
    LD    (HL),A                    ;[2A3F] 
    INC   HL                        ;[2A40] 
    PUSH  DE                        ;[2A41] 
    POP   DE                        ;[2A42] 
    CALL  LYNX_RP                   ;[2A43] 
    CP    $80                       ;[2A46] 
    CALL  NC,$3B3B                  ;[2A48] 
    DEC   DE                        ;[2A4B] 
    JR    $2A11                     ;[2A4C] 

BASIC_COM_RESERVE:
    RST   $18                       ;[2A4E] RESERVE.
    EX    DE,HL                     ;[2A4F] 
    LD    HL,(SYSVAR_STACK)         ;[2A50] 
    INC   HL                        ;[2A53] 
    INC   HL                        ;[2A54] 
    PUSH  HL                        ;[2A55] 
    OR    A                         ;[2A56] 
    SBC   HL,DE                     ;[2A57] 
    CALL  C,$3B29                   ;[2A59] 
    LD    HL,(SYSVAR_TOV)           ;[2A5C] 
    INC   H                         ;[2A5F] 
    INC   H                         ;[2A60] 
    SBC   HL,DE                     ;[2A61] 
    CALL  NC,$3B29                  ;[2A63] 
    POP   HL                        ;[2A66] 
    DEC   H                         ;[2A67] 
    DEC   D                         ;[2A68] 
    LD    BC,$0100                  ;[2A69] 
    LDIR                            ;[2A6C] 
    OR    A                         ;[2A6E] 
    EX    DE,HL                     ;[2A6F] 
    SBC   HL,DE                     ;[2A70] 
    EX    DE,HL                     ;[2A72] 
    LD    HL,(SYSVAR_STACK)         ;[2A73] 
    ADD   HL,DE                     ;[2A76] 
    LD    (SYSVAR_STACK),HL         ;[2A77] 
    EX    DE,HL                     ;[2A7A] 
    ADD   HL,SP                     ;[2A7B] 
    LD    SP,HL                     ;[2A7C] 
    RET                             ;[2A7D] 

BASIC_COM_RENUM:
    CALL  BASIC_COM_AUTO            ;[2A7E] RENUM
    XOR   A                         ;[2A81] 
    LD    (SYSVAR_AUTOFL),A         ;[2A82] 
    LD    IX,(SYSVAR_SOB)           ;[2A85] 
    LD    A,(IX+$00)                ;[2A89] 
    CP    $80                       ;[2A8C] 
    JR    Z,$2AF1                   ;[2A8E] 
    PUSH  IX                        ;[2A90] 
    CALL  $251B                     ;[2A92] 
    LD    A,(DE)                    ;[2A95] 
    CP    $27                       ;[2A96] 
    JR    NZ,$2AA4                  ;[2A98] 
    CALL  $17FC                     ;[2A9A] 
    LD    A,(DE)                    ;[2A9D] 
    CP    $D7                       ;[2A9E] 
    JR    NZ,$2A9A                  ;[2AA0] 
    INC   DE                        ;[2AA2] 
    LD    A,(DE)                    ;[2AA3] 
    CP    $3C                       ;[2AA4] 
    JR    NZ,$2AAA                  ;[2AA6] 
    INC   DE                        ;[2AA8] 
    LD    A,(DE)                    ;[2AA9] 
    CP    $10                       ;[2AAA] 
    JR    Z,$2ABA                   ;[2AAC] 
    CP    $14                       ;[2AAE] 
    JR    Z,$2ABA                   ;[2AB0] 
    CP    $11                       ;[2AB2] 
    JR    Z,$2ABA                   ;[2AB4] 
    CP    $20                       ;[2AB6] 
    JR    NZ,$2AEA                  ;[2AB8] 
    INC   DE                        ;[2ABA] 
    LD    A,(DE)                    ;[2ABB] 
    CP    $7D                       ;[2ABC] 
    JR    NZ,$2AEA                  ;[2ABE] 
    INC   DE                        ;[2AC0] 
    LD    A,(DE)                    ;[2AC1] 
    CP    $7E                       ;[2AC2] 
    JR    NZ,$2AEA                  ;[2AC4] 
    INC   DE                        ;[2AC6] 
    PUSH  DE                        ;[2AC7] 
    EX    DE,HL                     ;[2AC8] 
    CALL  LYNX_LNUM1                ;[2AC9] 
    CALL  LYNX_FNDLN                ;[2ACC] 
    LD    L,C                       ;[2ACF] 
    LD    H,B                       ;[2AD0] 
    CALL  LYNX_INTFP                ;[2AD1] 
    LD    HL,$62F8                  ;[2AD4] 
    CALL  LYNX_LNUM2                ;[2AD7] 
    CALL  LYNX_MLT                  ;[2ADA] 
    LD    HL,SYSVAR_AUTOST          ;[2ADD] 
    CALL  LYNX_LNUM2                ;[2AE0] 
    CALL  LYNX_AD                   ;[2AE3] 
    POP   DE                        ;[2AE6] 
    CALL  $275C                     ;[2AE7] 
    POP   IX                        ;[2AEA] 
    CALL  $255E                     ;[2AEC] 
    JR    $2A89                     ;[2AEF] 
    LD    IX,(SYSVAR_SOB)           ;[2AF1] 
    LD    HL,SYSVAR_AUTOST          ;[2AF5] 
    CALL  LYNX_LNUM1                ;[2AF8] 
    LD    A,(IX+$00)                ;[2AFB] 
    CP    $80                       ;[2AFE] 
    RET   Z                         ;[2B00] 
    PUSH  IX                        ;[2B01] 
    POP   DE                        ;[2B03] 
    PUSH  DE                        ;[2B04] 
    CALL  $275C                     ;[2B05] 
    LD    HL,$62F8                  ;[2B08] 
    CALL  LYNX_LNUM2                ;[2B0B] 
    CALL  LYNX_AD                   ;[2B0E] 
    POP   IX                        ;[2B11] 
    CALL  $255E                     ;[2B13] 
    JR    $2AFB                     ;[2B16] 
    CALL  LYNX_FNDLN                ;[2B18] 
    CALL  NZ,$3B2C                  ;[2B1B] 
    RET                             ;[2B1E] 

LYNX_FNDLN:
    LD    IX,(SYSVAR_SOB)           ;[2B1F] Finds line with number in WRA1. IX points to line and z flag set if found, else IX points to next highest line. 
    LD    BC,START                  ;[2B23] 
    LD    A,(IX+$00)                ;[2B26] 
    CP    $80                       ;[2B29] 
    JR    Z,$2B49                   ;[2B2B] 
    PUSH  IX                        ;[2B2D] 
    POP   DE                        ;[2B2F] 
    LD    HL,SYSVAR_WRA1            ;[2B30] 
    PUSH  BC                        ;[2B33] 
    LD    B,$05                     ;[2B34] 
    LD    A,(DE)                    ;[2B36] 
    CP    (HL)                      ;[2B37] 
    JR    C,$2B42                   ;[2B38] 
    JR    NZ,$2B40                  ;[2B3A] 
    INC   HL                        ;[2B3C] 
    INC   DE                        ;[2B3D] 
    DJNZ  $2B36                     ;[2B3E] 
    POP   BC                        ;[2B40] 
    RET                             ;[2B41] 

    POP   BC                        ;[2B42] 
    INC   BC                        ;[2B43] 
    CALL  $255E                     ;[2B44] 
    JR    $2B26                     ;[2B47] 
    OR    A                         ;[2B49] 
    RET                             ;[2B4A] 

    RST   $10                       ;[2B4B] Line analysis subroutine.
    CP    $22                       ;[2B4C] 
    RET   Z                         ;[2B4E] 
    CALL  $21EA                     ;[2B4F] 
    RET   Z                         ;[2B52] 
    PUSH  DE                        ;[2B53] 
    CALL  $2D08                     ;[2B54] 
    POP   DE                        ;[2B57] 
    CP    $DF                       ;[2B58] 
    RET   C                         ;[2B5A] 
    CP    $E7                       ;[2B5B] 
    DEC   A                         ;[2B5D] 
    RET   NC                        ;[2B5E] 
    CP    A                         ;[2B5F] 
    RET                             ;[2B60] 

    PUSH  IX                        ;[2B61] Line analysis subroutine.
    LD    A,(DE)                    ;[2B63] 
    RST   $20                       ;[2B64] 
    LD    A,L                       ;[2B65] 
    INC   DE                        ;[2B66] 
    CALL  $33AD                     ;[2B67] 
    CALL  LYNX_FPINT                ;[2B6A] 
    POP   IX                        ;[2B6D] 
    RET                             ;[2B6F] 

    LD    (IX+$00),A                ;[2B70] Load A to where IX points. Increment IX.
    INC   IX                        ;[2B73] 
    RET                             ;[2B75] 

BASIC_FN_STR_STRING:
    PUSH  IX                        ;[2B76] STR$
    INC   DE                        ;[2B78] 
    CALL  $33AD                     ;[2B79] 
    POP   IX                        ;[2B7C] 
    PUSH  DE                        ;[2B7E] 
    LD    HL,(SYSVAR_PRINTD)        ;[2B7F] 
    PUSH  HL                        ;[2B82] 
    LD    HL,$2B70                  ;[2B83] 
    LD    (SYSVAR_PRINTD),HL        ;[2B86] 
    CALL  LYNX_PN                   ;[2B89] 
    POP   HL                        ;[2B8C] 
    LD    (SYSVAR_PRINTD),HL        ;[2B8D] 
    POP   DE                        ;[2B90] 
    JR    $2BC2                     ;[2B91] 

BASIC_FN_KEY_STRING:
    CALL  LYNX_KEY                  ;[2B93] KEY$
    OR    A                         ;[2B96] 
    JR    Z,$2BC3                   ;[2B97] 

SUB_GET_STRING:
    LD    (IX+$00),A                ;[2B99] Part of GET$
    INC   IX                        ;[2B9C] 
    JR    $2BC3                     ;[2B9E] 

BASIC_FN_GET_STRING:
    CALL  LYNX_KEY                  ;[2BA0] GET$
    OR    A                         ;[2BA3] 
    JR    Z,BASIC_FN_GET_STRING     ;[2BA4] 
    JR    SUB_GET_STRING            ;[2BA6] 

BASIC_FN_UPC_STRING:
    CALL  SYSVAR_VRPTS              ;[2BA8] UPC$
    LD    A,(HL)                    ;[2BAB] 
    CP    $0D                       ;[2BAC] 
    JR    Z,$2BC2                   ;[2BAE] 
    CP    $61                       ;[2BB0] 
    JR    C,$2BBA                   ;[2BB2] 
    CP    $7B                       ;[2BB4] 
    JR    NC,$2BBA                  ;[2BB6] 
    RES   5,A                       ;[2BB8] 
    LD    (IX+$00),A                ;[2BBA] 
    INC   IX                        ;[2BBD] 
    INC   HL                        ;[2BBF] 
    JR    $2BAB                     ;[2BC0] 
    INC   DE                        ;[2BC2] 
    PUSH  IX                        ;[2BC3] 
    POP   HL                        ;[2BC5] 
    LD    (HL),$0D                  ;[2BC6] 
    PUSH  HL                        ;[2BC8] 
    LD    BC,SYSVAR_STRBUF          ;[2BC9] 
    OR    A                         ;[2BCC] 
    SBC   HL,BC                     ;[2BCD] 
    INC   H                         ;[2BCF] 
    DEC   H                         ;[2BD0] 
    CALL  NZ,$3B47                  ;[2BD1] 
    POP   IX                        ;[2BD4] 
    LD    A,(DE)                    ;[2BD6] 
    CP    $2B                       ;[2BD7] 
    RET   NZ                        ;[2BD9] 
    INC   DE                        ;[2BDA] 
    JR    $2BE5                     ;[2BDB] 
    LD    IY,SYSVAR_CSTACK          ;[2BDD] String execution routine.
    LD    IX,SYSVAR_STRBUF          ;[2BE1] 
    LD    A,(DE)                    ;[2BE5] 
    CP    $22                       ;[2BE6] 
    JR    Z,$2C15                   ;[2BE8] 
    CALL  $21EA                     ;[2BEA] 
    JR    Z,$2C20                   ;[2BED] 
    LD    A,(DE)                    ;[2BEF] 
    INC   DE                        ;[2BF0] 
    CP    $E3                       ;[2BF1] 
    JR    Z,BASIC_FN_UPC_STRING     ;[2BF3] 
    CP    $E6                       ;[2BF5] 
    JP    Z,BASIC_FN_STR_STRING     ;[2BF7] 
    CP    $E5                       ;[2BFA] 
    JR    Z,BASIC_FN_GET_STRING     ;[2BFC] 
    CP    $E4                       ;[2BFE] 
    JR    Z,BASIC_FN_KEY_STRING     ;[2C00] 
    CP    $DF                       ;[2C02] 
    JR    Z,BASIC_FN_CHR_STRING     ;[2C04] 
    CP    $E0                       ;[2C06] 
    JR    Z,BASIC_FN_LEFT_STRING    ;[2C08] 
    CP    $E1                       ;[2C0A] 
    JR    Z,BASIC_FN_RIGHT_STRING   ;[2C0C] 
    CP    $E2                       ;[2C0E] 
    JR    Z,BASIC_FN_MID_STRING     ;[2C10] 
    CALL  $3B38                     ;[2C12] 
    INC   DE                        ;[2C15] 
    LD    B,$00                     ;[2C16] 
    EX    DE,HL                     ;[2C18] 
    CALL  $2C7F                     ;[2C19] 
    EX    DE,HL                     ;[2C1C] 
    INC   DE                        ;[2C1D] 
    JR    $2BC3                     ;[2C1E] 
    CALL  SYSVAR_VRPTS              ;[2C20] 
    CALL  $2C7F                     ;[2C23] 
    JR    $2BC3                     ;[2C26] 

BASIC_FN_CHR_STRING:
    CALL  $2B61                     ;[2C28] CHR$
    LD    (IX+$00),L                ;[2C2B] 
    INC   IX                        ;[2C2E] 
    JR    $2BC2                     ;[2C30] 

BASIC_FN_LEFT_STRING:
    CALL  SYSVAR_VRPTS              ;[2C32] LEFT$
    PUSH  HL                        ;[2C35] 
    INC   DE                        ;[2C36] 
    CALL  $2B61                     ;[2C37] 
    LD    B,L                       ;[2C3A] 
    POP   HL                        ;[2C3B] 
    CALL  $3FE5                     ;[2C3C] 
    JR    $2BC2                     ;[2C3F] 

BASIC_FN_MID_STRING:
    CALL  SYSVAR_VRPTS              ;[2C41] MID$
    INC   DE                        ;[2C44] 
    PUSH  HL                        ;[2C45] 
    CALL  $2B61                     ;[2C46] 
    INC   DE                        ;[2C49] 
    PUSH  HL                        ;[2C4A] 
    CALL  $2B61                     ;[2C4B] 
    LD    C,L                       ;[2C4E] 
    POP   HL                        ;[2C4F] 
    LD    B,L                       ;[2C50] 
    POP   HL                        ;[2C51] 
    LD    A,(HL)                    ;[2C52] 
    CP    $0D                       ;[2C53] 
    JP    Z,$2BC2                   ;[2C55] 
    INC   HL                        ;[2C58] 
    DJNZ  $2C52                     ;[2C59] 
    DEC   HL                        ;[2C5B] 
    LD    B,C                       ;[2C5C] 
    CALL  $3FE5                     ;[2C5D] 
    JP    $2BC2                     ;[2C60] 

BASIC_FN_RIGHT_STRING:
    CALL  SYSVAR_VRPTS              ;[2C63] RIGHT$
    INC   DE                        ;[2C66] 
    PUSH  HL                        ;[2C67] 
    CALL  $2B61                     ;[2C68] 
    LD    C,L                       ;[2C6B] 
    POP   HL                        ;[2C6C] 
    PUSH  HL                        ;[2C6D] 
    LD    B,$00                     ;[2C6E] 
    INC   B                         ;[2C70] 
    LD    A,(HL)                    ;[2C71] 
    INC   HL                        ;[2C72] 
    CP    $0D                       ;[2C73] 
    JR    NZ,$2C70                  ;[2C75] 
    LD    A,B                       ;[2C77] 
    SUB   C                         ;[2C78] 
    CALL  C,$3B47                   ;[2C79] 
    LD    B,A                       ;[2C7C] 
    JR    $2C51                     ;[2C7D] 
    LD    A,(HL)                    ;[2C7F] 
    CP    $22                       ;[2C80] 
    RET   Z                         ;[2C82] 
    CP    $0D                       ;[2C83] 
    RET   Z                         ;[2C85] 
    LD    (IX+$00),A                ;[2C86] 
    INC   IX                        ;[2C89] 
    INC   HL                        ;[2C8B] 
    DJNZ  $2C7F                     ;[2C8C] 
    RET                             ;[2C8E] 

    CALL  $21F4                     ;[2C8F] 
    RST   $10                       ;[2C92] 
    CP    $29                       ;[2C93] 
    LD    (HL),A                    ;[2C95] 
    INC   HL                        ;[2C96] 
    INC   DE                        ;[2C97] 
    CALL  NZ,$3B44                  ;[2C98] 
    JR    $2CAD                     ;[2C9B] 
    CALL  $21EA                     ;[2C9D] 
    JR    Z,$2D03                   ;[2CA0] 
    CALL  $2D08                     ;[2CA2] 
    LD    (HL),A                    ;[2CA5] 
    INC   HL                        ;[2CA6] 
    JR    NC,$2CB6                  ;[2CA7] 
    DEC   HL                        ;[2CA9] 
    CALL  $25F1                     ;[2CAA] 
    RST   $10                       ;[2CAD] 
    CP    $2B                       ;[2CAE] 
    RET   NZ                        ;[2CB0] 
    INC   DE                        ;[2CB1] 
    LD    (HL),A                    ;[2CB2] 
    INC   HL                        ;[2CB3] 
    JR    $2C9D                     ;[2CB4] 
    CP    $DF                       ;[2CB6] 
    JR    Z,$2CE8                   ;[2CB8] 
    CP    $E6                       ;[2CBA] 
    JR    Z,$2CE8                   ;[2CBC] 
    CP    $E4                       ;[2CBE] 
    JR    Z,$2CAD                   ;[2CC0] 
    CP    $E5                       ;[2CC2] 
    JR    Z,$2CAD                   ;[2CC4] 
    CP    $E3                       ;[2CC6] 
    JR    Z,$2C8F                   ;[2CC8] 
    CP    $E2                       ;[2CCA] 
    JR    Z,$2CEE                   ;[2CCC] 
    CP    $E0                       ;[2CCE] 
    JR    Z,$2CD7                   ;[2CD0] 
    CP    $E1                       ;[2CD2] 
    CALL  NZ,$3B38                  ;[2CD4] 
    CALL  $21EA                     ;[2CD7] 
    CALL  NZ,$3B3B                  ;[2CDA] 
    CALL  $21F4                     ;[2CDD] 
    RST   $10                       ;[2CE0] 
    INC   DE                        ;[2CE1] 
    CP    $2C                       ;[2CE2] 
    JR    NZ,$2CDA                  ;[2CE4] 
    LD    (HL),A                    ;[2CE6] 
    INC   HL                        ;[2CE7] 
    DEC   DE                        ;[2CE8] 
    CALL  $2731                     ;[2CE9] 
    JR    $2CAE                     ;[2CEC] 
    CALL  $21EA                     ;[2CEE] 
    JR    NZ,$2CDA                  ;[2CF1] 
    CALL  $21F4                     ;[2CF3] 
    RST   $10                       ;[2CF6] 
    INC   DE                        ;[2CF7] 
    CP    $2C                       ;[2CF8] 
    JR    NZ,$2CDA                  ;[2CFA] 
    LD    (HL),A                    ;[2CFC] 
    INC   HL                        ;[2CFD] 
    CALL  LYNX_RP                   ;[2CFE] 
    JR    $2CE2                     ;[2D01] 
    CALL  $21F4                     ;[2D03] 
    JR    $2CAD                     ;[2D06] 
    PUSH  HL                        ;[2D08] 
    CALL  SUB_BASIC_WORD            ;[2D09] 
    POP   HL                        ;[2D0C] 
    RET                             ;[2D0D] 

BASIC_FN_VAL:
    LD    DE,SYSVAR_STRBUF          ;[2D0E] VAL(. Note left bracket is part of the word.
    JP    LYNX_RDN                  ;[2D11] 

BASIC_FN_LEN:
    LD    HL,SYSVAR_STRBUF          ;[2D14] LEN(.
    LD    B,$FF                     ;[2D17] 
    INC   B                         ;[2D19] 
    LD    A,(HL)                    ;[2D1A] 
    INC   HL                        ;[2D1B] 
    CP    $0D                       ;[2D1C] 
    JR    NZ,$2D19                  ;[2D1E] 
    LD    L,B                       ;[2D20] 
    LD    H,$00                     ;[2D21] 
    JP    LYNX_INTFP                ;[2D23] 

BASIC_FN_ASC:
    LD    HL,SYSVAR_STRBUF          ;[2D26] ASC(.
    LD    L,(HL)                    ;[2D29] 
    JR    $2D21                     ;[2D2A] 
    CALL  $2D67                     ;[2D2C] 
    PUSH  IX                        ;[2D2F] 
    DEC   HL                        ;[2D31] 
    PUSH  HL                        ;[2D32] 
    INC   B                         ;[2D33] 
    PUSH  BC                        ;[2D34] 
    INC   DE                        ;[2D35] 
    CALL  $2B61                     ;[2D36] 
    INC   DE                        ;[2D39] 
    POP   BC                        ;[2D3A] 
    PUSH  DE                        ;[2D3B] 
    PUSH  HL                        ;[2D3C] 
    LD    HL,(SYSVAR_STORE)         ;[2D3D] 
    INC   HL                        ;[2D40] 
    LD    A,(HL)                    ;[2D41] 
    INC   HL                        ;[2D42] 
    LD    H,(HL)                    ;[2D43] 
    LD    L,A                       ;[2D44] 
    EX    DE,HL                     ;[2D45] 
    POP   HL                        ;[2D46] 
    EX    DE,HL                     ;[2D47] 
    CALL  LYNX_CHLDE                ;[2D48] 
    EX    DE,HL                     ;[2D4B] 
    CALL  C,$3B26                   ;[2D4C] 
    LD    E,L                       ;[2D4F] 
    LD    D,H                       ;[2D50] 
    ADD   HL,DE                     ;[2D51] 
    DJNZ  $2D51                     ;[2D52] 
    POP   DE                        ;[2D54] 
    POP   BC                        ;[2D55] 
    ADD   HL,BC                     ;[2D56] 
    LD    B,(HL)                    ;[2D57] 
    INC   HL                        ;[2D58] 
    POP   IX                        ;[2D59] 
    RET                             ;[2D5B] 

    LD    A,(DE)                    ;[2D5C] 
    INC   DE                        ;[2D5D] 
    INC   DE                        ;[2D5E] 
    LD    C,A                       ;[2D5F] 
    LD    A,(DE)                    ;[2D60] 
    CP    $28                       ;[2D61] 
    LD    A,C                       ;[2D63] 
    JP    Z,$2D2C                   ;[2D64] 
    SUB   $41                       ;[2D67] 
    RLCA                            ;[2D69] 
    RLCA                            ;[2D6A] 
    LD    HL,(SYSVAR_STBL)          ;[2D6B] 
    LD    C,A                       ;[2D6E] 
    LD    B,$00                     ;[2D6F] 
    ADD   HL,BC                     ;[2D71] 
    EX    AF,AF'                    ;[2D72] 
    LD    A,(HL)                    ;[2D73] 
    INC   HL                        ;[2D74] 
    OR    (HL)                      ;[2D75] 
    LD    A,$10                     ;[2D76] 
    JR    Z,$2D84                   ;[2D78] 
    LD    (SYSVAR_STORE),HL         ;[2D7A] 
    LD    A,(HL)                    ;[2D7D] 
    DEC   HL                        ;[2D7E] 
    LD    L,(HL)                    ;[2D7F] 
    LD    H,A                       ;[2D80] 
    LD    B,(HL)                    ;[2D81] 
    INC   HL                        ;[2D82] 
    RET                             ;[2D83] 

    LD    BC,$2D6B                  ;[2D84] 
    PUSH  BC                        ;[2D87] 
    LD    BC,(SYSVAR_TOV)           ;[2D88] 
    LD    (HL),B                    ;[2D8C] 
    DEC   HL                        ;[2D8D] 
    LD    (HL),C                    ;[2D8E] 
    LD    (BC),A                    ;[2D8F] 
    LD    L,A                       ;[2D90] 
    LD    H,$00                     ;[2D91] 
    INC   HL                        ;[2D93] 
    INC   BC                        ;[2D94] 
    LD    A,$0D                     ;[2D95] 
    LD    (BC),A                    ;[2D97] 
    ADD   HL,BC                     ;[2D98] 
    LD    (SYSVAR_TOV),HL           ;[2D99] 
    INC   H                         ;[2D9C] 
    SBC   HL,SP                     ;[2D9D] 
    CALL  NC,$3B4D                  ;[2D9F] 
    EX    AF,AF'                    ;[2DA2] 
    RET                             ;[2DA3] 

    PUSH  BC                        ;[2DA4] 
    PUSH  HL                        ;[2DA5] 
    INC   DE                        ;[2DA6] 
    RST   $18                       ;[2DA7] 
    INC   DE                        ;[2DA8] 
    LD    A,L                       ;[2DA9] 
    OR    H                         ;[2DAA] 
    POP   IX                        ;[2DAB] 
    LD    (IX+$01),L                ;[2DAD] 
    LD    (IX+$02),H                ;[2DB0] 
    POP   BC                        ;[2DB3] 
    JR    Z,$2DC9                   ;[2DB4] 
    LD    A,B                       ;[2DB6] 
    PUSH  AF                        ;[2DB7] 
    PUSH  HL                        ;[2DB8] 
    LD    BC,(SYSVAR_TOV)           ;[2DB9] 
    CALL  $2D8F                     ;[2DBD] 
    POP   HL                        ;[2DC0] 
    POP   AF                        ;[2DC1] 
    LD    C,A                       ;[2DC2] 
    DEC   HL                        ;[2DC3] 
    LD    A,H                       ;[2DC4] 
    OR    L                         ;[2DC5] 
    LD    A,C                       ;[2DC6] 
    JR    NZ,$2DB7                  ;[2DC7] 
    LD    A,(DE)                    ;[2DC9] 
    RET                             ;[2DCA] 

BASIC_COM_DIM:
    CALL  $21EA                     ;[2DCB] DIM.
    JR    NZ,$2E0A                  ;[2DCE] 
    LD    A,(DE)                    ;[2DD0] 
    INC   DE                        ;[2DD1] 
    INC   DE                        ;[2DD2] 
    INC   DE                        ;[2DD3] 
    PUSH  AF                        ;[2DD4] 
    RST   $18                       ;[2DD5] 
    INC   DE                        ;[2DD6] 
    INC   H                         ;[2DD7] 
    DEC   H                         ;[2DD8] 
    CALL  NZ,$3B29                  ;[2DD9] 
    BIT   7,L                       ;[2DDC] 
    CALL  NZ,$3B29                  ;[2DDE] 
    INC   L                         ;[2DE1] 
    DEC   L                         ;[2DE2] 
    CALL  Z,$3B29                   ;[2DE3] 
    LD    B,L                       ;[2DE6] 
    POP   AF                        ;[2DE7] 
    PUSH  DE                        ;[2DE8] 
    SUB   $41                       ;[2DE9] 
    RLCA                            ;[2DEB] 
    RLCA                            ;[2DEC] 
    LD    E,A                       ;[2DED] 
    LD    D,$00                     ;[2DEE] 
    LD    HL,(SYSVAR_STBL)          ;[2DF0] 
    ADD   HL,DE                     ;[2DF3] 
    INC   HL                        ;[2DF4] 
    PUSH  HL                        ;[2DF5] 
    LD    A,B                       ;[2DF6] 
    PUSH  BC                        ;[2DF7] 
    CALL  SUB_DIM                   ;[2DF8] 
    POP   BC                        ;[2DFB] 
    POP   HL                        ;[2DFC] 
    POP   DE                        ;[2DFD] 
    LD    A,(DE)                    ;[2DFE] 
    CP    $28                       ;[2DFF] 
    CALL  Z,$2DA4                   ;[2E01] 
    CP    $2C                       ;[2E04] 
    INC   DE                        ;[2E06] 
    JR    Z,BASIC_COM_DIM           ;[2E07] 
    RET                             ;[2E09] 

    CALL  $1E0F                     ;[2E0A] 
    LD    A,(IX+$00)                ;[2E0D] 
    OR    (IX+$01)                  ;[2E10] 
    CALL  NZ,$3B2F                  ;[2E13] 
    LD    A,$F0                     ;[2E16] 
    AND   H                         ;[2E18] 
    CALL  NZ,$3B3E                  ;[2E19] 
    PUSH  DE                        ;[2E1C] 
    LD    DE,(SYSVAR_TOV)           ;[2E1D] 
    LD    (IX+$02),L                ;[2E21] 
    LD    (IX+$03),H                ;[2E24] 
    INC   HL                        ;[2E27] 
    PUSH  HL                        ;[2E28] 
    LD    C,L                       ;[2E29] 
    LD    B,H                       ;[2E2A] 
    ADD   HL,HL                     ;[2E2B] 
    ADD   HL,HL                     ;[2E2C] 
    ADD   HL,BC                     ;[2E2D] 
    ADD   HL,DE                     ;[2E2E] 
    LD    A,$C0                     ;[2E2F] 
    AND   H                         ;[2E31] 
    CALL  Z,$3B3E                   ;[2E32] 
    EX    DE,HL                     ;[2E35] 
    LD    HL,START                  ;[2E36] 
    ADD   HL,SP                     ;[2E39] 
    DEC   H                         ;[2E3A] 
    SBC   HL,DE                     ;[2E3B] 
    CALL  C,$3B3E                   ;[2E3D] 
    LD    BC,(SYSVAR_TOV)           ;[2E40] 
    LD    (IX+$00),C                ;[2E44] 
    LD    (IX+$01),B                ;[2E47] 
    LD    (SYSVAR_TOV),DE           ;[2E4A] 
    LD    L,C                       ;[2E4E] 
    LD    H,B                       ;[2E4F] 
    POP   BC                        ;[2E50] 
    LD    DE,$0005                  ;[2E51] 
    INC   HL                        ;[2E54] 
    LD    (HL),$FF                  ;[2E55] 
    ADD   HL,DE                     ;[2E57] 
    DEC   BC                        ;[2E58] 
    LD    A,B                       ;[2E59] 
    OR    C                         ;[2E5A] 
    JR    NZ,$2E55                  ;[2E5B] 
    POP   DE                        ;[2E5D] 
    LD    A,(DE)                    ;[2E5E] 
    CP    $2C                       ;[2E5F] 
    INC   DE                        ;[2E61] 
    JP    Z,BASIC_COM_DIM           ;[2E62] 
    RET                             ;[2E65] 

VALIDATE_DIM:
    CALL  $21EA                     ;[2E66] Validation for DIM.
    JR    NZ,$2E7C                  ;[2E69] 
    CALL  $21F4                     ;[2E6B] 
    CALL  $2206                     ;[2E6E] 
    RST   $10                       ;[2E71] 
    LD    (HL),A                    ;[2E72] 
    CP    $0D                       ;[2E73] 
    RET   Z                         ;[2E75] 
    INC   HL                        ;[2E76] 
    RST   $20                       ;[2E77] 
    INC   L                         ;[2E78] 
    INC   DE                        ;[2E79] 
    JR    VALIDATE_DIM              ;[2E7A] 
    CALL  $2721                     ;[2E7C] 
    DEC   HL                        ;[2E7F] 
    LD    A,$29                     ;[2E80] 
    CP    (HL)                      ;[2E82] 
    CALL  NZ,$3B3B                  ;[2E83] 
    INC   HL                        ;[2E86] 
    LD    A,(DE)                    ;[2E87] 
    LD    (HL),A                    ;[2E88] 
    CP    $0D                       ;[2E89] 
    RET   Z                         ;[2E8B] 
    RST   $20                       ;[2E8C] 
    INC   L                         ;[2E8D] 
    INC   HL                        ;[2E8E] 
    INC   DE                        ;[2E8F] 
    RST   $10                       ;[2E90] 
    JR    VALIDATE_DIM              ;[2E91] 
    LD    A,(SYSVAR_ZFLAG)          ;[2E93] Numeric output routine.
    BIT   0,A                       ;[2E96] 
    RET   Z                         ;[2E98] 
    LD    A,(SYSVAR_WRA1)           ;[2E99] 
    AND   $7F                       ;[2E9C] 
    ADD   A,$81                     ;[2E9E] 
    RET   Z                         ;[2EA0] 
    LD    HL,$62E9                  ;[2EA1] 
    LD    A,(HL)                    ;[2EA4] 
    CP    $50                       ;[2EA5] 
    LD    (HL),$00                  ;[2EA7] 
    RET   C                         ;[2EA9] 
    SCF                             ;[2EAA] 
    LD    B,$03                     ;[2EAB] 
    PUSH  DE                        ;[2EAD] 
    DEC   HL                        ;[2EAE] 
    LD    A,$00                     ;[2EAF] 
    ADC   A,(HL)                    ;[2EB1] 
    DAA                             ;[2EB2] 
    LD    (HL),A                    ;[2EB3] 
    DJNZ  $2EAE                     ;[2EB4] 
    CALL  $359A                     ;[2EB6] 
    POP   DE                        ;[2EB9] 
    RET                             ;[2EBA] 

VALIDATE_SWAP:
    CALL  $2759                     ;[2EBB] Validate SWAP and multiply.
    JP    LYNX_MLT                  ;[2EBE] 
    PUSH  IY                        ;[2EC1] Multiply and add routine.
    CALL  $2EFF                     ;[2EC3] 
    POP   IY                        ;[2EC6] 
    LD    B,(IX+$00)                ;[2EC8] 
    INC   IX                        ;[2ECB] 
    LD    HL,SYSVAR_WRA1            ;[2ECD] 
    PUSH  BC                        ;[2ED0] 
    CALL  $2F20                     ;[2ED1] 
    POP   BC                        ;[2ED4] 
    PUSH  BC                        ;[2ED5] 
    PUSH  IY                        ;[2ED6] 
    CALL  $2F0E                     ;[2ED8] 
    POP   IY                        ;[2EDB] 
    CALL  LYNX_MLT                  ;[2EDD] 
    CALL  $2F1D                     ;[2EE0] 
    CALL  LYNX_AD                   ;[2EE3] 
    POP   BC                        ;[2EE6] 
    DJNZ  $2ED5                     ;[2EE7] 
    RET                             ;[2EE9] 

    CALL  $2EF0                     ;[2EEA] (IY) to WRA1.
    CALL  LYNX_SWAP                 ;[2EED] 
    LD    HL,SYSVAR_SYNL            ;[2EF0] 
    LD    B,$05                     ;[2EF3] 
    DEC   IY                        ;[2EF5] 
    DEC   HL                        ;[2EF7] 
    LD    A,(IY+$00)                ;[2EF8] 
    LD    (HL),A                    ;[2EFB] 
    DJNZ  $2EF5                     ;[2EFC] 
    RET                             ;[2EFE] 

    LD    HL,SYSVAR_WRA1            ;[2EFF] WRA1 to (IY).
    LD    B,$05                     ;[2F02] 
    LD    A,(HL)                    ;[2F04] 
    LD    (IY+$00),A                ;[2F05] 
    INC   IY                        ;[2F08] 
    INC   HL                        ;[2F0A] 
    DJNZ  $2F04                     ;[2F0B] 
    RET                             ;[2F0D] 

    LD    B,$05                     ;[2F0E] (IY) to WRA2
    LD    HL,SYSVAR_WRA2            ;[2F10] 
    LD    A,(IY+$00)                ;[2F13] 
    LD    (HL),A                    ;[2F16] 
    INC   IY                        ;[2F17] 
    INC   HL                        ;[2F19] 
    DJNZ  $2F13                     ;[2F1A] 
    RET                             ;[2F1C] 

    LD    HL,SYSVAR_WRA2            ;[2F1D] (IX) to WRA2
    LD    B,$05                     ;[2F20] 
    LD    A,(IX+$00)                ;[2F22] 
    LD    (HL),A                    ;[2F25] 
    INC   IX                        ;[2F26] 
    INC   HL                        ;[2F28] 
    DJNZ  $2F22                     ;[2F29] 
    RET                             ;[2F2B] 

    POP   IX                        ;[2F2C] Push WRA1 and jump to (IX).
    LD    A,(SYSVAR_WRA1)           ;[2F2E] 
    PUSH  AF                        ;[2F31] 
    LD    HL,($62E6)                ;[2F32] 
    PUSH  HL                        ;[2F35] 
    LD    HL,($62E8)                ;[2F36] 
    PUSH  HL                        ;[2F39] 
    JP    (IX)                      ;[2F3A] Pop WRA2 and jump to (IX).
    POP   IX                        ;[2F3C] 
    POP   HL                        ;[2F3E] 
    LD    ($62E3),HL                ;[2F3F] 
    POP   HL                        ;[2F42] 
    LD    ($62E1),HL                ;[2F43] 
    POP   AF                        ;[2F46] 
    LD    (SYSVAR_WRA2),A           ;[2F47] 
    JP    (IX)                      ;[2F4A] 

BASIC_FN_LN:
    CALL  BASIC_FN_LOG              ;[2F4C] LN.
    LD    HL,$35F1                  ;[2F4F] 
    CALL  LYNX_LNUM2                ;[2F52] 
    JP    LYNX_DIV                  ;[2F55] 

BASIC_FN_ARCSIN:
    LD    A,(SYSVAR_WRA1)           ;[2F58] ARCSIN.
    CP    $80                       ;[2F5B] 
    JP    Z,LYNX_LZERO              ;[2F5D] 
    PUSH  AF                        ;[2F60] 
    JP    $3FEB                     ;[2F61] 
    CALL  LYNX_SBT                  ;[2F64] 
    CALL  $2F3C                     ;[2F67] 
    CALL  LYNX_DIV                  ;[2F6A] 
    CALL  BASIC_FN_SQR              ;[2F6D] 
    CALL  SUB_ARCTAN                ;[2F70] 
    CALL  $2759                     ;[2F73] 
    CALL  LYNX_AD                   ;[2F76] 
    POP   AF                        ;[2F79] 
    RLA                             ;[2F7A] 
    RET   C                         ;[2F7B] 
    CALL  $2759                     ;[2F7C] 
    CALL  BASIC_FN_PI               ;[2F7F] 
    JP    LYNX_SBT                  ;[2F82] 

BASIC_FN_ARCCOS:
    LD    HL,SYSVAR_WRA1            ;[2F85] ARCCOS.
    LD    A,(HL)                    ;[2F88] 
    PUSH  AF                        ;[2F89] 
    SET   7,(HL)                    ;[2F8A] 
    CALL  $2759                     ;[2F8C] 
    CALL  $2F2C                     ;[2F8F] 
    CALL  LYNX_LONE                 ;[2F92] 
    CALL  LYNX_AD                   ;[2F95] 
    CALL  $2F3C                     ;[2F98] 
    CALL  $2F2C                     ;[2F9B] 
    CALL  LYNX_LONE                 ;[2F9E] 
    JR    $2F64                     ;[2FA1] 
    NOP                             ;[2FA3] 
    NOP                             ;[2FA4] 

BASIC_FN_ARCTAN:
    LD    A,(SYSVAR_WRA1)           ;[2FA5] ARCTAN.
    PUSH  AF                        ;[2FA8] 
    SET   7,A                       ;[2FA9] 
    LD    (SYSVAR_WRA1),A           ;[2FAB] 
    CP    $C0                       ;[2FAE] 
    JR    NC,$2FBF                  ;[2FB0] 
    CALL  SUB_ARCTAN                ;[2FB2] 
    POP   AF                        ;[2FB5] 
    BIT   7,A                       ;[2FB6] 
    RET   NZ                        ;[2FB8] 
    LD    HL,SYSVAR_WRA1            ;[2FB9] 
    RES   7,(HL)                    ;[2FBC] 
    RET                             ;[2FBE] 

    CALL  $2759                     ;[2FBF] 
    CALL  LYNX_LONE                 ;[2FC2] 
    CALL  LYNX_DIV                  ;[2FC5] 
    CALL  SUB_ARCTAN                ;[2FC8] 
    CALL  $2759                     ;[2FCB] 
    LD    HL,$35E2                  ;[2FCE] 
    CALL  LYNX_LNUM1                ;[2FD1] 
    CALL  LYNX_SBT                  ;[2FD4] 
    JR    $2FB5                     ;[2FD7] 

SUB_ARCTAN:
    CALL  $2F2C                     ;[2FD9] ARCTAN subroutine
    CALL  VALIDATE_SWAP             ;[2FDC] 
    LD    IX,DATA_ARCTAN            ;[2FDF] 
    CALL  $2EC1                     ;[2FE3] 
    CALL  $2F3C                     ;[2FE6] 
    JP    LYNX_MLT                  ;[2FE9] 

DATA_ARCTAN:
    defb 0x06,0xBD,0x68,0x12,0x41,0x10,0x3E,0x33        ;[2FEC]
    defb 0x60,0x62,0x69,0xBE,0x79,0x62,0x63,0x18        ;[2FF4]
    defb 0x3F,0x13,0x23,0x35,0x10,0xBF,0x19,0x80        ;[2FFC]
    defb 0x78,0x69,0x3F,0x33,0x31,0x73,0x76,0xBF        ;[3004]
    defb 0x99,0x99,0x96,0x11                            ;[300C]


BASIC_FN_FACT:
    CALL  BASIC_FN_INT              ;[3010] FACT.
    INC   (HL)                      ;[3012] 
    LD    A,(SYSVAR_WRA1)           ;[3013] 
    CP    $80                       ;[3016] 
    JP    Z,LYNX_LONE               ;[3018] 
    CP    $C2                       ;[301B] 
    CALL  NC,$3B3E                  ;[301D] 
    BIT   7,A                       ;[3020] 
    CALL  Z,$3B35                   ;[3022] 
    CALL  $2F2C                     ;[3025] 
    LD    HL,DATA_FLOATS            ;[3028] 
    CALL  LYNX_LNUM2                ;[302B] 
    CALL  LYNX_SBT                  ;[302E] 
    LD    A,(SYSVAR_WRA1)           ;[3031] 
    CP    $80                       ;[3034] 
    JR    Z,$304C                   ;[3036] 
    CALL  $2F3C                     ;[3038] 
    CALL  $2F2C                     ;[303B] 
    CALL  LYNX_MLT                  ;[303E] 
    CALL  $2F3C                     ;[3041] 
    CALL  $2F2C                     ;[3044] 
    CALL  LYNX_SWAP                 ;[3047] 
    JR    $3028                     ;[304A] 
    CALL  $2F3C                     ;[304C] 
    JP    LYNX_SWAP                 ;[304F] 

BASIC_FN_SQR:
    PUSH  IY                        ;[3052] SQR.
    CALL  $2EFF                     ;[3054] 
    POP   IY                        ;[3057] 
    LD    A,(SYSVAR_WRA1)           ;[3059] 
    CP    $80                       ;[305C] 
    RET   Z                         ;[305E] 
    BIT   7,A                       ;[305F] 
    CALL  Z,$3B35                   ;[3061] 
    RES   7,A                       ;[3064] 
    RRCA                            ;[3066] 
    ADD   A,$20                     ;[3067] 
    SET   7,A                       ;[3069] 
    LD    (SYSVAR_WRA1),A           ;[306B] 
    LD    B,$05                     ;[306E] 
    PUSH  BC                        ;[3070] 
    CALL  $2F2C                     ;[3071] 
    PUSH  IY                        ;[3074] 
    CALL  $2F0E                     ;[3076] 
    POP   IY                        ;[3079] 
    CALL  LYNX_SWAP                 ;[307B] 
    CALL  LYNX_DIV                  ;[307E] 
    CALL  $2F3C                     ;[3081] 
    CALL  LYNX_AD                   ;[3084] 
    LD    HL,$35FB                  ;[3087] 
    CALL  LYNX_LNUM2                ;[308A] 
    CALL  LYNX_MLT                  ;[308D] 
    POP   BC                        ;[3090] 
    DJNZ  $3070                     ;[3091] 
    RET                             ;[3093] 

SUB_POWER1:
    CALL  $2EF0                     ;[3094] Part of power routine
    JP    LYNX_LONE                 ;[3097] 

BASIC_FN_POWER:
    CALL  $2EF0                     ;[309A] ** Power routine.
    LD    A,(SYSVAR_WRA1)           ;[309D] 
    CP    $80                       ;[30A0] 
    JR    Z,SUB_POWER1              ;[30A2] 
    CP    $C0                       ;[30A4] 
    JR    NZ,$30D2                  ;[30A6] 
    CALL  $3656                     ;[30A8] 
    EX    AF,AF'                    ;[30AB] 
    LD    B,$04                     ;[30AC] 
    LD    HL,$62E6                  ;[30AE] 
    XOR   A                         ;[30B1] 
    CP    (HL)                      ;[30B2] 
    JR    NZ,SUB_POWER2             ;[30B3] 
    INC   HL                        ;[30B5] 
    DJNZ  $30B2                     ;[30B6] 
    CALL  $2EF0                     ;[30B8] 
    EX    AF,AF'                    ;[30BB] 
    DEC   A                         ;[30BC] 
    RET   Z                         ;[30BD] 
    LD    B,A                       ;[30BE] 
    PUSH  BC                        ;[30BF] 
    PUSH  IY                        ;[30C0] 
    CALL  $2F0E                     ;[30C2] 
    POP   IY                        ;[30C5] 
    CALL  LYNX_MLT                  ;[30C7] 
    POP   BC                        ;[30CA] 
    DJNZ  $30BF                     ;[30CB] 
    RET                             ;[30CD] 

SUB_POWER2:
    EX    AF,AF'                    ;[30CE] Part of power routine
    CALL  $3643                     ;[30CF] 
    CALL  $2F2C                     ;[30D2] 
    CALL  $2EF0                     ;[30D5] 
    CALL  BASIC_FN_LOG              ;[30D8] 
    CALL  $2F3C                     ;[30DB] 
    CALL  LYNX_MLT                  ;[30DE] 
    JP    BASIC_FN_ANTILOG          ;[30E1] 

BASIC_FN_LOG:
    LD    HL,SYSVAR_WRA1            ;[30E4] LOG
    LD    A,(HL)                    ;[30E7] 
    CP    $81                       ;[30E8] 
    CALL  C,$3B35                   ;[30EA] 
    LD    (HL),$C0                  ;[30ED] 
    BIT   6,A                       ;[30EF] 
    PUSH  AF                        ;[30F1] 
    JR    NZ,$30F6                  ;[30F2] 
    NEG                             ;[30F4] 
    AND   $3F                       ;[30F6] 
    LD    B,$FF                     ;[30F8] 
    LD    C,$0A                     ;[30FA] 
    INC   B                         ;[30FC] 
    SUB   C                         ;[30FD] 
    JR    NC,$30FC                  ;[30FE] 
    ADD   A,C                       ;[3100] 
    SLA   B                         ;[3101] 
    SLA   B                         ;[3103] 
    SLA   B                         ;[3105] 
    SLA   B                         ;[3107] 
    ADD   A,B                       ;[3109] 
    PUSH  AF                        ;[310A] 
    CALL  $2F2C                     ;[310B] 
    LD    HL,$35F6                  ;[310E] 
    CALL  LYNX_LNUM2                ;[3111] 
    CALL  LYNX_AD                   ;[3114] 
    CALL  $2F3C                     ;[3117] 
    CALL  $2F2C                     ;[311A] 
    LD    HL,$35F6                  ;[311D] 
    CALL  LYNX_LNUM1                ;[3120] 
    CALL  LYNX_SWAP                 ;[3123] 
    CALL  LYNX_SBT                  ;[3126] 
    CALL  $2F3C                     ;[3129] 
    CALL  LYNX_DIV                  ;[312C] 
    CALL  $2F2C                     ;[312F] 
    CALL  VALIDATE_SWAP             ;[3132] 
    LD    IX,DATA_LOG               ;[3135] 
    CALL  $2EC1                     ;[3139] 
    CALL  $2F3C                     ;[313C] 
    CALL  LYNX_MLT                  ;[313F] 
    LD    HL,$35FB                  ;[3142] 
    CALL  LYNX_LNUM2                ;[3145] 
    CALL  LYNX_AD                   ;[3148] 
    LD    HL,SYSVAR_WRA1            ;[314B] 
    PUSH  HL                        ;[314E] 
    CALL  LYNX_LNUM2                ;[314F] 
    CALL  LYNX_LONE                 ;[3152] 
    POP   HL                        ;[3155] 
    SET   0,(HL)                    ;[3156] 
    POP   AF                        ;[3158] 
    LD    ($62E6),A                 ;[3159] 
    CALL  $359A                     ;[315C] 
    POP   AF                        ;[315F] 
    JR    NZ,$3167                  ;[3160] 
    LD    HL,SYSVAR_WRA1            ;[3162] 
    RES   7,(HL)                    ;[3165] 
    JP    LYNX_AD                   ;[3167] 

DATA_LOG:
    defb 0x04,0xBF,0x19,0x13,0x37,0x71,0xBE,0x94        ;[316A]
    defb 0x37,0x64,0x76,0xBF,0x17,0x75,0x22,0x07        ;[3172]
    defb 0xBF,0x28,0x93,0x35,0x52,0xBF,0x86,0x85        ;[317A]
    defb 0x91,0x72                                      ;[3182]


BASIC_FN_EXP:
    LD    HL,$35F1                  ;[3184] EXP.
    CALL  LYNX_LNUM2                ;[3187] 
    CALL  LYNX_MLT                  ;[318A] 
    JP    BASIC_FN_ANTILOG          ;[318D] 

BASIC_FN_TAN:
    CALL  $2F2C                     ;[3190] TAN.
    CALL  BASIC_FN_COS              ;[3193] 
    CALL  $2F3C                     ;[3196] 
    CALL  $2F2C                     ;[3199] 
    LD    HL,SYSVAR_WRA2            ;[319C] 
    CALL  LYNX_LNUM1                ;[319F] 
    CALL  BASIC_FN_SIN              ;[31A2] 
    CALL  $2F3C                     ;[31A5] 
    JP    LYNX_DIV                  ;[31A8] 

BASIC_FN_ANTILOG:
    LD    HL,SYSVAR_WRA1            ;[31AB] ANTILOG.
    BIT   7,(HL)                    ;[31AE] 
    EX    AF,AF'                    ;[31B0] 
    SET   7,(HL)                    ;[31B1] 
    LD    A,$BF                     ;[31B3] 
    CP    (HL)                      ;[31B5] 
    JR    C,$31BC                   ;[31B6] 
    INC   A                         ;[31B8] 
    PUSH  AF                        ;[31B9] 
    JR    $31D9                     ;[31BA] 
    LD    A,(SYSVAR_WRA1)           ;[31BC] 
    CALL  $349F                     ;[31BF] 
    EX    DE,HL                     ;[31C2] 
    LD    HL,$003C                  ;[31C3] 
    OR    A                         ;[31C6] 
    SBC   HL,DE                     ;[31C7] 
    CALL  C,$3B3E                   ;[31C9] 
    LD    A,$C0                     ;[31CC] 
    ADD   A,E                       ;[31CE] 
    PUSH  AF                        ;[31CF] 
    LD    A,$BF                     ;[31D0] 
    LD    (SYSVAR_WRA1),A           ;[31D2] 
    OR    A                         ;[31D5] 
    CALL  $359A                     ;[31D6] 
    LD    IX,DATA_ANTILOG           ;[31D9] 
    CALL  $2EC1                     ;[31DD] 
    CALL  VALIDATE_SWAP             ;[31E0] 
    POP   AF                        ;[31E3] 
    LD    (SYSVAR_WRA1),A           ;[31E4] 
    EX    AF,AF'                    ;[31E7] 
    RET   NZ                        ;[31E8] 
    LD    HL,DATA_FLOATS            ;[31E9] 
    CALL  LYNX_LNUM2                ;[31EC] 
    CALL  LYNX_SWAP                 ;[31EF] 
    CALL  LYNX_DIV                  ;[31F2] 
    RET                             ;[31F5] 


DATA_ANTILOG:
    defb 0x06,0xBD,0x56,0x54,0x90,0x20,0xBE,0x13        ;[31F6]
    defb 0x42,0x09,0x40,0xBE,0x75,0x46,0x75,0x47        ;[31FE]
    defb 0xBF,0x25,0x36,0x03,0x32,0xBF,0x66,0x28        ;[3206]
    defb 0x43,0x15,0xC0,0x11,0x51,0x28,0x76,0xC0        ;[320E]
    defb 0x10,0x00,0x00,0x00                            ;[3216]

BASIC_FN_COS:
    LD    HL,$35E2                  ;[321A] COS.
    CALL  LYNX_LNUM2                ;[321D] 
    CALL  LYNX_AD                   ;[3220] 

BASIC_FN_SIN:
    LD    HL,$35DD                  ;[3223] SIN.
    CALL  LYNX_LNUM2                ;[3226] 
    CALL  LYNX_DIV                  ;[3229] 
    CALL  BASIC_FN_FRAC             ;[322C] 
    LD    HL,$35D3                  ;[322F] 
    CALL  LYNX_LNUM2                ;[3232] 
    CALL  LYNX_MLT                  ;[3235] 
    LD    A,(SYSVAR_WRA1)           ;[3238] 
    BIT   7,A                       ;[323B] 
    JR    NZ,$3248                  ;[323D] 
    LD    HL,$35D3                  ;[323F] 
    CALL  LYNX_LNUM2                ;[3242] 
    CALL  LYNX_AD                   ;[3245] 
    LD    HL,DATA_FLOATS            ;[3248] 
    CALL  LYNX_LNUM2                ;[324B] 
    CALL  LYNX_CMP                  ;[324E] 
    JR    NC,$3278                  ;[3251] 
    CALL  LYNX_SWAP                 ;[3253] 
    LD    HL,$35CE                  ;[3256] 
    CALL  LYNX_LNUM1                ;[3259] 
    CALL  LYNX_CMP                  ;[325C] 
    JR    NC,$326C                  ;[325F] 
    LD    HL,$35C9                  ;[3261] 
    CALL  LYNX_LNUM1                ;[3264] 
    CALL  LYNX_SBT                  ;[3267] 
    JR    $3278                     ;[326A] 
    LD    HL,$35D3                  ;[326C] 
    CALL  LYNX_LNUM1                ;[326F] 
    CALL  LYNX_SWAP                 ;[3272] 
    CALL  LYNX_SBT                  ;[3275] 
    CALL  $2F2C                     ;[3278] 
    CALL  VALIDATE_SWAP             ;[327B] 
    LD    IX,DATA_SINCOS            ;[327E] 
    CALL  $2EC1                     ;[3282] 
    CALL  $2F3C                     ;[3285] 
    JP    LYNX_MLT                  ;[3288] 

DATA_SINCOS:
    defb 0x04,0xBC,0x15,0x14,0x84,0x19,0x3D,0x46        ;[328B]
    defb 0x73,0x76,0x56,0xBE,0x79,0x68,0x96,0x79        ;[3293]
    defb 0x3F,0x64,0x59,0x63,0x71,0xC0,0x15,0x70        ;[329B]
    defb 0x79,0x63                                      ;[32A3]


BASIC_FN_NOT:
    CALL  $2EF0                     ;[32A5] NOT.
    LD    A,(SYSVAR_WRA1)           ;[32A8] 
    CP    $80                       ;[32AB] 
    JR    $32B2                     ;[32AD] 

BASIC_FN_EQUAL:
    CALL  LYNX_CMP                  ;[32AF] = as in IF A=B
    LD    HL,$3605                  ;[32B2] 
    JR    NZ,$32BA                  ;[32B5] 
    LD    HL,DATA_FLOATS            ;[32B7] 
    JP    LYNX_LNUM1                ;[32BA] 

BASIC_FN_LTGT:
    CALL  BASIC_FN_EQUAL            ;[32BD] <> Not equal routine.
    JR    $32A8                     ;[32C0] 

BASIC_FN_GREATERTHAN:
    NOP                             ;[32C2] > Greater than routine.
    CALL  LYNX_CMP                  ;[32C3] 
    LD    HL,DATA_FLOATS            ;[32C6] 
    JR    C,$32BA                   ;[32C9] 
    LD    HL,$3605                  ;[32CB] 
    JR    $32BA                     ;[32CE] 

BASIC_FN_LT_EQUAL:
    CALL  BASIC_FN_GREATERTHAN      ;[32D0] = Less than or equal to routine.
    JR    $32A8                     ;[32D3] 

BASIC_FN_LESSTHAN:
    CALL  LYNX_SWAP                 ;[32D5] > Greater than routine.
    JR    $32C3                     ;[32D8] 

BASIC_FN_GT_EQUAL:
    CALL  BASIC_FN_LESSTHAN         ;[32DA] )= Greater than or equal to routine.
    JR    $32A8                     ;[32DD] 

BASIC_FN_OR:
    LD    A,(SYSVAR_WRA1)           ;[32DF] OR.
    CP    $80                       ;[32E2] 
    JR    NZ,$32EB                  ;[32E4] 
    LD    A,(SYSVAR_WRA2)           ;[32E6] 
    CP    $80                       ;[32E9] 
    LD    HL,DATA_FLOATS            ;[32EB] 
    JR    NZ,$32F3                  ;[32EE] 
    LD    HL,$3605                  ;[32F0] 
    JP    LYNX_LNUM1                ;[32F3] 

BASIC_FN_AND:
    LD    A,(SYSVAR_WRA1)           ;[32F6] AND.
    CP    $80                       ;[32F9] 
    JR    Z,$32EB                   ;[32FB] 
    LD    A,(SYSVAR_WRA2)           ;[32FD] 
    CP    $80                       ;[3300] 
    JR    $32EB                     ;[3302] 
    CALL  $2EF0                     ;[3304] 
    POP   BC                        ;[3307] 
    POP   DE                        ;[3308] 
    DEC   IY                        ;[3309] 
    LD    A,(IY+$00)                ;[330B] 
    JP    $33D6                     ;[330E] 

BASIC_FN_MINUS:
    CALL  $2EF0                     ;[3311] - Minus sign.
    JP    $3559                     ;[3314] 
    CP    (HL)                      ;[3317] 
    RET   Z                         ;[3318] 
    XOR   (HL)                      ;[3319] 
    LD    (HL),A                    ;[331A] 
    RET                             ;[331B] 

    NOP                             ;[331C] 

BASIC_FN_HIMEM:
    LD    HL,(SYSVAR_STACK)         ;[331D] HIMEM.
    INC   HL                        ;[3320] 
    INC   HL                        ;[3321] 
    JR    $3333                     ;[3322] 

BASIC_FN_HL:
    LD    HL,(SYSVAR_HLSTORE)       ;[3324] HL.
    JR    $3333                     ;[3327] 

BASIC_FN_INP:
    CALL  LYNX_FPINT                ;[3329] INP.
    LD    C,L                       ;[332C] 
    LD    B,H                       ;[332D] 
    IN    A,(C)                     ;[332E] 
    LD    L,A                       ;[3330] 
    LD    H,$00                     ;[3331] 
    JP    LYNX_INTFP                ;[3333] 

BASIC_FN_DPEEK:
    CALL  LYNX_FPINT                ;[3336] DPEEK.
    LD    A,(HL)                    ;[3339] 
    INC   HL                        ;[333A] 
    LD    H,(HL)                    ;[333B] 
    LD    L,A                       ;[333C] 
    JR    $3333                     ;[333D] 

BASIC_FN_PEEK:
    CALL  LYNX_FPINT                ;[333F] PEEK.
    LD    A,(HL)                    ;[3342] 
    JR    $3330                     ;[3343] 

BASIC_FN_DEG:
    LD    HL,$3357                  ;[3345] DEG.
    CALL  LYNX_LNUM2                ;[3348] 
    JP    LYNX_MLT                  ;[334B] 

BASIC_FN_RAD:
    LD    HL,$3357                  ;[334E] RAD.
    CALL  LYNX_LNUM2                ;[3351] 
    JP    LYNX_DIV                  ;[3354] 
    POP   BC                        ;[3357] Utility called by RAD and DEG
    LD    D,A                       ;[3358] 
    ADD   HL,HL                     ;[3359] 
    LD    D,A                       ;[335A] 
    ADD   A,B                       ;[335B] 
    LD    IX,$6487                  ;[335C] 
    CALL  $2BE5                     ;[3360] 
    INC   DE                        ;[3363] 
    PUSH  DE                        ;[3364] 
    LD    DE,$6487                  ;[3365] 
    LD    HL,SYSVAR_STRBUF          ;[3368] 
    LD    A,(DE)                    ;[336B] 
    CP    (HL)                      ;[336C] 
    JR    NZ,$3375                  ;[336D] 
    INC   DE                        ;[336F] 
    INC   HL                        ;[3370] 
    CP    $0D                       ;[3371] 
    JR    NZ,$336B                  ;[3373] 
    POP   DE                        ;[3375] 
    RET                             ;[3376] 

    CALL  $2BE1                     ;[3377] Take data from program line.
    LD    A,(DE)                    ;[337A] 
    INC   DE                        ;[337B] 
    CP    $3D                       ;[337C] 
    JR    NZ,$3391                  ;[337E] 
    CALL  $335C                     ;[3380] 
    PUSH  DE                        ;[3383] 
    LD    DE,DATA_FLOATS            ;[3384] 
    JR    Z,$338C                   ;[3387] 
    LD    DE,$3605                  ;[3389] 
    CALL  $3428                     ;[338C] 
    POP   DE                        ;[338F] 
    RET                             ;[3390] 

    CALL  $335C                     ;[3391] 
    PUSH  DE                        ;[3394] 
    LD    DE,DATA_FLOATS            ;[3395] 
    JR    C,$338C                   ;[3398] 
    JR    $3389                     ;[339A] 
    CALL  $2BE1                     ;[339C] 
    INC   DE                        ;[339F] 
    INC   DE                        ;[33A0] 
    JR    $33AD                     ;[33A1] 
    CALL  $3377                     ;[33A3] 
    JP    $33AD                     ;[33A6] 
    LD    IY,SYSVAR_CSTACK          ;[33A9] 
    LD    A,(DE)                    ;[33AD] 
    INC   DE                        ;[33AE] 
    CP    $79                       ;[33AF] 
    JR    Z,$339C                   ;[33B1] 
    CP    $7C                       ;[33B3] 
    JR    Z,$33A3                   ;[33B5] 
    CP    $7E                       ;[33B7] 
    JR    Z,$33FB                   ;[33B9] 
    CP    $7A                       ;[33BB] 
    JR    Z,$33FB                   ;[33BD] 
    CP    $35                       ;[33BF] 
    JR    C,$3400                   ;[33C1] 
    CP    $75                       ;[33C3] 
    JR    C,$341D                   ;[33C5] 
    CP    $7F                       ;[33C7] 
    JR    Z,$3425                   ;[33C9] 
    CP    $BF                       ;[33CB] 
    JR    Z,$33AD                   ;[33CD] 
    JR    C,$341D                   ;[33CF] 
    CP    $D7                       ;[33D1] 
    CALL  NC,$3B38                  ;[33D3] 
    LD    IX,(SYSVAR_FTBL)          ;[33D6] 
    PUSH  DE                        ;[33DA] 
    CP    $C6                       ;[33DB] 
    PUSH  AF                        ;[33DD] 
    CALL  NC,$2EEA                  ;[33DE] 
    POP   AF                        ;[33E1] 
    SLA   A                         ;[33E2] 
    LD    C,A                       ;[33E4] 
    LD    B,$00                     ;[33E5] 
    ADD   IX,BC                     ;[33E7] 
    LD    L,(IX+$00)                ;[33E9] 
    LD    H,(IX+$01)                ;[33EC] 
    LD    BC,$33F4                  ;[33EF] 
    PUSH  BC                        ;[33F2] 
    JP    (HL)                      ;[33F3] 
    POP   DE                        ;[33F4] 
    CALL  $2EFF                     ;[33F5] 
    JP    $33AD                     ;[33F8] 
    CALL  $3428                     ;[33FB] 
    JR    $33AD                     ;[33FE] 
    PUSH  DE                        ;[3400] 
    LD    L,A                       ;[3401] 
    LD    H,$00                     ;[3402] 
    LD    E,L                       ;[3404] 
    LD    D,H                       ;[3405] 
    ADD   HL,HL                     ;[3406] 
    ADD   HL,HL                     ;[3407] 
    ADD   HL,DE                     ;[3408] 
    LD    DE,(SYSVAR_VTBL)          ;[3409] 
    ADD   HL,DE                     ;[340D] 
    INC   HL                        ;[340E] 
    LD    A,(HL)                    ;[340F] 
    INC   A                         ;[3410] 
    DEC   HL                        ;[3411] 
    CALL  Z,$3B11                   ;[3412] 
    EX    DE,HL                     ;[3415] 
    CALL  $3428                     ;[3416] 
    POP   DE                        ;[3419] 
    JP    $33AD                     ;[341A] 
    LD    (IY+$00),A                ;[341D] 
    INC   IY                        ;[3420] 
    JP    $33AD                     ;[3422] 
    JP    $2EF0                     ;[3425] 
    LD    B,$05                     ;[3428] 
    LD    A,(DE)                    ;[342A] 
    LD    (IY+$00),A                ;[342B] 
    INC   DE                        ;[342E] 
    INC   IY                        ;[342F] 
    DJNZ  $342A                     ;[3431] 
    RET                             ;[3433] 

BASIC_FN_ABS:
    LD    HL,SYSVAR_WRA1            ;[3434] ABS.
    SET   7,(HL)                    ;[3437] 
    RET                             ;[3439] 

BASIC_FN_SGN:
    LD    A,(SYSVAR_WRA1)           ;[343A] SGN.
    PUSH  AF                        ;[343D] 
    CALL  LYNX_LZERO                ;[343E] 
    POP   AF                        ;[3441] 
    CP    $80                       ;[3442] 
    RET   Z                         ;[3444] 
    LD    HL,$62E6                  ;[3445] 
    SET   4,(HL)                    ;[3448] 
    BIT   7,A                       ;[344A] 
    LD    A,$40                     ;[344C] 
    JR    Z,$3452                   ;[344E] 
    LD    A,$C0                     ;[3450] 
    LD    (SYSVAR_WRA1),A           ;[3452] 
    RET                             ;[3455] 

BASIC_FN_INT:
    LD    A,(SYSVAR_WRA1)           ;[3456] INT.
    RES   7,A                       ;[3459] 
    CP    $47                       ;[345B] 
    RET   NC                        ;[345D] 
    CP    $40                       ;[345E] 
    JP    C,LYNX_LZERO              ;[3460] 
    SUB   $47                       ;[3463] 
    NEG                             ;[3465] 
    LD    B,A                       ;[3467] 
    PUSH  BC                        ;[3468] 
    CALL  $3643                     ;[3469] 
    DJNZ  $3469                     ;[346C] 
    POP   BC                        ;[346E] 
    CALL  $3656                     ;[346F] 
    DJNZ  $346F                     ;[3472] 
    RET                             ;[3474] 

BASIC_FN_FRAC:
    LD    A,(SYSVAR_WRA1)           ;[3475] FRAC.
    RES   7,A                       ;[3478] 
    CP    $47                       ;[347A] 
    JP    NC,LYNX_LZERO             ;[347C] 
    CP    $40                       ;[347F] 
    RET   C                         ;[3481] 
    SUB   $3F                       ;[3482] 
    LD    B,A                       ;[3484] 
    LD    A,(SYSVAR_WRA1)           ;[3485] 
    AND   $C0                       ;[3488] 
    DEC   A                         ;[348A] 
    LD    (SYSVAR_WRA1),A           ;[348B] 
    CALL  $3656                     ;[348E] 
    DJNZ  $348E                     ;[3491] 
    OR    A                         ;[3493] 
    JP    $359A                     ;[3494] 

LYNX_FPINT:
    LD    A,(SYSVAR_WRA1)           ;[3497] Floating point in WRA1 to integer in HL
    CP    $C0                       ;[349A] 
    JP    Z,$3889                   ;[349C] 
    LD    HL,START                  ;[349F] 
    BIT   7,A                       ;[34A2] 
    CALL  Z,$3B29                   ;[34A4] 
    CP    $C0                       ;[34A7] 
    RET   C                         ;[34A9] 
    CP    $C7                       ;[34AA] 
    CALL  NC,$3B29                  ;[34AC] 
    SUB   $BF                       ;[34AF] 
    LD    B,A                       ;[34B1] 
    PUSH  DE                        ;[34B2] 
    CALL  $3656                     ;[34B3] 
    LD    E,L                       ;[34B6] 
    LD    D,H                       ;[34B7] 
    ADD   HL,HL                     ;[34B8] 
    ADD   HL,HL                     ;[34B9] 
    ADD   HL,DE                     ;[34BA] 
    ADD   HL,HL                     ;[34BB] 
    LD    E,A                       ;[34BC] 
    LD    D,$00                     ;[34BD] 
    ADD   HL,DE                     ;[34BF] 
    DJNZ  $34B3                     ;[34C0] 
    POP   DE                        ;[34C2] 
    RET                             ;[34C3] 

LYNX_INTFP:
    LD    A,$C7                     ;[34C4] Integer in HL to floating point in WRA1. 
    LD    (SYSVAR_WRA1),A           ;[34C6] 
    PUSH  HL                        ;[34C9] 
    LD    HL,START                  ;[34CA] 
    LD    ($62E8),HL                ;[34CD] 
    LD    ($62E6),HL                ;[34D0] 
    POP   HL                        ;[34D3] 
    LD    B,$10                     ;[34D4] 
    ADD   HL,HL                     ;[34D6] 
    PUSH  BC                        ;[34D7] 
    PUSH  HL                        ;[34D8] 
    LD    B,$04                     ;[34D9] 
    LD    HL,$62E9                  ;[34DB] 
    LD    A,(HL)                    ;[34DE] 
    ADC   A,(HL)                    ;[34DF] 
    DAA                             ;[34E0] 
    LD    (HL),A                    ;[34E1] 
    DEC   HL                        ;[34E2] 
    DJNZ  $34DE                     ;[34E3] 
    POP   HL                        ;[34E5] 
    POP   BC                        ;[34E6] 
    DJNZ  $34D6                     ;[34E7] 
    OR    A                         ;[34E9] 
    JP    $359A                     ;[34EA] 
    LD    A,(DE)                    ;[34ED] Test for '0' to '9'
    CP    $30                       ;[34EE] 
    RET   C                         ;[34F0] 
    CP    $3A                       ;[34F1] 
    CCF                             ;[34F3] 
    RET                             ;[34F4] 

    LD    A,(DE)                    ;[34F5] Test for 'A' to Z' and 'a' to 'z',
    CP    $41                       ;[34F6] 
    RET   C                         ;[34F8] 
    CP    $5B                       ;[34F9] 
    CCF                             ;[34FB] 
    RET   NC                        ;[34FC] 
    CP    $61                       ;[34FD] 
    RET   C                         ;[34FF] 
    CP    $7B                       ;[3500] 
    CCF                             ;[3502] 
    RET                             ;[3503] 

    LD    A,(DE)                    ;[3504] Test for uppercase/lowercase.
    SUB   $40                       ;[3505] 
    CP    $1B                       ;[3507] 
    RET   C                         ;[3509] 
    SUB   $06                       ;[350A] 
    RET                             ;[350C] 

LYNX_ZWRA1:
    LD    HL,SYSVAR_WRA1            ;[350D] Clears WRA1 to 0s. 
    LD    B,$05                     ;[3510] 
    LD    (HL),$00                  ;[3512] 
    INC   HL                        ;[3514] 
    DJNZ  $3512                     ;[3515] 
    RET                             ;[3517] 

    defb 0x0D,0x1E,0x00                                 ;[3518]

    PUSH  AF                        ;[351B] Display character in A (PutChar)
    CP    $0D                       ;[351C] 
    JR    NZ,$3530                  ;[351E] 
    PUSH  HL                        ;[3520] 
    LD    HL,(SYSVAR_CRST)          ;[3521] 
    CALL  LYNX_PLINE                ;[3524] 
    POP   HL                        ;[3527] 
    POP   AF                        ;[3528] 
    RET                             ;[3529] 

    PUSH  AF                        ;[352A] Output a space
    LD    A,$20                     ;[352B] 
    JR    $3530                     ;[352D] 
    PUSH  AF                        ;[352F] Output character in A to the screen.
    PUSH  HL                        ;[3530] 
    PUSH  BC                        ;[3531] 
    CALL  $203C                     ;[3532] 
    POP   BC                        ;[3535] 
    POP   HL                        ;[3536] 
    POP   AF                        ;[3537] 
    RET                             ;[3538] 

LYNX_PLINE:
    LD    A,(HL)                    ;[3539] Display line pointed to by HL and terminated by 0.
    INC   HL                        ;[353A] 
    OR    A                         ;[353B] 
    RET   Z                         ;[353C] 
    CALL  $352F                     ;[353D] 
    JR    LYNX_PLINE                ;[3540] 

LYNX_SWAP:
    LD    HL,SYSVAR_WRA1            ;[3542] Swaps contents of WRA1 and WRA2. 
    LD    DE,SYSVAR_WRA2            ;[3545] 
    LD    B,$05                     ;[3548] 
    LD    C,(HL)                    ;[354A] 
    LD    A,(DE)                    ;[354B] 
    EX    DE,HL                     ;[354C] 
    LD    (HL),C                    ;[354D] 
    LD    (DE),A                    ;[354E] 
    INC   DE                        ;[354F] 
    INC   HL                        ;[3550] 
    DJNZ  $354A                     ;[3551] 
    RET                             ;[3553] 

    LD    HL,SYSVAR_WRA2            ;[3554] Called by the subtraction routine (366A).
    JR    $355C                     ;[3557] 
    LD    HL,SYSVAR_WRA1            ;[3559] 
    LD    A,$80                     ;[355C] 
    JP    $3317                     ;[355E] 

LYNX_CMP:
    CALL  $3579                     ;[3561] Compares WRA2, WRA1. Flags set as (WRA2) - (WRA1). 
    RET   Z                         ;[3564] 
    PUSH  AF                        ;[3565] 
    LD    HL,SYSVAR_WRA1            ;[3566] 
    BIT   7,(HL)                    ;[3569] 
    JR    NZ,$3577                  ;[356B] 
    LD    HL,SYSVAR_WRA2            ;[356D] 
    BIT   7,(HL)                    ;[3570] 
    JR    NZ,$3577                  ;[3572] 
    POP   AF                        ;[3574] 
    CCF                             ;[3575] 
    RET                             ;[3576] 

    POP   AF                        ;[3577] 
    RET                             ;[3578] 

    LD    HL,SYSVAR_WRA1            ;[3579] Subroutine called by compare routine.
    LD    DE,SYSVAR_WRA2            ;[357C] 
    LD    B,$05                     ;[357F] 
    LD    A,(DE)                    ;[3581] 
    CP    (HL)                      ;[3582] 
    RET   NZ                        ;[3583] 
    INC   HL                        ;[3584] 
    INC   DE                        ;[3585] 
    DJNZ  $3581                     ;[3586] 
    RET                             ;[3588] 

    LD    HL,SYSVAR_WRA1            ;[3589] Subroutine called by the addition routine.
    LD    DE,SYSVAR_WRA2            ;[358C] 
    LD    A,(DE)                    ;[358F] 
    RES   7,A                       ;[3590] 
    LD    C,(HL)                    ;[3592] 
    RES   7,C                       ;[3593] 
    CP    C                         ;[3595] 
    LD    B,$05                     ;[3596] 
    JR    $3583                     ;[3598] 
    CALL  $361E                     ;[359A] 
    LD    A,(SYSVAR_WRA1)           ;[359D] 
    RES   7,A                       ;[35A0] 
    ADD   A,C                       ;[35A2] 
    JR    Z,LYNX_LZERO              ;[35A3] 
    BIT   7,A                       ;[35A5] 
    JR    Z,$3616                   ;[35A7] 
    CP    $C0                       ;[35A9] 
    CALL  C,$3B3E                   ;[35AB] 

LYNX_LZERO:
    LD    HL,$3605                  ;[35AE] Basic FALSE Function: Loads-WRA1 with floating point 0.

LYNX_LNUM1:
    LD    DE,SYSVAR_WRA1            ;[35B1] Loads number pointed to by HL into WRA1
    LD    BC,$0005                  ;[35B4] 
    LDIR                            ;[35B7] 
    RET                             ;[35B9] 

LYNX_LNUM2:
    LD    DE,SYSVAR_WRA2            ;[35BA] Loads number pointed to by HL into WRA2
    JR    $35B4                     ;[35BD] 

LYNX_LONE:
    LD    HL,DATA_FLOATS            ;[35BF] Basic TRUE Function: Loads WRA1 with floating point 1.
    JR    LYNX_LNUM1                ;[35C2] 

DATA_FLOATS:
    defb 0xC0,0x10,0x00,0x00,0x00,0xC0,0x20,0x00        ;[35C4]
    defb 0x00,0x00,0xC0,0x30,0x00,0x00,0x00,0xC0        ;[35CC]
    defb 0x40,0x00,0x00,0x00,0xC4,0x65,0x53,0x60        ;[35D4]
    defb 0x00,0xC0,0x62,0x83,0x18,0x53,0xC0,0x15        ;[35DC]
    defb 0x70,0x79,0x63,0xBF,0x78,0x53,0x98,0x16        ;[35E4]
    defb 0xC0,0x25,0x06,0x62,0x83,0xBF,0x43,0x42        ;[35EC]
    defb 0x94,0x48,0xC0,0x31,0x62,0x27,0x76,0xBF        ;[35F4]
    defb 0x50,0x00,0x00,0x00,0x3F,0x50,0x00,0x00        ;[35FC]
    defb 0x00,0x80,0x00,0x00,0x00,0x00                  ;[3604]

    LD    B,$80                     ;[360A] I don't think that these bytes are used.

BASIC_FN_PI:
    LD    HL,DATA_PI                ;[360C] PI.
    JR    LYNX_LNUM1                ;[360F] 

DATA_PI:
    defb 0xC0,0x31,0x41,0x59,0x27                       ;[3611]

    LD    A,(SYSVAR_WRA1)           ;[3616] Numeric manipulation routines.
    ADD   A,C                       ;[3619] 
    LD    (SYSVAR_WRA1),A           ;[361A] 
    RET                             ;[361D] 

    LD    BC,$0900                  ;[361E] 
    JR    NC,$362A                  ;[3621] 
    LD    A,$01                     ;[3623] 
    CALL  $3643                     ;[3625] 
    INC   C                         ;[3628] 
    RET                             ;[3629] 

    LD    A,($62E6)                 ;[362A] 
    CP    $10                       ;[362D] 
    RET   NC                        ;[362F] 
    DEC   C                         ;[3630] 
    CALL  $3656                     ;[3631] 
    DJNZ  $362A                     ;[3634] 
    POP   HL                        ;[3636] 
    JP    LYNX_LZERO                ;[3637] 
    XOR   A                         ;[363A] 
    PUSH  HL                        ;[363B] 
    PUSH  BC                        ;[363C] 
    LD    HL,$62E1                  ;[363D] 
    JR    $3648                     ;[3640] 
    XOR   A                         ;[3642] 
    PUSH  HL                        ;[3643] 
    PUSH  BC                        ;[3644] 
    LD    HL,$62E6                  ;[3645] 
    CALL  $364E                     ;[3648] 
    POP   BC                        ;[364B] 
    POP   HL                        ;[364C] 
    RET                             ;[364D] 

    LD    B,$04                     ;[364E] 
    RRD                             ;[3650] 
    INC   HL                        ;[3652] 
    DJNZ  $3650                     ;[3653] 
    RET                             ;[3655] 

    XOR   A                         ;[3656] 
    PUSH  HL                        ;[3657] 
    PUSH  BC                        ;[3658] 
    LD    HL,$62E9                  ;[3659] 
    CALL  $3662                     ;[365C] 
    POP   BC                        ;[365F] 
    POP   HL                        ;[3660] 
    RET                             ;[3661] 

    LD    B,$04                     ;[3662] ? Fancy rotate with (HL) !! ??
    RLD                             ;[3664] 
    DEC   HL                        ;[3666] 
    DJNZ  $3664                     ;[3667] 
    RET                             ;[3669] 

LYNX_SBT:
    CALL  $3554                     ;[366A] Basic Minus Function: Subtracts (WRA2) from (WRA1), stores result in WRA1.
LYNX_AD:
    CALL  $3589                     ;[366D] Basic Add Function:  Adds (WRA1) and (WRA2), stores result in WRA1.
    CALL  NC,LYNX_SWAP              ;[3670] 
    LD    A,(SYSVAR_WRA2)           ;[3673] 
    AND   $7F                       ;[3676] 
    RET   Z                         ;[3678] 
    LD    C,A                       ;[3679] 
    LD    A,(SYSVAR_WRA1)           ;[367A] 
    RES   7,A                       ;[367D] 
    SUB   C                         ;[367F] 
    JR    Z,$368B                   ;[3680] 
    CP    $08                       ;[3682] 
    RET   NC                        ;[3684] 
    LD    B,A                       ;[3685] 
    CALL  $363A                     ;[3686] 
    DJNZ  $3686                     ;[3689] 
    LD    A,(SYSVAR_WRA1)           ;[368B] 
    LD    C,A                       ;[368E] 
    LD    A,(SYSVAR_WRA2)           ;[368F] 
    XOR   C                         ;[3692] 
    BIT   7,A                       ;[3693] 
    JR    Z,$369E                   ;[3695] 
    CALL  $36A4                     ;[3697] 
    OR    A                         ;[369A] 
    JP    $359A                     ;[369B] 
    CALL  $36B6                     ;[369E] 
    JP    $359A                     ;[36A1] 
    OR    A                         ;[36A4] 
    LD    DE,$62E9                  ;[36A5] 
    LD    HL,$62E4                  ;[36A8] 
    LD    B,$04                     ;[36AB] 
    LD    A,(DE)                    ;[36AD] 
    SBC   A,(HL)                    ;[36AE] 
    DAA                             ;[36AF] 
    LD    (DE),A                    ;[36B0] 
    DEC   HL                        ;[36B1] 
    DEC   DE                        ;[36B2] 
    DJNZ  $36AD                     ;[36B3] 
    RET                             ;[36B5] 

    OR    A                         ;[36B6] Called from Plus sign routine.
    LD    DE,$62E9                  ;[36B7] 
    LD    HL,$62E4                  ;[36BA] 
    LD    B,$04                     ;[36BD] 
    LD    A,(DE)                    ;[36BF] 
    ADC   A,(HL)                    ;[36C0] 
    DAA                             ;[36C1] 
    LD    (DE),A                    ;[36C2] 
    DEC   HL                        ;[36C3] 
    DEC   DE                        ;[36C4] 
    DJNZ  $36BF                     ;[36C5] 
    RET                             ;[36C7] 

LYNX_MLT:
    LD    A,(SYSVAR_WRA1)           ;[36C8] Basic Multiply Function: Multiplies (WRA1) and (WRA2), stores answer in WRA1.
    CP    $80                       ;[36CB] 
    JR    Z,$36EA                   ;[36CD] 
    AND   $7F                       ;[36CF] 
    LD    C,A                       ;[36D1] 
    LD    HL,SYSVAR_WRA2            ;[36D2] 
    LD    A,(HL)                    ;[36D5] 
    CP    $80                       ;[36D6] 
    JR    Z,$36EA                   ;[36D8] 
    AND   $7F                       ;[36DA] 
    ADD   A,C                       ;[36DC] 
    SUB   $3F                       ;[36DD] 
    JR    Z,$36EA                   ;[36DF] 
    BIT   7,A                       ;[36E1] 
    JR    Z,$36ED                   ;[36E3] 
    CP    $C0                       ;[36E5] 
    CALL  C,$3B3E                   ;[36E7] 
    JP    LYNX_LZERO                ;[36EA] 
    LD    C,A                       ;[36ED] 
    LD    A,(SYSVAR_WRA1)           ;[36EE] 
    XOR   (HL)                      ;[36F1] 
    CPL                             ;[36F2] 
    AND   $80                       ;[36F3] 
    ADD   A,C                       ;[36F5] 
    LD    (SYSVAR_WRA3),A           ;[36F6] 
    CALL  $3896                     ;[36F9] 
    JP    Z,SUB_MULTIPLY            ;[36FC] 
    LD    HL,$62D5                  ;[36FF] 
    LD    B,$0C                     ;[3702] 
    CALL  $3512                     ;[3704] 
    LD    DE,$62E4                  ;[3707] 
    LD    HL,$62DC                  ;[370A] 
    LD    B,$04                     ;[370D] 
    PUSH  BC                        ;[370F] 
    LD    A,(DE)                    ;[3710] 
    PUSH  DE                        ;[3711] 
    LD    E,A                       ;[3712] 
    PUSH  HL                        ;[3713] 
    CALL  $376A                     ;[3714] 
    POP   HL                        ;[3717] 
    CALL  C,$379F                   ;[3718] 
    DEC   HL                        ;[371B] 
    POP   DE                        ;[371C] 
    DEC   DE                        ;[371D] 
    POP   BC                        ;[371E] 
    DJNZ  $370F                     ;[371F] 
    LD    A,($62D5)                 ;[3721] 
    CP    $10                       ;[3724] 
    JR    NC,$3737                  ;[3726] 
    LD    HL,$62D9                  ;[3728] 
    LD    B,$05                     ;[372B] 
    CALL  $3664                     ;[372D] 
    LD    A,(HL)                    ;[3730] 
    DEC   A                         ;[3731] 
    LD    (HL),A                    ;[3732] 
    AND   $7F                       ;[3733] 
    JR    Z,$36EA                   ;[3735] 
    LD    HL,SYSVAR_WRA3            ;[3737] 
    JP    LYNX_LNUM1                ;[373A] 
    LD    A,E                       ;[373D] 
    AND   $F0                       ;[373E] 
    RRCA                            ;[3740] 
    LD    B,A                       ;[3741] 
    RRCA                            ;[3742] 
    RRCA                            ;[3743] 
    ADD   A,B                       ;[3744] 
    LD    B,A                       ;[3745] 
    LD    A,E                       ;[3746] 
    AND   $0F                       ;[3747] 
    ADD   A,B                       ;[3749] 
    LD    E,A                       ;[374A] 
    RET                             ;[374B] 

    LD    HL,START                  ;[374C] Subroutine called by multiply.
    LD    B,H                       ;[374F] 
    LD    C,A                       ;[3750] 
    SRL   E                         ;[3751] 
    JR    NZ,$3756                  ;[3753] 
    RET   NC                        ;[3755] 
    JR    NC,$3760                  ;[3756] 
    LD    A,C                       ;[3758] 
    ADD   A,L                       ;[3759] 
    DAA                             ;[375A] 
    LD    L,A                       ;[375B] 
    LD    A,B                       ;[375C] 
    ADC   A,H                       ;[375D] 
    DAA                             ;[375E] 
    LD    H,A                       ;[375F] 
    LD    A,C                       ;[3760] 
    ADD   A,C                       ;[3761] 
    DAA                             ;[3762] 
    LD    C,A                       ;[3763] 
    LD    A,B                       ;[3764] 
    ADC   A,B                       ;[3765] 
    DAA                             ;[3766] 
    LD    B,A                       ;[3767] 
    JR    $3751                     ;[3768] 
    CALL  $373D                     ;[376A] Subroutine called by multiply.
    RET   Z                         ;[376D] 
    PUSH  IX                        ;[376E] 
    LD    IX,$62D3                  ;[3770] 
    LD    (IX+$00),$00              ;[3774] 
    LD    HL,$62E9                  ;[3778] 
    LD    B,$04                     ;[377B] 
    PUSH  BC                        ;[377D] 
    PUSH  HL                        ;[377E] 
    LD    A,(HL)                    ;[377F] 
    PUSH  DE                        ;[3780] 
    CALL  $374C                     ;[3781] 
    LD    A,(IX+$00)                ;[3784] 
    ADD   A,L                       ;[3787] 
    DAA                             ;[3788] 
    LD    (IX+$00),A                ;[3789] 
    LD    A,$00                     ;[378C] 
    ADC   A,H                       ;[378E] 
    DAA                             ;[378F] 
    LD    (IX-$01),A                ;[3790] 
    DEC   IX                        ;[3793] 
    POP   DE                        ;[3795] 
    POP   HL                        ;[3796] 
    DEC   HL                        ;[3797] 
    POP   BC                        ;[3798] 
    DJNZ  $377D                     ;[3799] 
    POP   IX                        ;[379B] 
    SCF                             ;[379D] 
    RET                             ;[379E] 

    PUSH  HL                        ;[379F] Subroutine called by multiply.
    LD    B,$05                     ;[37A0] 
    LD    DE,$62D3                  ;[37A2] 
    OR    A                         ;[37A5] 
    LD    A,(DE)                    ;[37A6] 
    ADC   A,(HL)                    ;[37A7] 
    DAA                             ;[37A8] 
    LD    (HL),A                    ;[37A9] 
    DEC   HL                        ;[37AA] 
    DEC   DE                        ;[37AB] 
    DJNZ  $37A6                     ;[37AC] 
    POP   HL                        ;[37AE] 
    RET                             ;[37AF] 

LYNX_DIV:
    LD    HL,SYSVAR_WRA2            ;[37B0] Basic Divide Function: WRA1 = WRA1/WRA2
    LD    A,(HL)                    ;[37B3] 
    CP    $80                       ;[37B4] 
    CALL  Z,$3B41                   ;[37B6] 
    AND   $7F                       ;[37B9] 
    LD    C,A                       ;[37BB] 
    LD    A,(SYSVAR_WRA1)           ;[37BC] 
    CP    $80                       ;[37BF] 
    RET   Z                         ;[37C1] 
    AND   $7F                       ;[37C2] 
    SUB   C                         ;[37C4] 
    ADD   A,$40                     ;[37C5] 
    JR    Z,$37D2                   ;[37C7] 
    BIT   7,A                       ;[37C9] 
    JR    Z,$37D5                   ;[37CB] 
    CP    $C0                       ;[37CD] 
    CALL  C,$3B3E                   ;[37CF] 
    JP    LYNX_LZERO                ;[37D2] 
    LD    C,A                       ;[37D5] 
    LD    A,(SYSVAR_WRA1)           ;[37D6] 
    XOR   (HL)                      ;[37D9] 
    CPL                             ;[37DA] 
    AND   $80                       ;[37DB] 
    ADD   A,C                       ;[37DD] 
    LD    (SYSVAR_WRA1),A           ;[37DE] 
    CALL  $3896                     ;[37E1] 
    JP    Z,$384F                   ;[37E4] 
    LD    HL,$62D5                  ;[37E7] 
    LD    B,$0C                     ;[37EA] 
    CALL  $3512                     ;[37EC] 
    LD    DE,$62E1                  ;[37EF] 
    LD    HL,SYSVAR_WRAE            ;[37F2] 
    LD    B,$04                     ;[37F5] 
    CALL  $354A                     ;[37F7] 
    LD    DE,$62D5                  ;[37FA] 
    LD    HL,$62E6                  ;[37FD] 
    LD    BC,$0004                  ;[3800] 
    LDIR                            ;[3803] 
    LD    B,$08                     ;[3805] 
    PUSH  BC                        ;[3807] 
    LD    C,$00                     ;[3808] 
    CALL  $3844                     ;[380A] 
    JR    C,$381D                   ;[380D] 
    LD    HL,$62E4                  ;[380F] 
    LD    DE,$62DC                  ;[3812] 
    LD    B,$08                     ;[3815] 
    CALL  $36AD                     ;[3817] 
    INC   C                         ;[381A] 
    JR    $380A                     ;[381B] 
    LD    A,C                       ;[381D] 
    CALL  $3657                     ;[381E] 
    LD    HL,SYSVAR_WRAE            ;[3821] 
    LD    B,$08                     ;[3824] 
    XOR   A                         ;[3826] 
    CALL  $3650                     ;[3827] 
    POP   BC                        ;[382A] 
    DJNZ  $3807                     ;[382B] 
    LD    A,($62E6)                 ;[382D] 
    CP    $10                       ;[3830] 
    RET   NC                        ;[3832] 
    LD    A,(SYSVAR_WRA1)           ;[3833] 
    DEC   A                         ;[3836] 
    JR    Z,$37D2                   ;[3837] 
    CP    $80                       ;[3839] 
    JR    Z,$37D2                   ;[383B] 
    LD    (SYSVAR_WRA1),A           ;[383D] 
    LD    B,$01                     ;[3840] 
    JR    $3807                     ;[3842] 
    LD    DE,$62D5                  ;[3844] 
    LD    HL,SYSVAR_WRAE            ;[3847] 
    LD    B,$08                     ;[384A] 
    JP    $3581                     ;[384C] 
    LD    A,($62E1)                 ;[384F] 
    RRCA                            ;[3852] 
    RRCA                            ;[3853] 
    RRCA                            ;[3854] 
    RRCA                            ;[3855] 
    AND   $0F                       ;[3856] 
    LD    C,A                       ;[3858] 
    XOR   A                         ;[3859] 
    LD    E,A                       ;[385A] 
    LD    B,$04                     ;[385B] 
    LD    HL,$62E6                  ;[385D] 
    PUSH  BC                        ;[3860] 
    RLD                             ;[3861] 
    CALL  $3875                     ;[3863] 
    RLD                             ;[3866] 
    CALL  $3875                     ;[3868] 
    RLD                             ;[386B] 
    POP   BC                        ;[386D] 
    INC   HL                        ;[386E] 
    DJNZ  $3860                     ;[386F] 
    OR    A                         ;[3871] 
    JP    $359A                     ;[3872] 
    PUSH  BC                        ;[3875] 
    PUSH  AF                        ;[3876] 
    LD    A,E                       ;[3877] 
    RLCA                            ;[3878] 
    RLCA                            ;[3879] 
    ADD   A,E                       ;[387A] 
    RLCA                            ;[387B] 
    POP   BC                        ;[387C] 
    ADD   A,B                       ;[387D] 
    POP   BC                        ;[387E] 
    LD    B,$FF                     ;[387F] 
    INC   B                         ;[3881] 
    SUB   C                         ;[3882] 
    JR    NC,$3881                  ;[3883] 
    ADD   A,C                       ;[3885] 
    LD    E,A                       ;[3886] 
    LD    A,B                       ;[3887] 
    RET                             ;[3888] 

    LD    A,($62E6)                 ;[3889] jumped to from 349C
    RRCA                            ;[388C] 
    RRCA                            ;[388D] 
    RRCA                            ;[388E] 
    RRCA                            ;[388F] 
    AND   $0F                       ;[3890] 
    LD    L,A                       ;[3892] 
    LD    H,$00                     ;[3893] 
    RET                             ;[3895] 

    LD    A,($62E1)                 ;[3896] Subroutine called by multiply and divide.
    AND   $0F                       ;[3899] 
    RET   NZ                        ;[389B] 
    LD    A,($62E2)                 ;[389C] 
    OR    A                         ;[389F] 
    RET   NZ                        ;[38A0] 
    LD    A,($62E3)                 ;[38A1] 
    OR    A                         ;[38A4] 
    RET   NZ                        ;[38A5] 
    LD    A,($62E4)                 ;[38A6] 
    OR    A                         ;[38A9] 
    RET                             ;[38AA] 

SUB_MULTIPLY:
    LD    A,(SYSVAR_WRA3)           ;[38AB] Multiply subroutine.
    LD    (SYSVAR_WRA1),A           ;[38AE] 
    LD    A,($62E1)                 ;[38B1] 
    AND   $F0                       ;[38B4] 
    RRCA                            ;[38B6] 
    RRCA                            ;[38B7] 
    RRCA                            ;[38B8] 
    RRCA                            ;[38B9] 
    LD    HL,$62E9                  ;[38BA] 
    LD    B,$04                     ;[38BD] 
    LD    D,$00                     ;[38BF] 
    PUSH  BC                        ;[38C1] 
    PUSH  AF                        ;[38C2] 
    LD    B,A                       ;[38C3] 
    LD    E,$00                     ;[38C4] 
    XOR   A                         ;[38C6] 
    LD    C,(HL)                    ;[38C7] 
    ADD   A,C                       ;[38C8] 
    DAA                             ;[38C9] 
    JR    NC,$38CD                  ;[38CA] 
    INC   E                         ;[38CC] 
    DJNZ  $38C8                     ;[38CD] 
    ADD   A,D                       ;[38CF] 
    DAA                             ;[38D0] 
    CALL  SUB_MULTIPLY1             ;[38D1] 
    POP   AF                        ;[38D4] 
    POP   BC                        ;[38D5] 
    DJNZ  $38C1                     ;[38D6] 
    INC   E                         ;[38D8] 
    DEC   E                         ;[38D9] 
    LD    A,E                       ;[38DA] 
    JP    NZ,$3643                  ;[38DB] 
    LD    HL,SYSVAR_WRA1            ;[38DE] 
    LD    A,(HL)                    ;[38E1] 
    OR    A                         ;[38E2] 
    JP    Z,LYNX_LZERO              ;[38E3] 
    DEC   (HL)                      ;[38E6] 
    RET                             ;[38E7] 

    LD    SP,(SYSVAR_STACK)         ;[38E8] 'J' Command.
    JP    $1E76                     ;[38EC] 

DATA_ERROR_MSGS:
    defb 0x00,0x4F,0x75,0x74,0x20,0x6F,0x66,0x20        ;[38EF]
    defb 0x4D,0x65,0x6D,0x6F,0x72,0x79,0x00,0x57        ;[38F7]
    defb 0x72,0x6F,0x6E,0x67,0x20,0x4D,0x6F,0x64        ;[38FF]
    defb 0x65,0x00,0x53,0x74,0x72,0x69,0x6E,0x67        ;[3907]
    defb 0x20,0x65,0x72,0x72,0x6F,0x72,0x00,0x4D        ;[390F]
    defb 0x69,0x73,0x73,0x69,0x6E,0x67,0x20,0x62        ;[3917]
    defb 0x72,0x61,0x63,0x6B,0x65,0x74,0x00,0x44        ;[391F]
    defb 0x69,0x76,0x69,0x64,0x65,0x20,0x62,0x79        ;[3927]
    defb 0x20,0x7A,0x65,0x72,0x6F,0x20,0x65,0x72        ;[392F]
    defb 0x72,0x6F,0x72,0x00,0x4F,0x76,0x65,0x72        ;[3937]
    defb 0x66,0x6C,0x6F,0x77,0x20,0x65,0x72,0x72        ;[393F]
    defb 0x6F,0x72,0x00,0x53,0x79,0x6E,0x74,0x61        ;[3947]
    defb 0x78,0x20,0x65,0x72,0x72,0x6F,0x72,0x00        ;[394F]
    defb 0x53,0x6F,0x6D,0x65,0x74,0x68,0x69,0x6E        ;[3957]
    defb 0x67,0x20,0x6D,0x69,0x73,0x73,0x69,0x6E        ;[395F]
    defb 0x67,0x00,0x46,0x75,0x6E,0x63,0x74,0x69        ;[3967]
    defb 0x6F,0x6E,0x20,0x61,0x72,0x67,0x75,0x6D        ;[396F]
    defb 0x65,0x6E,0x74,0x20,0x65,0x72,0x72,0x6F        ;[3977]
    defb 0x72,0x00,0x4E,0x4F,0x54,0x20,0x59,0x45        ;[397F]
    defb 0x54,0x20,0x49,0x4D,0x50,0x4C,0x45,0x4D        ;[3987]
    defb 0x45,0x4E,0x54,0x45,0x44,0x00,0x52,0x65        ;[398F]
    defb 0x64,0x69,0x6D,0x65,0x6E,0x73,0x69,0x6F        ;[3997]
    defb 0x6E,0x65,0x64,0x20,0x61,0x72,0x72,0x61        ;[399F]
    defb 0x79,0x00,0x4C,0x69,0x6E,0x65,0x2C,0x20        ;[39A7]
    defb 0x4C,0x41,0x42,0x45,0x4C,0x20,0x6F,0x72        ;[39AF]
    defb 0x20,0x50,0x52,0x4F,0x43,0x20,0x6E,0x6F        ;[39B7]
    defb 0x74,0x20,0x66,0x6F,0x75,0x6E,0x64,0x00        ;[39BF]
    defb 0x4E,0x75,0x6D,0x62,0x65,0x72,0x20,0x6F        ;[39C7]
    defb 0x75,0x74,0x20,0x6F,0x66,0x20,0x72,0x61        ;[39CF]
    defb 0x6E,0x67,0x65,0x00,0x53,0x75,0x62,0x73        ;[39D7]
    defb 0x63,0x72,0x69,0x70,0x74,0x20,0x6F,0x75        ;[39DF]
    defb 0x74,0x20,0x6F,0x66,0x20,0x72,0x61,0x6E        ;[39E7]
    defb 0x67,0x65,0x00,0x54,0x79,0x70,0x65,0x20        ;[39EF]
    defb 0x6D,0x69,0x73,0x6D,0x61,0x74,0x63,0x68        ;[39F7]
    defb 0x00,0x4C,0x69,0x6E,0x65,0x20,0x74,0x6F        ;[39FF]
    defb 0x6F,0x20,0x6C,0x6F,0x6E,0x67,0x00,0x43        ;[3A07]
    defb 0x61,0x6E,0x6E,0x6F,0x74,0x20,0x63,0x6F        ;[3A0F]
    defb 0x6E,0x74,0x69,0x6E,0x75,0x65,0x00,0x4F        ;[3A17]
    defb 0x75,0x74,0x20,0x6F,0x66,0x20,0x44,0x61        ;[3A1F]
    defb 0x74,0x61,0x00,0x52,0x45,0x54,0x55,0x52        ;[3A27]
    defb 0x4E,0x20,0x77,0x69,0x74,0x68,0x6F,0x75        ;[3A2F]
    defb 0x74,0x20,0x47,0x4F,0x53,0x55,0x42,0x00        ;[3A37]
    defb 0x4E,0x45,0x58,0x54,0x20,0x77,0x69,0x74        ;[3A3F]
    defb 0x68,0x6F,0x75,0x74,0x20,0x46,0x4F,0x52        ;[3A47]
    defb 0x00,0x55,0x6E,0x64,0x65,0x66,0x69,0x6E        ;[3A4F]
    defb 0x65,0x64,0x20,0x76,0x61,0x72,0x69,0x61        ;[3A57]
    defb 0x62,0x6C,0x65,0x00,0x55,0x4E,0x54,0x49        ;[3A5F]
    defb 0x4C,0x20,0x77,0x69,0x74,0x68,0x6F,0x75        ;[3A67]
    defb 0x74,0x20,0x52,0x45,0x50,0x45,0x41,0x54        ;[3A6F]
    defb 0x00,0x57,0x45,0x4E,0x44,0x20,0x77,0x69        ;[3A77]
    defb 0x74,0x68,0x6F,0x75,0x74,0x20,0x57,0x48        ;[3A7F]
    defb 0x49,0x4C,0x45,0x00,0x57,0x48,0x49,0x4C        ;[3A87]
    defb 0x45,0x20,0x77,0x69,0x74,0x68,0x6F,0x75        ;[3A8F]
    defb 0x74,0x20,0x57,0x45,0x4E,0x44,0x00,0x52        ;[3A97]
    defb 0x65,0x74,0x75,0x72,0x6E,0x20,0x73,0x74        ;[3A9F]
    defb 0x61,0x63,0x6B,0x20,0x66,0x75,0x6C,0x6C        ;[3AA7]
    defb 0x00,0x52,0x45,0x50,0x45,0x41,0x54,0x20        ;[3AAF]
    defb 0x77,0x69,0x74,0x68,0x6F,0x75,0x74,0x20        ;[3AB7]
    defb 0x55,0x4E,0x54,0x49,0x4C,0x00,0x47,0x4F        ;[3ABF]
    defb 0x53,0x55,0x42,0x20,0x77,0x69,0x74,0x68        ;[3AC7]
    defb 0x6F,0x75,0x74,0x20,0x52,0x45,0x54,0x55        ;[3ACF]
    defb 0x52,0x4E,0x00,0x45,0x4E,0x44,0x50,0x52        ;[3AD7]
    defb 0x4F,0x43,0x20,0x77,0x69,0x74,0x68,0x6F        ;[3ADF]
    defb 0x75,0x74,0x20,0x50,0x52,0x4F,0x43,0x00        ;[3AE7]
    defb 0x0D,0x42,0x61,0x64,0x20,0x54,0x61,0x70        ;[3AEF]
    defb 0x65,0x00,0xAF                                 ;[3AF7]

    INC   A                         ;[3AFA] Error message selection code.
    LD    B,$AF                     ;[3AFB] 
    INC   A                         ;[3AFD] 
    LD    B,$AF                     ;[3AFE] 
    INC   A                         ;[3B00] 
    LD    B,$AF                     ;[3B01] 
    INC   A                         ;[3B03] 
    LD    B,$AF                     ;[3B04] 
    INC   A                         ;[3B06] 
    LD    B,$AF                     ;[3B07] 
    INC   A                         ;[3B09] 
    LD    B,$AF                     ;[3B0A] 
    INC   A                         ;[3B0C] 
    LD    B,$AF                     ;[3B0D] 
    INC   A                         ;[3B0F] 
    LD    B,$AF                     ;[3B10] 
    INC   A                         ;[3B12] 
    LD    B,$AF                     ;[3B13] 
    INC   A                         ;[3B15] 
    LD    B,$AF                     ;[3B16] 
    INC   A                         ;[3B18] 
    LD    B,$AF                     ;[3B19] 
    INC   A                         ;[3B1B] 
    LD    B,$AF                     ;[3B1C] 
    INC   A                         ;[3B1E] 
    LD    B,$AF                     ;[3B1F] 
    INC   A                         ;[3B21] 
    LD    B,$AF                     ;[3B22] 
    INC   A                         ;[3B24] 
    LD    B,$AF                     ;[3B25] 
    INC   A                         ;[3B27] 
    LD    B,$AF                     ;[3B28] 
    INC   A                         ;[3B2A] 
    LD    B,$AF                     ;[3B2B] 
    INC   A                         ;[3B2D] 
    LD    B,$AF                     ;[3B2E] 
    INC   A                         ;[3B30] 
    LD    B,$AF                     ;[3B31] 
    INC   A                         ;[3B33] 
    LD    B,$AF                     ;[3B34] 
    INC   A                         ;[3B36] 
    LD    B,$AF                     ;[3B37] 
    INC   A                         ;[3B39] 
    LD    B,$AF                     ;[3B3A] 
    INC   A                         ;[3B3C] 
    LD    B,$AF                     ;[3B3D] 
    INC   A                         ;[3B3F] 
    LD    B,$AF                     ;[3B40] 
    INC   A                         ;[3B42] 
    LD    B,$AF                     ;[3B43] 
    INC   A                         ;[3B45] 
    LD    B,$AF                     ;[3B46] 
    INC   A                         ;[3B48] 
    LD    B,$AF                     ;[3B49] 
    INC   A                         ;[3B4B] 
    LD    B,$AF                     ;[3B4C] 
    INC   A                         ;[3B4E] 
    CALL  SYSVAR_ERRAM              ;[3B4F] 
    LD    HL,(SYSVAR_ERRTBL)        ;[3B52] 
    LD    C,A                       ;[3B55] 
    LD    A,(HL)                    ;[3B56] 
    INC   HL                        ;[3B57] 
    OR    A                         ;[3B58] 
    JR    NZ,$3B56                  ;[3B59] 
    DEC   C                         ;[3B5B] 
    JR    NZ,$3B56                  ;[3B5C] 
    CALL  LYNX_PLINE                ;[3B5E] 
    JP    BASIC                     ;[3B61] 

BASIC_COM_MON:
    EX    (SP),HL                   ;[3B64] MONitor.
    DEC   HL                        ;[3B65] 
    LD    ($61B0),HL                ;[3B66] 
    EX    (SP),HL                   ;[3B69] 
    INC   SP                        ;[3B6A] 
    INC   SP                        ;[3B6B] 
    LD    ($61AE),SP                ;[3B6C] 
    LD    SP,$61AE                  ;[3B70] 
    PUSH  IY                        ;[3B73] 
    PUSH  IX                        ;[3B75] 
    EXX                             ;[3B77] 
    EX    AF,AF'                    ;[3B78] 
    PUSH  BC                        ;[3B79] 
    PUSH  DE                        ;[3B7A] 
    PUSH  HL                        ;[3B7B] 
    PUSH  AF                        ;[3B7C] 
    EXX                             ;[3B7D] 
    EX    AF,AF'                    ;[3B7E] 
    PUSH  BC                        ;[3B7F] 
    PUSH  DE                        ;[3B80] 
    PUSH  HL                        ;[3B81] 
    PUSH  AF                        ;[3B82] 
    LD    ($61BA),SP                ;[3B83] 
    LD    A,$C3                     ;[3B87] 
    LD    ($61B2),A                 ;[3B89] 
    CALL  $3E8E                     ;[3B8C] 
    LD    A,$0E                     ;[3B8F] 
    RST   $08                       ;[3B91] 
    JR    $3B9E                     ;[3B92] 
    LD    SP,($61BA)                ;[3B94] 
    LD    HL,$3BC8                  ;[3B98] 
    CALL  LYNX_PLINE                ;[3B9B] 
    LD    A,$2A                     ;[3B9E] 
    RST   $08                       ;[3BA0] 
    CALL  SYSVAR_LINP               ;[3BA1] 
    LD    DE,$6000                  ;[3BA4] 
    LD    A,(DE)                    ;[3BA7] 
    CALL  $3DFA                     ;[3BA8] 
    SUB   $41                       ;[3BAB] 
    JR    C,$3B94                   ;[3BAD] 
    CP    $1A                       ;[3BAF] 
    JR    NC,$3B94                  ;[3BB1] 
    RLCA                            ;[3BB3] 
    INC   DE                        ;[3BB4] 
    LD    BC,$3BCF                  ;[3BB5] 
    LD    L,A                       ;[3BB8] 
    LD    H,$00                     ;[3BB9] 
    ADD   HL,BC                     ;[3BBB] 
    LD    A,(HL)                    ;[3BBC] 
    INC   HL                        ;[3BBD] 
    LD    H,(HL)                    ;[3BBE] 
    LD    L,A                       ;[3BBF] 
    LD    BC,$3B9E                  ;[3BC0] 
    PUSH  BC                        ;[3BC3] 
    RST   $10                       ;[3BC4] 
    CP    $0D                       ;[3BC5] 
    JP    (HL)                      ;[3BC7] 
    defb 0x3F,0x3F,0x3F,0x3F,0x0D,0x1E,0x00             ;[3BC8]

    ADC   A,E                       ;[3BCF] Two byte addresses for the monitor commands A-Z
    DEC   A                         ;[3BD0] 
    EX    AF,AF'                    ;[3BD1] 
    INC   A                         ;[3BD2] 
    LD    (HL),B                    ;[3BD3] 
    DEC   A                         ;[3BD4] 
    CALL  M,$D43E                   ;[3BD5] 
    LD    A,$CC                     ;[3BD8] 
    DEC   A                         ;[3BDA] 
    OR    $3D                       ;[3BDB] 
    LD    (HL),H                    ;[3BDD] 
    INC   A                         ;[3BDE] 
    LD    A,B                       ;[3BDF] 
    DEC   A                         ;[3BE0] 
    RET   PE                        ;[3BE1] 
    JR    C,$3B78                   ;[3BE2] 
    DEC   SP                        ;[3BE4] 
    LD    HL,($663E)                ;[3BE5] 
    INC   A                         ;[3BE8] 
    SUB   H                         ;[3BE9] 
    DEC   SP                        ;[3BEA] 
    EX    DE,HL                     ;[3BEB] 
    DEC   A                         ;[3BEC] 
    RRA                             ;[3BED] 
    INC   A                         ;[3BEE] 
    SBC   A,$3D                     ;[3BEF] 
    LD    L,D                       ;[3BF1] 
    CCF                             ;[3BF2] 
    INC   BC                        ;[3BF3] 
    INC   A                         ;[3BF4] 
    LD    H,B                       ;[3BF5] 
    DEC   A                         ;[3BF6] 
    LD    L,(HL)                    ;[3BF7] 
    LD    A,$44                     ;[3BF8] 
    LD    A,$00                     ;[3BFA] 
    LD    A,$8E                     ;[3BFC] 
    LD    A,$94                     ;[3BFE] 
    DEC   SP                        ;[3C00] 
    CP    E                         ;[3C01] 
    INC   A                         ;[3C02] 

MONITOR_S:
    LD    A,$04                     ;[3C03] Monitor S command.
    JP    $351B                     ;[3C05] 

MONITOR_B:
    JR    Z,$3C17                   ;[3C08] Monitor B command.
    CALL  SUB_ARGUMENT_INTO_HL      ;[3C0A] 
    LD    ($61B6),HL                ;[3C0D] 
    LD    A,(HL)                    ;[3C10] 
    LD    ($61B5),A                 ;[3C11] 
    LD    (HL),$F7                  ;[3C14] 
    RET                             ;[3C16] 

    LD    HL,($61B6)                ;[3C17] 
    LD    A,($61B5)                 ;[3C1A] 
    LD    (HL),A                    ;[3C1D] 
    RET                             ;[3C1E] 

MONITOR_P:
    CALL  SUB_ARGUMENT_INTO_HL      ;[3C1F] Monitor P command.
    LD    DE,($61B0)                ;[3C22] 
    ADD   HL,DE                     ;[3C26] 
    LD    ($61B0),HL                ;[3C27] 
    JP    $3E8E                     ;[3C2A] 
    DEC   BC                        ;[3C2D] 
    DEC   BC                        ;[3C2E] 
    INC   BC                        ;[3C2F] 
    LD    L,C                       ;[3C30] 
    LD    H,B                       ;[3C31] 
    LD    ($61B8),HL                ;[3C32] 
    PUSH  BC                        ;[3C35] 
    CALL  $3D0C                     ;[3C36] 
    LD    A,$3C                     ;[3C39] 
    RST   $08                       ;[3C3B] 
    LD    A,(HL)                    ;[3C3C] 
    CALL  $2239                     ;[3C3D] 
    LD    A,$3E                     ;[3C40] 
    RST   $08                       ;[3C42] 
    CALL  $352A                     ;[3C43] 
    CALL  SYSVAR_LINP               ;[3C46] 
    POP   BC                        ;[3C49] 
    LD    DE,$6000                  ;[3C4A] 
    LD    A,(DE)                    ;[3C4D] 
    CP    $0D                       ;[3C4E] 
    JR    Z,$3C2F                   ;[3C50] 
    CP    $2F                       ;[3C52] 
    JR    Z,$3C2D                   ;[3C54] 
    CP    $2E                       ;[3C56] 
    RET   Z                         ;[3C58] 
    RST   $10                       ;[3C59] 
    CP    $0D                       ;[3C5A] 
    JR    Z,$3C30                   ;[3C5C] 
    CALL  SUB_ARGUMENT_INTO_HL      ;[3C5E] 
    LD    A,L                       ;[3C61] 
    LD    (BC),A                    ;[3C62] 
    INC   BC                        ;[3C63] 
    JR    $3C59                     ;[3C64] 

MONITOR_M:
    JR    NZ,$3C6D                  ;[3C66] Monitor M command.
    LD    HL,($61B8)                ;[3C68] 
    JR    $3C70                     ;[3C6B] 
    CALL  SUB_ARGUMENT_INTO_HL      ;[3C6D] 
    LD    C,L                       ;[3C70] 
    LD    B,H                       ;[3C71] 
    JR    $3C59                     ;[3C72] 

MONITOR_H:
    JR    NZ,$3C7B                  ;[3C74] Monitor H command.
    LD    HL,($61B8)                ;[3C76] 
    JR    $3C7E                     ;[3C79] 
    CALL  SUB_ARGUMENT_INTO_HL      ;[3C7B] 
    LD    B,$10                     ;[3C7E] 
    PUSH  BC                        ;[3C80] 
    CALL  $3CA5                     ;[3C81] 
    CALL  $352A                     ;[3C84] 
    LD    B,$08                     ;[3C87] 
    LD    A,(HL)                    ;[3C89] 
    INC   HL                        ;[3C8A] 
    CALL  $3D55                     ;[3C8B] 
    DJNZ  $3C89                     ;[3C8E] 
    LD    A,$1E                     ;[3C90] 
    RST   $08                       ;[3C92] 
    LD    A,$1F                     ;[3C93] 
    RST   $08                       ;[3C95] 
    CALL  LYNX_ESC                  ;[3C96] 
    POP   BC                        ;[3C99] 
    JR    Z,$3CA1                   ;[3C9A] 
    DJNZ  $3C80                     ;[3C9C] 
    LD    ($61B8),HL                ;[3C9E] 
    LD    A,$1E                     ;[3CA1] 
    RST   $08                       ;[3CA3] 
    RET                             ;[3CA4] 

    CALL  $3D0C                     ;[3CA5] 
    CALL  $352A                     ;[3CA8] 
    LD    B,$08                     ;[3CAB] 
    PUSH  HL                        ;[3CAD] 
    LD    A,(HL)                    ;[3CAE] 
    INC   HL                        ;[3CAF] 
    CALL  $3D12                     ;[3CB0] 
    DJNZ  $3CAE                     ;[3CB3] 
    POP   HL                        ;[3CB5] 
    RET                             ;[3CB6] 

    LD    A,$0D                     ;[3CB7] 
    RST   $08                       ;[3CB9] 
    RET                             ;[3CBA] 

MONITOR_Z:
    LD    IX,DATA_MONITOR           ;[3CBB] Monitor Z command.
    LD    DE,$619A                  ;[3CBF] 
    LD    B,$0C                     ;[3CC2] 
    PUSH  BC                        ;[3CC4] 
    LD    B,$03                     ;[3CC5] 
    LD    A,(IX+$00)                ;[3CC7] 
    RST   $08                       ;[3CCA] 
    INC   IX                        ;[3CCB] 
    DJNZ  $3CC7                     ;[3CCD] 
    CALL  $352A                     ;[3CCF] 
    LD    A,(DE)                    ;[3CD2] 
    LD    L,A                       ;[3CD3] 
    INC   DE                        ;[3CD4] 
    LD    A,(DE)                    ;[3CD5] 
    LD    H,A                       ;[3CD6] 
    INC   DE                        ;[3CD7] 
    CALL  $3CA5                     ;[3CD8] 
    LD    A,$1E                     ;[3CDB] 
    RST   $08                       ;[3CDD] 
    LD    A,$1F                     ;[3CDE] 
    RST   $08                       ;[3CE0] 
    POP   BC                        ;[3CE1] 
    DJNZ  $3CC4                     ;[3CE2] 
    LD    A,$1E                     ;[3CE4] 
    RST   $08                       ;[3CE6] 
    RET                             ;[3CE7] 


DATA_MONITOR:
    defb 0x41,0x46,0x20,0x48,0x4C,0x20,0x44,0x45        ;[3CE8]
    defb 0x20,0x42,0x43,0x20,0x41,0x46,0x27,0x48        ;[3CF0]
    defb 0x4C,0x27,0x44,0x45,0x27,0x42,0x43,0x27        ;[3CF8]
    defb 0x49,0x58,0x20,0x49,0x59,0x20,0x53,0x50        ;[3D00]
    defb 0x20,0x50,0x43,0x20                            ;[3D08]

    CALL  LYNX_PHEXHL               ;[3D0C] Display HL.
    JP    $352A                     ;[3D0F] 
    CALL  $2239                     ;[3D12] 
    JR    $3D0F                     ;[3D15] 

SUB_ARGUMENT_INTO_HL:
    CALL  $3D24                     ;[3D17] Pick up argument into HL.
    LD    A,(DE)                    ;[3D1A] 
    CP    $0D                       ;[3D1B] 
    RET   Z                         ;[3D1D] 
    CP    $20                       ;[3D1E] 
    RET   Z                         ;[3D20] 
    JP    $3B94                     ;[3D21] 
    LD    HL,START                  ;[3D24] Subroutine called by routine above.
    RST   $10                       ;[3D27] 
    LD    A,(DE)                    ;[3D28] 
    CALL  $3DFA                     ;[3D29] 
    SUB   $30                       ;[3D2C] 
    RET   C                         ;[3D2E] 
    CP    $0A                       ;[3D2F] 
    JR    C,$3D3B                   ;[3D31] 
    SUB   $07                       ;[3D33] 
    CP    $0A                       ;[3D35] 
    RET   C                         ;[3D37] 
    CP    $10                       ;[3D38] 
    RET   NC                        ;[3D3A] 
    ADD   HL,HL                     ;[3D3B] 
    ADD   HL,HL                     ;[3D3C] 
    ADD   HL,HL                     ;[3D3D] 
    ADD   HL,HL                     ;[3D3E] 
    ADD   A,L                       ;[3D3F] 
    LD    L,A                       ;[3D40] 
    INC   DE                        ;[3D41] 
    JR    $3D28                     ;[3D42] 

SUB_ARGUMENT_3:
    POP   IX                        ;[3D44] Pick up three arguments.
    CALL  SUB_ARGUMENT_INTO_HL      ;[3D46] 
    PUSH  HL                        ;[3D49] 
    CALL  SUB_ARGUMENT_INTO_HL      ;[3D4A] 
    PUSH  HL                        ;[3D4D] 
    CALL  SUB_ARGUMENT_INTO_HL      ;[3D4E] 
    LD    C,L                       ;[3D51] 
    LD    B,H                       ;[3D52] 
    JP    (IX)                      ;[3D53] 
    AND   $7F                       ;[3D55] 
    CP    $20                       ;[3D57] 
    JR    NC,$3D5D                  ;[3D59] 
    LD    A,$2E                     ;[3D5B] 
    JP    $351B                     ;[3D5D] 

MONITOR_T:
    CALL  SUB_ARGUMENT_INTO_HL      ;[3D60] Monitor T command.
    LD    A,(DE)                    ;[3D63] 
    CP    $0D                       ;[3D64] 
    RET   Z                         ;[3D66] 
    INC   DE                        ;[3D67] 
    LD    A,(DE)                    ;[3D68] 
    CP    $0D                       ;[3D69] 
    RET   Z                         ;[3D6B] 
    LD    (HL),A                    ;[3D6C] 
    INC   HL                        ;[3D6D] 
    JR    $3D67                     ;[3D6E] 

MONITOR_C:
    CALL  SUB_ARGUMENT_3            ;[3D70] Monitor C command.
    POP   DE                        ;[3D73] 
    POP   HL                        ;[3D74] 
    LDIR                            ;[3D75] 
    RET                             ;[3D77] 

MONITOR_I:
    CALL  SUB_ARGUMENT_3            ;[3D78] Monitor I command.
    POP   DE                        ;[3D7B] 
    POP   HL                        ;[3D7C] 
    CALL  LYNX_CHLDE                ;[3D7D] 
    JR    NC,$3D75                  ;[3D80] 
    ADD   HL,BC                     ;[3D82] 
    EX    DE,HL                     ;[3D83] 
    ADD   HL,BC                     ;[3D84] 
    EX    DE,HL                     ;[3D85] 
    DEC   DE                        ;[3D86] 
    DEC   HL                        ;[3D87] 
    LDDR                            ;[3D88] 
    RET                             ;[3D8A] 

MONITOR_A:
    CALL  SUB_ARGUMENT_INTO_HL      ;[3D8B] Monitor A command.
    PUSH  HL                        ;[3D8E] 
    CALL  SUB_ARGUMENT_INTO_HL      ;[3D8F] 
    LD    E,L                       ;[3D92] 
    LD    D,H                       ;[3D93] 
    POP   HL                        ;[3D94] 
    PUSH  HL                        ;[3D95] 
    ADD   HL,DE                     ;[3D96] 
    CALL  $3D0C                     ;[3D97] 
    POP   HL                        ;[3D9A] 
    PUSH  HL                        ;[3D9B] 
    OR    A                         ;[3D9C] 
    SBC   HL,DE                     ;[3D9D] 
    CALL  $3D0C                     ;[3D9F] 
    POP   HL                        ;[3DA2] 
    EX    DE,HL                     ;[3DA3] 
    DEC   HL                        ;[3DA4] 
    SCF                             ;[3DA5] 
    SBC   HL,DE                     ;[3DA6] 
    LD    A,H                       ;[3DA8] 
    OR    A                         ;[3DA9] 
    JR    Z,$3DB8                   ;[3DAA] 
    INC   A                         ;[3DAC] 
    JR    Z,$3DC2                   ;[3DAD] 
    LD    HL,$3DC9                  ;[3DAF] 
    CALL  LYNX_PLINE                ;[3DB2] 
    JP    $3CB7                     ;[3DB5] 
    LD    A,L                       ;[3DB8] 
    CP    $80                       ;[3DB9] 
    JR    NC,$3DAF                  ;[3DBB] 
    CALL  $3D12                     ;[3DBD] 
    JR    $3DB5                     ;[3DC0] 
    LD    A,L                       ;[3DC2] 
    CP    $80                       ;[3DC3] 
    JR    C,$3DAF                   ;[3DC5] 
    JR    $3DBD                     ;[3DC7] 
    defb 0x3F,0x3F,0x00                                 ;[3DC9]

    CALL  SUB_ARGUMENT_3            ;[3DCC] ???? Doesn't seem to be used!!!!
    LD    A,L                       ;[3DCF] 
    POP   HL                        ;[3DD0] 
    POP   DE                        ;[3DD1] 
    OR    A                         ;[3DD2] 
    SBC   HL,DE                     ;[3DD3] 
    LD    C,L                       ;[3DD5] 
    LD    B,H                       ;[3DD6] 
    LD    H,D                       ;[3DD7] 
    LD    L,E                       ;[3DD8] 
    INC   DE                        ;[3DD9] 
    LD    (HL),A                    ;[3DDA] 
    LDIR                            ;[3DDB] 
    RET                             ;[3DDD] 

MONITOR_Q:
    CALL  SUB_ARGUMENT_INTO_HL      ;[3DDE] Monitor Q command.
    LD    C,L                       ;[3DE1] 
    LD    B,H                       ;[3DE2] 
    IN    A,(C)                     ;[3DE3] 
    CALL  $3D12                     ;[3DE5] 
    JP    $3CB7                     ;[3DE8] 

MONITOR_O:
    CALL  SUB_ARGUMENT_INTO_HL      ;[3DEB] Monitor O command.
    LD    C,L                       ;[3DEE] 
    LD    B,H                       ;[3DEF] 
    CALL  SUB_ARGUMENT_INTO_HL      ;[3DF0] 
    OUT   (C),L                     ;[3DF3] 
    RET                             ;[3DF5] 

MONITOR_B1:
    CALL  SUB_ARGUMENT_INTO_HL      ;[3DF6] Monitor B command.
    JP    (HL)                      ;[3DF9] 
    CP    $40                       ;[3DFA] Test for a Monitor command letter.
    RET   C                         ;[3DFC] 
    RES   5,A                       ;[3DFD] 
    RET                             ;[3DFF] 

MONITOR_W:
    CALL  SUB_ARGUMENT_INTO_HL      ;[3E00] Monitor W command.
    PUSH  HL                        ;[3E03] 
    CALL  SUB_ARGUMENT_INTO_HL      ;[3E04] 
    LD    E,L                       ;[3E07] 
    LD    D,H                       ;[3E08] 
    POP   HL                        ;[3E09] 
    LD    A,(HL)                    ;[3E0A] 
    CP    E                         ;[3E0B] 
    JR    NZ,$3E17                  ;[3E0C] 
    INC   HL                        ;[3E0E] 
    LD    A,(HL)                    ;[3E0F] 
    DEC   HL                        ;[3E10] 
    CP    D                         ;[3E11] 
    JR    NZ,$3E17                  ;[3E12] 
    CALL  $3E21                     ;[3E14] 
    CALL  LYNX_ESC                  ;[3E17] 
    RET   Z                         ;[3E1A] 
    INC   HL                        ;[3E1B] 
    LD    A,L                       ;[3E1C] 
    OR    H                         ;[3E1D] 
    JR    NZ,$3E0A                  ;[3E1E] 
    RET                             ;[3E20] 

    CALL  $3D0C                     ;[3E21] L command subroutine.
    LD    ($61B8),HL                ;[3E24] 
    JP    $3CB7                     ;[3E27] 

MONITOR_L:
    CALL  SUB_ARGUMENT_INTO_HL      ;[3E2A] Monitor L command.
    PUSH  HL                        ;[3E2D] 
    CALL  SUB_ARGUMENT_INTO_HL      ;[3E2E] 
    LD    E,L                       ;[3E31] 
    POP   HL                        ;[3E32] 
    LD    A,(HL)                    ;[3E33] 
    CP    E                         ;[3E34] 
    JR    NZ,$3E3A                  ;[3E35] 
    CALL  $3E21                     ;[3E37] 
    CALL  LYNX_ESC                  ;[3E3A] 
    RET   Z                         ;[3E3D] 
    INC   HL                        ;[3E3E] 
    LD    A,L                       ;[3E3F] 
    OR    H                         ;[3E40] 
    JR    NZ,$3E33                  ;[3E41] 
    RET                             ;[3E43] 

MONITOR_V:
    CALL  SUB_ARGUMENT_3            ;[3E44] Monitor V command.
    POP   DE                        ;[3E47] 
    POP   HL                        ;[3E48] 
    LD    A,(DE)                    ;[3E49] 
    CP    (HL)                      ;[3E4A] 
    CALL  NZ,$3D0C                  ;[3E4B] 
    INC   DE                        ;[3E4E] 
    INC   HL                        ;[3E4F] 
    PUSH  BC                        ;[3E50] 
    CALL  LYNX_ESC                  ;[3E51] 
    POP   BC                        ;[3E54] 
    JR    Z,$3E5C                   ;[3E55] 
    DEC   BC                        ;[3E57] 
    LD    A,B                       ;[3E58] 
    OR    C                         ;[3E59] 
    JR    NZ,$3E49                  ;[3E5A] 
    JP    $3CB7                     ;[3E5C] 

SUB_MONITOR_U:
    POP   DE                        ;[3E5F] Part of U command.
    POP   HL                        ;[3E60] 
    INC   HL                        ;[3E61] 
    INC   HL                        ;[3E62] 
    INC   HL                        ;[3E63] 
    INC   IX                        ;[3E64] 
    INC   IX                        ;[3E66] 
    POP   BC                        ;[3E68] 
    DJNZ  $3E75                     ;[3E69] 
    JP    $3B94                     ;[3E6B] 

MONITOR_U:
    LD    HL,DATA_MONITOR           ;[3E6E] Monitor U command.
    LD    IX,$619A                  ;[3E71] 
    PUSH  BC                        ;[3E75] 
    PUSH  HL                        ;[3E76] 
    PUSH  DE                        ;[3E77] 
    LD    B,$03                     ;[3E78] 
    LD    A,(DE)                    ;[3E7A] 
    CP    (HL)                      ;[3E7B] 
    INC   DE                        ;[3E7C] 
    INC   HL                        ;[3E7D] 
    JR    NZ,SUB_MONITOR_U          ;[3E7E] 
    DJNZ  $3E7A                     ;[3E80] 
    POP   BC                        ;[3E82] 
    POP   BC                        ;[3E83] 
    POP   BC                        ;[3E84] 

MONITOR_X:
    CALL  SUB_ARGUMENT_INTO_HL      ;[3E85] Monitor X command.
    LD    (IX+$00),L                ;[3E88] Display memory starting from where DE points.
    LD    (IX+$01),H                ;[3E8B] 
    LD    DE,$619A                  ;[3E8E] 
    LD    B,$04                     ;[3E91] 
    CALL  $3EAA                     ;[3E93] 
    LD    A,$1E                     ;[3E96] 
    RST   $08                       ;[3E98] 
    LD    A,$1F                     ;[3E99] 
    RST   $08                       ;[3E9B] 
    LD    B,$08                     ;[3E9C] 
    CALL  $3EAA                     ;[3E9E] 
    CALL  $3EB6                     ;[3EA1] 
    LD    A,$1E                     ;[3EA4] 
    RST   $08                       ;[3EA6] 
    JP    $3CB7                     ;[3EA7] 
    LD    A,(DE)                    ;[3EAA] Display the flags.
    LD    L,A                       ;[3EAB] 
    INC   DE                        ;[3EAC] 
    LD    A,(DE)                    ;[3EAD] 
    LD    H,A                       ;[3EAE] 
    INC   DE                        ;[3EAF] 
    CALL  $3D0C                     ;[3EB0] 
    DJNZ  $3EAA                     ;[3EB3] 
    RET                             ;[3EB5] 

    LD    A,($619A)                 ;[3EB6] 
    LD    HL,DATA_FLAGS             ;[3EB9] 
    LD    C,A                       ;[3EBC] 
    SCF                             ;[3EBD] 
    RL    C                         ;[3EBE] 
    RET   Z                         ;[3EC0] 
    LD    A,(HL)                    ;[3EC1] 
    JR    C,$3EC6                   ;[3EC2] 
    LD    A,$2E                     ;[3EC4] 
    RST   $08                       ;[3EC6] 
    INC   HL                        ;[3EC7] 
    OR    A                         ;[3EC8] 
    JR    $3EBE                     ;[3EC9] 

DATA_FLAGS:
    defb 0x53,0x5A,0x31,0x48,0x31,0x50,0x4E,0x43        ;[3ECB]
    defb 0x00                                           ;[3ED3]


MONITOR_E:
    JR    Z,$3EDB                   ;[3ED4] Monitor E command.
    CALL  SUB_ARGUMENT_INTO_HL      ;[3ED6] 
    JR    $3EDE                     ;[3ED9] 
    LD    HL,($61B0)                ;[3EDB] 
    LD    ($61B3),HL                ;[3EDE] 
    LD    SP,($61BA)                ;[3EE1] 
    POP   AF                        ;[3EE5] 
    POP   HL                        ;[3EE6] 
    POP   DE                        ;[3EE7] 
    POP   BC                        ;[3EE8] 
    EXX                             ;[3EE9] 
    EX    AF,AF'                    ;[3EEA] 
    POP   AF                        ;[3EEB] 
    POP   HL                        ;[3EEC] 
    POP   DE                        ;[3EED] 
    POP   BC                        ;[3EEE] 
    EXX                             ;[3EEF] 
    EX    AF,AF'                    ;[3EF0] 
    POP   IX                        ;[3EF1] 
    POP   IY                        ;[3EF3] 
    LD    SP,($61AE)                ;[3EF5] 
    JP    $61B2                     ;[3EF9] 

MONITOR_D:
    CALL  SUB_ARGUMENT_3            ;[3EFC] Monitor D command.
    PUSH  HL                        ;[3EFF] 
    CALL  $3F4E                     ;[3F00] 
    CALL  $0BB4                     ;[3F03] 
    POP   DE                        ;[3F06] 
    POP   HL                        ;[3F07] 
    POP   BC                        ;[3F08] 
    PUSH  BC                        ;[3F09] 
    OR    A                         ;[3F0A] 
    SBC   HL,BC                     ;[3F0B] 
    INC   HL                        ;[3F0D] 
    LD    C,L                       ;[3F0E] 
    LD    B,H                       ;[3F0F] 
    POP   HL                        ;[3F10] 
    PUSH  DE                        ;[3F11] 
    CALL  LYNX_WSYNC                ;[3F12] 
    LD    A,$4D                     ;[3F15] 
    CALL  SYSVAR_WBYTE              ;[3F17] 
    LD    A,C                       ;[3F1A] 
    CALL  SYSVAR_WBYTE              ;[3F1B] 
    LD    A,B                       ;[3F1E] 
    CALL  SYSVAR_WBYTE              ;[3F1F] 
    CALL  $3F46                     ;[3F22] 
    LD    E,$00                     ;[3F25] 
    LD    A,(HL)                    ;[3F27] 
    CALL  SYSVAR_WBYTE              ;[3F28] 
    INC   HL                        ;[3F2B] 
    ADD   A,E                       ;[3F2C] 
    LD    E,A                       ;[3F2D] 
    DEC   BC                        ;[3F2E] 
    LD    A,B                       ;[3F2F] 
    OR    C                         ;[3F30] 
    JR    NZ,$3F27                  ;[3F31] 
    LD    A,E                       ;[3F33] 
    CALL  SYSVAR_WBYTE              ;[3F34] 
    LD    A,$45                     ;[3F37] 
    CALL  SYSVAR_WBYTE              ;[3F39] 
    POP   HL                        ;[3F3C] 
    CALL  $3F46                     ;[3F3D] 
    CALL  SYSVAR_WBYTE              ;[3F40] 
    JP    LYNX_MOTOFF               ;[3F43] 
    LD    A,L                       ;[3F46] Write HL to tape.
    CALL  SYSVAR_WBYTE              ;[3F47] 
    LD    A,H                       ;[3F4A] 
    JP    SYSVAR_WBYTE              ;[3F4B] 
    RST   $10                       ;[3F4E] Check for valid file name.
    CP    $22                       ;[3F4F] 
    JP    NZ,$3B94                  ;[3F51] 
    PUSH  DE                        ;[3F54] 
    INC   DE                        ;[3F55] 
    LD    A,(DE)                    ;[3F56] 
    CP    $0D                       ;[3F57] 
    JP    Z,$3B94                   ;[3F59] 
    CP    $22                       ;[3F5C] 
    JR    NZ,$3F55                  ;[3F5E] 
    POP   DE                        ;[3F60] 
    RET                             ;[3F61] 

BASIC_COM_MLOAD:
    LD    HL,(SYSVAR_STACK)         ;[3F62] MLOAD
    LD    ($61BA),HL                ;[3F65] 
    JR    $3F78                     ;[3F68] 

MONITOR_P1:
    CALL  $3F4E                     ;[3F6A] Monitor P command.
    LD    HL,(SYSVAR_POLBUF)        ;[3F6D] 
    PUSH  HL                        ;[3F70] 
    EX    DE,HL                     ;[3F71] 
    LD    BC,$00FF                  ;[3F72] 
    LDIR                            ;[3F75] 
    POP   DE                        ;[3F77] 
    CALL  $0C26                     ;[3F78] 
    CALL  LYNX_RSYNC                ;[3F7B] 
    CALL  LYNX_RBYTE                ;[3F7E] 
    CP    $4D                       ;[3F81] 
    JR    NZ,$3FC4                  ;[3F83] 
    CALL  LYNX_RBYTE                ;[3F85] 
    LD    C,A                       ;[3F88] 
    CALL  LYNX_RBYTE                ;[3F89] 
    LD    B,A                       ;[3F8C] 
    CALL  LYNX_RBYTE                ;[3F8D] 
    LD    L,A                       ;[3F90] 
    CALL  LYNX_RBYTE                ;[3F91] 
    LD    H,A                       ;[3F94] 
    LD    E,$00                     ;[3F95] 
    CALL  LYNX_RBYTE                ;[3F97] 
    LD    (HL),A                    ;[3F9A] 
    INC   HL                        ;[3F9B] 
    ADD   A,E                       ;[3F9C] 
    LD    E,A                       ;[3F9D] 
    DEC   BC                        ;[3F9E] 
    LD    A,B                       ;[3F9F] 
    OR    C                         ;[3FA0] 
    JR    NZ,$3F97                  ;[3FA1] 
    CALL  LYNX_RBYTE                ;[3FA3] 
    CP    E                         ;[3FA6] 
    JR    NZ,$3FC4                  ;[3FA7] 
    CALL  LYNX_RBYTE                ;[3FA9] 
    CP    $4E                       ;[3FAC] 
    JR    Z,$3F7B                   ;[3FAE] 
    CALL  LYNX_RBYTE                ;[3FB0] 
    LD    L,A                       ;[3FB3] 
    CALL  LYNX_RBYTE                ;[3FB4] 
    LD    H,A                       ;[3FB7] 
    CALL  LYNX_MOTOFF               ;[3FB8] 
    LD    A,L                       ;[3FBB] 
    OR    H                         ;[3FBC] 
    JR    NZ,SUB_MONITOR_R          ;[3FBD] 
    LD    A,$0D                     ;[3FBF] 
    RST   $08                       ;[3FC1] 
    RET                             ;[3FC2] 

SUB_MONITOR_R:
    JP    (HL)                      ;[3FC3] Part of R routine.
    CALL  LYNX_MOTOFF               ;[3FC4] 
    LD    HL,$3AEF                  ;[3FC7] 
    CALL  LYNX_PLINE                ;[3FCA] 
    LD    A,$0D                     ;[3FCD] 
    RST   $08                       ;[3FCF] 
    JP    $3B94                     ;[3FD0] 

SUB_MULTIPLY1:
    JR    NC,$3FD6                  ;[3FD3] Multiply subroutine.
    INC   E                         ;[3FD5] 
    LD    (HL),A                    ;[3FD6] 
    LD    D,E                       ;[3FD7] 
    DEC   HL                        ;[3FD8] 
    RET                             ;[3FD9] 

SUB_DIM:
    PUSH  HL                        ;[3FDA] Part of DIM routine.
    INC   HL                        ;[3FDB] 
    LD    (HL),$00                  ;[3FDC] 
    INC   HL                        ;[3FDE] 
    LD    (HL),$00                  ;[3FDF] 
    POP   HL                        ;[3FE1] 
    JP    $2D88                     ;[3FE2] 
    LD    A,B                       ;[3FE5] Set to FF and not used.
    OR    A                         ;[3FE6] 
    RET   Z                         ;[3FE7] 
    JP    $2C7F                     ;[3FE8] 
    CALL  BASIC_FN_ARCCOS           ;[3FEB] 
    JP    $2FCB                     ;[3FEE] 
    RLA                             ;[3FF1] 
    CALL  NC,LYNX_AD                ;[3FF2] 
    LD    HL,$35FB                  ;[3FF5] 
    CALL  LYNX_LNUM2                ;[3FF8] 
    JP    LYNX_AD                   ;[3FFB] 
    RST   $38                       ;[3FFE] 
    NOP                             ;[3FFF] 
